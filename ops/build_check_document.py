#!/usr/bin/env python3
"""
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–±–æ—Ä–∫–∏ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (0.5)
–Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ 0.91

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
    python ops/build_check_document.py

    # –° AI-–∞–Ω–∞–ª–∏–∑–æ–º –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π (—Ç—Ä–µ–±—É–µ—Ç OPENAI_API_KEY)
    export OPENAI_API_KEY=your_key
    python ops/build_check_document.py --ai-analysis

–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤: content/0. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ/0.5. –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç.md

–ü—Ä–∞–≤–∏–ª–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
- –¶–∏—Ñ—Ä–æ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã (1, 2, 3...) - –∑–∞–≥–æ–ª–æ–≤–∫–∏ —É—Ä–æ–≤–Ω—è 2 (##)
- –ë—É–∫–≤–µ–Ω–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã (A, B, C...) - –∑–∞–≥–æ–ª–æ–≤–∫–∏ —É—Ä–æ–≤–Ω—è 3 (###)
- –¢–µ–∫—Å—Ç —Å –º–∞—Ä–∫–µ—Ä–æ–º "<!-- –ù–µ –¥–ª—è –ò–ò -->" –∏–ª–∏ –Ω–∏–∂–µ "---\n–ù–µ –¥–ª—è —á—Ç–µ–Ω–∏—è –ò–ò" –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è
"""

import os
import re
import sys
import argparse
from pathlib import Path
from datetime import datetime
from typing import Dict, List, Optional

# –ë–∞–∑–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞
BASE_DIR = Path(__file__).parent.parent
CONTENT_DIR = BASE_DIR / "content"

# –ú–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ –æ–±—Ä–∞–±–æ—Ç–∫–∏ AI
EXCLUDE_MARKERS = [
    "<!-- –ù–µ –¥–ª—è –ò–ò -->",
    "<!-- –Ω–µ –¥–ª—è –∏–∏ -->",
    "–ù–µ –¥–ª—è —á—Ç–µ–Ω–∏—è –ò–ò",
    "–Ω–µ –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∏",
    "Not for AI",
]

# –ú–∞–ø–ø–∏–Ω–≥ —Ä–∞–∑–¥–µ–ª–æ–≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
DOCUMENT_MAPPING = {
    "1": {
        "title": "–ó–∞—á–µ–º, –¥–ª—è –∫–æ–≥–æ, —á—Ç–æ –º—ã –¥–µ–ª–∞–µ–º –∏ —á—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è –≤ –º–∏—Ä–µ",
        "sources": [
            "1. –ò–¥–µ–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã/1.4. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –¶–ê.md",
            "2. –ü—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ/–ú–∞–Ω–∏—Ñ–µ—Å—Ç.md"
        ],
        "extract_sections": ["# 0. –ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ", "## A. –£–∫—Ä—É–ø–Ω—ë–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞"]
    },
    "2": {
        "title": "–ö–∞–∫–∏–µ –≥–ª–∞–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –≥–∏–ø–æ—Ç–µ–∑—ã –∏ —Ü–µ–ª–∏ –º—ã –≤–∏–¥–∏–º",
        "sources": [
            "1. –ò–¥–µ–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã/1.1. –ü—Ä–æ–±–ª–µ–º—ã.md",
            "1. –ò–¥–µ–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã/1.2. –ì–∏–ø–æ—Ç–µ–∑—ã.md",
            "1. –ò–¥–µ–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã/1.5. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–ª–µ–π –∏ –∑–∞–¥–∞—á.md"
        ],
        "summarize": True
    },
    "3": {
        "title": "–ö–∞–∫ –º—ã –≤–∏–¥–∏–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã",
        "sources": [
            "1. –ò–¥–µ–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã/1.4. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –¶–ê.md"
        ],
        "extract_sections": ["## B. –ì–ª–∞–≤–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã", "## F. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è"]
    },
    "4": {
        "title": "–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ò–ò-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã",
        "sources": [
            "1. –ò–¥–µ–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã/1.4. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –¶–ê.md",
            "4. –°–∏—Å—Ç–µ–º—ã/4.2. –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ò–ò-–ø–ª–∞—Ç—Ñ–æ—Ä–º—ã.md"
        ],
        "extract_sections": ["## C. –°–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∏—Å—Ç–µ–º"]
    },
    "5": {
        "title": "–°–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∏—Å—Ç–µ–º",
        "sources": [
            "4. –°–∏—Å—Ç–µ–º—ã/4.1. –°–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∏—Å—Ç–µ–º.md",
            "1. –ò–¥–µ–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã/1.4. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –¶–ê.md"
        ],
        "extract_sections": ["## C. –°–ø–∏—Å–æ–∫ –ø–æ–¥—Å–∏—Å—Ç–µ–º"]
    },
    "6": {
        "title": "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º",
        "sources": [
            "1. –ò–¥–µ–∏ —Ä–∞–∑–≤–∏—Ç–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã/1.4. –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –¥–ª—è –¶–ê.md"
        ],
        "extract_sections": ["## D. –î–∞–Ω–Ω—ã–µ –∏ –ú–ò–ú"]
    },
    "7": {
        "title": "–ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏",
        "sources": [
            "0. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ/0.8. –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–±–æ—Ç—ã.md"
        ],
        "extract_sections": ["### –ö–∞–∫ –∏–¥—ë—Ç —Ä–∞–±–æ—Ç–∞"]
    },
    "8": {
        "title": "–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–µ–∫—É—â–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∫–∞–∫–∏–µ —Ç–µ–≥–∏ —É –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
        "sources": [
            "0. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ/0.7. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∏ —Ç–µ–≥–∏.md"
        ],
        "extract_sections": ["## –ë–∞–∑–æ–≤–∞—è —Å—Ö–µ–º–∞", "## –ö–∞—Ä—Ç–∞"]
    }
}


def filter_ai_excluded_content(content: str) -> str:
    """
    –£–¥–∞–ª—è–µ—Ç —Ç–µ–∫—Å—Ç, –ø–æ–º–µ—á–µ–Ω–Ω—ã–π –∫–∞–∫ '–ù–µ –¥–ª—è –ò–ò'

    –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
    1. <!-- –ù–µ –¥–ª—è –ò–ò --> ... <!-- /–ù–µ –¥–ª—è –ò–ò -->
    2. –¢–µ–∫—Å—Ç –ø–æ—Å–ª–µ "---\n–ù–µ –¥–ª—è —á—Ç–µ–Ω–∏—è –ò–ò"
    """
    # –£–¥–∞–ª—è–µ–º –±–ª–æ–∫–∏ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
    for marker in EXCLUDE_MARKERS:
        # HTML –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
        pattern = rf'<!--\s*{re.escape(marker)}\s*-->.*?<!--\s*/.*?-->'
        content = re.sub(pattern, '', content, flags=re.DOTALL | re.IGNORECASE)

    # –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø–æ—Å–ª–µ –º–∞—Ä–∫–µ—Ä–∞ "–ù–µ –¥–ª—è —á—Ç–µ–Ω–∏—è –ò–ò"
    for marker in EXCLUDE_MARKERS:
        pattern = rf'---\s*\n\s*{re.escape(marker)}.*'
        content = re.sub(pattern, '', content, flags=re.DOTALL | re.IGNORECASE)

    return content


def read_document(file_path: Path) -> str:
    """–ß–∏—Ç–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç"""
    try:
        with open(file_path, 'r', encoding='utf-8') as f:
            content = f.read()
        return filter_ai_excluded_content(content)
    except FileNotFoundError:
        return f"‚ö†Ô∏è –î–æ–∫—É–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: {file_path}"


def extract_sections(content: str, sections: List[str]) -> str:
    """–ò–∑–≤–ª–µ–∫–∞–µ—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞"""
    result = []
    lines = content.split('\n')
    capturing = False
    current_level = 0

    for line in lines:
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—á–∞–ª–æ –Ω—É–∂–Ω–æ–π —Å–µ–∫—Ü–∏–∏
        for section in sections:
            if line.strip().startswith(section):
                capturing = True
                current_level = line.count('#')
                result.append(line)
                break
        else:
            if capturing:
                # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—Ö–≤–∞—Ç –ø—Ä–∏ –≤—Å—Ç—Ä–µ—á–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ç–æ–≥–æ –∂–µ –∏–ª–∏ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–≥–æ —É—Ä–æ–≤–Ω—è
                line_level = 0
                if line.startswith('#'):
                    line_level = len(line) - len(line.lstrip('#'))

                if line_level > 0 and line_level <= current_level:
                    is_new_section = any(line.strip().startswith(s) for s in sections)
                    if not is_new_section:
                        capturing = False
                        continue

                if capturing:
                    result.append(line)

    return '\n'.join(result)


def summarize_section(content: str, max_items: int = 10) -> str:
    """–°–æ–∑–¥–∞–µ—Ç –∫—Ä–∞—Ç–∫—É—é —Å–≤–æ–¥–∫—É —Ä–∞–∑–¥–µ–ª–∞"""
    lines = content.split('\n')
    important_lines = []

    for line in lines:
        # –°–æ–±–∏—Ä–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –≤–∞–∂–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
        if (line.startswith('#') or
            line.strip().startswith('**') or
            line.strip().startswith('-') or
            line.strip().startswith('*')):
            important_lines.append(line)
            if len(important_lines) >= max_items:
                break

    return '\n'.join(important_lines[:max_items])


def adjust_heading_levels(content: str, section_num: str) -> str:
    """
    –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç —É—Ä–æ–≤–Ω–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤:
    - –¶–∏—Ñ—Ä–æ–≤—ã–µ —Ä–∞–∑–¥–µ–ª—ã (1-9) -> H2
    - –ë—É–∫–≤–µ–Ω–Ω—ã–µ –ø–æ–¥—Ä–∞–∑–¥–µ–ª—ã (–æ–¥–Ω–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞ A-Z, –ê-–Ø –≤ –Ω–∞—á–∞–ª–µ) -> H3
    - –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ -> H4 –∏ –Ω–∏–∂–µ
    """
    lines = content.split('\n')
    result = []

    for line in lines:
        if line.startswith('#'):
            # –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–µ–∫—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞
            heading_match = re.match(r'^(#+)\s*(.+)$', line)
            if heading_match:
                hashes, text = heading_match.groups()
                current_level = len(hashes)

                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–≤—ã–π —Å–∏–º–≤–æ–ª —Ç–µ–∫—Å—Ç–∞ (–±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤)
                text_start = text.lstrip()

                # –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å —Ü–∏—Ñ—Ä—ã
                if text_start and text_start[0].isdigit():
                    # –¶–∏—Ñ—Ä–æ–≤–æ–π —Ä–∞–∑–¥–µ–ª -> H2
                    line = f"## {text}"
                # –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –ª–∏ —Å –æ–¥–Ω–æ–π –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã + —Ç–æ—á–∫–∞/–ø—Ä–æ–±–µ–ª
                # –ù–∞–ø—Ä–∏–º–µ—Ä: "A. ", "B. ", "–ê. ", "–ë. "
                elif (text_start and len(text_start) > 1 and
                      text_start[0].isupper() and text_start[0].isalpha() and
                      (text_start[1] == '.' or text_start[1] == ' ' or text_start[1] == ')') and
                      (ord(text_start[0]) < 128 or ord('–ê') <= ord(text_start[0]) <= ord('–Ø'))):
                    # –ë—É–∫–≤–µ–Ω–Ω—ã–π –ø–æ–¥—Ä–∞–∑–¥–µ–ª -> H3
                    line = f"### {text}"
                else:
                    # –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ -> –º–∏–Ω–∏–º—É–º H4
                    # –ï—Å–ª–∏ –∏—Å—Ö–æ–¥–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –±—ã–ª H1-H3, –¥–µ–ª–∞–µ–º H4
                    # –ï—Å–ª–∏ –±—ã–ª H4+, –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    if current_level <= 3:
                        line = f"#### {text}"
                    else:
                        # –û—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                        line = f"{'#' * current_level} {text}"

        result.append(line)

    return '\n'.join(result)


def build_section(section_num: str, config: Dict) -> str:
    """–°–æ–±–∏—Ä–∞–µ—Ç –æ–¥–∏–Ω —Ä–∞–∑–¥–µ–ª –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞"""
    result = [f"\n## {section_num}. {config['title']}\n"]

    for source in config['sources']:
        source_path = CONTENT_DIR / source
        content = read_document(source_path)

        if "‚ö†Ô∏è" in content:
            result.append(content)
            continue

        # –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω—É–∂–Ω—ã–µ —Å–µ–∫—Ü–∏–∏ –∏–ª–∏ –¥–µ–ª–∞–µ–º —Å–≤–æ–¥–∫—É
        if 'extract_sections' in config:
            extracted = extract_sections(content, config['extract_sections'])
            if extracted:
                adjusted = adjust_heading_levels(extracted, section_num)
                result.append(adjusted)
        elif config.get('summarize'):
            summary = summarize_section(content)
            result.append(summary)
        else:
            result.append('\n'.join(content.split('\n')[:50]))

    return '\n'.join(result)


def analyze_contradictions_with_ai(sections_content: str) -> str:
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ —Å –ø–æ–º–æ—â—å—é AI

    Args:
        sections_content: –°–æ–±—Ä–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤

    Returns:
        –¢–µ–∫—Å—Ç —Ä–∞–∑–¥–µ–ª–∞ 9 —Å –∞–Ω–∞–ª–∏–∑–æ–º –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π
    """
    try:
        import openai
        from openai import OpenAI
    except ImportError:
        return """
## 9. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è—Ö –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö

‚ö†Ô∏è **AI-–∞–Ω–∞–ª–∏–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**: –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `openai`

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: `pip install openai`

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ–±–ª–∞—Å—Ç–∏ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è:
1. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª–µ–π –∏ —Å–∏—Å—Ç–µ–º
2. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏
"""

    api_key = os.getenv('OPENAI_API_KEY')
    if not api_key:
        return """
## 9. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è—Ö –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö

‚ö†Ô∏è **AI-–∞–Ω–∞–ª–∏–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω**: –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω OPENAI_API_KEY

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
export OPENAI_API_KEY=your_api_key
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ–±–ª–∞—Å—Ç–∏ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è:
1. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª–µ–π –∏ —Å–∏—Å—Ç–µ–º
2. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏
"""

    print("ü§ñ –ó–∞–ø—É—Å–∫–∞—é AI-–∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π...")

    try:
        client = OpenAI(api_key=api_key)

        prompt = f"""–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–ª–µ–¥—É—é—â–∏–π –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–æ–µ–∫—Ç–∞ —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã —Ä–∞–∑–≤–∏—Ç–∏—è –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞.

–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –Ω–∞–π—Ç–∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏.

–î–û–ö–£–ú–ï–ù–¢:
{sections_content[:15000]}

–ó–ê–î–ê–ß–ò –ê–ù–ê–õ–ò–ó–ê:

1. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª–µ–π –∏ —Å–∏—Å—Ç–µ–º**: –≤—Å–µ –ª–∏ —Å–∏—Å—Ç–µ–º—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 5 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ü–µ–ª–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 2?

2. **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**: —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (—Ä–∞–∑–¥–µ–ª 7) –æ–ø–∏—Å–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (—Ä–∞–∑–¥–µ–ª 4)?

3. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –¥–æ—Å—Ç—É–ø**: –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ª–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 8 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ?

4. **–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å**: —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –ª–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —ç–∫–æ–Ω–æ–º–∏–∫–∏ –≤–∫–ª–∞–¥–∞ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ 2, 3 –∏ 5?

5. **–î—Ä—É–≥–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è**: –ª—é–±—ã–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≤ —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏–∏, –ø–æ–¥—Ö–æ–¥–∞—Ö, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞—Ö.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:

–°–æ–∑–¥–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç—á–µ—Ç –≤ Markdown:

### –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è

#### 1. [–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è]
- **–ì–¥–µ**: —Ä–∞–∑–¥–µ–ª—ã X –∏ Y
- **–°—É—Ç—å**: –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### –û–±–ª–∞—Å—Ç–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏

–ü–µ—Ä–µ—á–∏—Å–ª–∏ –æ–±–ª–∞—Å—Ç–∏ –≥–¥–µ –≤—Å–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ

### –ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞

–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (1-10) –∏ –∫–ª—é—á–µ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
"""

        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {"role": "system", "content": "–¢—ã —ç–∫—Å–ø–µ—Ä—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –≤—ã—è–≤–ª–µ–Ω–∏—é –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –≤ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤."},
                {"role": "user", "content": prompt}
            ],
            temperature=0.3,
            max_tokens=2000
        )

        analysis = response.choices[0].message.content

        print("‚úÖ AI-–∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à–µ–Ω")

        return f"""
## 9. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è—Ö –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö

> ü§ñ **AI-–∞–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω**: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

{analysis}

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
–î–æ–∫—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è AI-–∞–≥–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π.
–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

_–°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–π —Å–±–æ—Ä–∫–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞._
"""

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ AI-–∞–Ω–∞–ª–∏–∑–∞: {e}")
        return f"""
## 9. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è—Ö –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö

‚ö†Ô∏è **–û—à–∏–±–∫–∞ AI-–∞–Ω–∞–ª–∏–∑–∞**: {str(e)}

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –æ–±–ª–∞—Å—Ç–∏ –Ω–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è:
1. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª–µ–π –∏ —Å–∏—Å—Ç–µ–º
2. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —ç–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–æ–π –º–æ–¥–µ–ª–∏
"""


def build_check_document(use_ai: bool = False) -> str:
    """–°–æ–±–∏—Ä–∞–µ—Ç –ø–æ–ª–Ω—ã–π –ø—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç"""

    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ
    header = f"""# –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç

> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤ –∏ –¥–∞—ë—Ç —Å–≤–æ–¥–∫—É —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏:
–ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –∫–∞–∫ –ø—Ä–∏–Ω—Ü–∏–ø—ã –∏ —Ä–µ—à–µ–Ω–∏—è –æ—Ç—Ä–∞–∂–∞—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–∞—Ö, —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞—Ö –∏ –º–µ—Ç—Ä–∏–∫–∞—Ö;
—á–µ–ª–æ–≤–µ–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–ª–∏ –ø–æ–º–µ—á–∞–µ—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è.

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞:** `0.91. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞.md`

---
"""

    # –°–æ–±–∏—Ä–∞–µ–º —Ä–∞–∑–¥–µ–ª—ã
    sections = []
    all_content = []

    for section_num in sorted(DOCUMENT_MAPPING.keys()):
        config = DOCUMENT_MAPPING[section_num]
        print(f"–°–æ–±–∏—Ä–∞—é —Ä–∞–∑–¥–µ–ª {section_num}: {config['title']}...")
        section_content = build_section(section_num, config)
        sections.append(section_content)
        all_content.append(section_content)

    # –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π
    if use_ai:
        combined_content = '\n'.join(all_content)
        sections.append(analyze_contradictions_with_ai(combined_content))
    else:
        sections.append("""
## 9. –ó–∞–∫–ª—é—á–µ–Ω–∏–µ –æ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è—Ö –∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è—Ö

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
–ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞.
–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.

### –û–±–ª–∞—Å—Ç–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
1. **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ü–µ–ª–µ–π –∏ —Å–∏—Å—Ç–µ–º**: –≤—Å–µ –ª–∏ —Å–∏—Å—Ç–µ–º—ã –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 5 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ü–µ–ª–∏ –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 2?
2. **–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**: —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (—Ä–∞–∑–¥–µ–ª 7) –æ–ø–∏—Å–∞–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ (—Ä–∞–∑–¥–µ–ª 4)?
3. **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –¥–æ—Å—Ç—É–ø**: –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ª–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 8 –∫–æ –≤—Å–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º?
4. **–≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å**: —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –ª–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —ç–∫–æ–Ω–æ–º–∏–∫–∏ –≤–∫–ª–∞–¥–∞ –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏ 2, 3 –∏ 5?

### –°—Ç–∞—Ç—É—Å
üîÑ **–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏**

üí° **–ü–æ–¥—Å–∫–∞–∑–∫–∞**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å —Ñ–ª–∞–≥–æ–º `--ai-analysis` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ AI-–∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π

_–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –ø–æ—Å–ª–µ –∞–Ω–∞–ª–∏–∑–∞ —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞._
""")

    # –°–æ–±–∏—Ä–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç
    full_document = header + '\n'.join(sections)

    return full_document


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    parser = argparse.ArgumentParser(description='–°–±–æ—Ä–∫–∞ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞')
    parser.add_argument('--ai-analysis', action='store_true',
                       help='–í–∫–ª—é—á–∏—Ç—å AI-–∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π (—Ç—Ä–µ–±—É–µ—Ç OPENAI_API_KEY)')
    args = parser.parse_args()

    print("üöÄ –ù–∞—á–∏–Ω–∞—é —Å–±–æ—Ä–∫—É –ü—Ä–æ–≤–µ—Ä–æ—á–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞...")
    print(f"üìÅ –ë–∞–∑–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {BASE_DIR}")
    print(f"üìÑ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞: {CONTENT_DIR}")

    if args.ai_analysis:
        print("ü§ñ AI-–∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π: –í–ö–õ–Æ–ß–ï–ù")
    else:
        print("‚ÑπÔ∏è  AI-–∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π: –í–´–ö–õ–Æ–ß–ï–ù (–¥–æ–±–∞–≤—å—Ç–µ --ai-analysis –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è)")

    print()

    # –°–æ–±–∏—Ä–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç
    document = build_check_document(use_ai=args.ai_analysis)

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    output_path = CONTENT_DIR / "0. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ" / "0.5. –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç.md"
    with open(output_path, 'w', encoding='utf-8') as f:
        f.write(document)

    print(f"\n‚úÖ –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–±—Ä–∞–Ω!")
    print(f"üìç –°–æ—Ö—Ä–∞–Ω–µ–Ω –≤: {output_path}")
    print(f"üìä –†–∞–∑–º–µ—Ä: {len(document)} —Å–∏–º–≤–æ–ª–æ–≤")

    if args.ai_analysis:
        print(f"\nü§ñ AI-–∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –≤–∫–ª—é—á–µ–Ω –≤ —Ä–∞–∑–¥–µ–ª 9")
    else:
        print(f"\nüí° –î–ª—è AI-–∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏–π –∑–∞–ø—É—Å—Ç–∏—Ç–µ:")
        print(f"   export OPENAI_API_KEY=your_key")
        print(f"   python ops/build_check_document.py --ai-analysis")


if __name__ == "__main__":
    main()

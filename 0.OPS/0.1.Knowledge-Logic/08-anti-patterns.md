# Антипаттерны S2R (Anti-Patterns)

## Назначение документа

Этот документ описывает **типичные ошибки и антипаттерны** при работе с методологией S2R. Знание антипаттернов помогает избежать их повторения и поддерживать качество хранилища знаний.

---

## Антипаттерны структуры

### АП-1: Множественные SoI в одном ядре

**Проблема**: Одно ядро описывает несколько целевых систем.

**❌ Ошибка**:
```
A.Созидатель-и-Команда/
├── A1.Организация/        # Надсистема для кого?
├── A2.Созидатель/         # SoI #1
├── A2.Команда/            # SoI #2 ← ОШИБКА!
└── A3.Экосистема/
```

**✅ Правильно**:
```
A.Созидатель/
├── A1.Команды/
├── A2.Созидатель/         # Один SoI
└── A3.Экосистема/

B.Команда/
├── B1.Организация/
├── B2.Команда/            # Отдельное ядро для команды
└── B3.HR-система/
```

**Правило**: **Одно ядро = один SoI** (Rule 1 в [[04-ontology.md]]).

---

### АП-2: Надсистема не содержит SoI

**Проблема**: Нарушено отношение X1 ∋ X2.

**❌ Ошибка**:
```
A.Созидатель/
├── A1.Рынок/              # ← Рынок НЕ содержит созидателя!
├── A2.Созидатель/
└── A3.Экосистема/
```

**✅ Правильно**:
```
A.Созидатель/
├── A1.Команды/            # Команды ∋ Созидателя
├── A2.Созидатель/
└── A3.Экосистема/
```

**Правило**: **X1 ∋ X2** всегда (Rule 2 в [[04-ontology.md]]).

**Диагностика**: Спросите себя: "Физически или логически надсистема СОДЕРЖИТ SoI?"

---

### АП-3: Система создания не создаёт SoI

**Проблема**: Нарушено отношение X3 → X2.

**❌ Ошибка**:
```
B.Экосистема/
├── B1.Мир/
├── B2.Экосистема/
└── B3.Рынок/              # ← Рынок НЕ создаёт экосистему!
```

**✅ Правильно**:
```
B.Экосистема/
├── B1.Мир/
├── B2.Экосистема/
└── B3.Система-создания/   # Система создания → Экосистему
```

**Правило**: **X3 → X2** всегда (Rule 3 в [[04-ontology.md]]).

**Диагностика**: Спросите себя: "Эта система СОЗДАЁТ/ПРОИЗВОДИТ SoI?"

---

### АП-4: Абстрактные имена систем

**Проблема**: Использование абстрактных меток вместо реальных имён.

**❌ Ошибка**:
```
A.Target-System/           # ← Абстракция!
├── A1.Supersystem/
├── A2.System-of-Interest/
└── A3.Creation-System/
```

**✅ Правильно**:
```
A.Созидатель/              # Реальное имя
├── A1.Команды/
├── A2.Созидатель/
└── A3.Экосистема/
```

**Правило**: **Реальные имена систем, не абстракции** (Rule 4 в [[04-ontology.md]]).

**Примеры абстракций**: Target-System, System-of-Interest, Надсистема, Целевая-система.

---

### АП-5: Роли на русском языке

**Проблема**: Роли записаны на русском вместо английского.

**❌ Ошибка**:
```
A.Созидатель/
├── A2.Созидатель/
    ├── A2.1.Смыслы/       # ← Русский!
    ├── A2.2.Архитектура/
    └── A2.3.Операции/
```

**✅ Правильно**:
```
A.Созидатель/
├── A2.Созидатель/
    ├── A2.1.Meaning/      # Английский
    ├── A2.2.Architecture/
    └── A2.3.Operations/
```

**Правило**: **Роли только на английском** (Rule 5 в [[04-ontology.md]]).

**Список ролей**: `.1.Meaning`, `.2.Architecture`, `.3.Operations`.

---

### АП-6: Неполная матрица 3×3

**Проблема**: В ядре меньше или больше 9 папок.

**❌ Ошибка**:
```
A.Созидатель/
├── A1.Команды/
│   ├── A1.1.Meaning/
│   └── A1.2.Architecture/    # ← Только 2 роли!
├── A2.Созидатель/
└── A3.Экосистема/
```

**✅ Правильно**:
```
A.Созидатель/
├── A1.Команды/
│   ├── A1.1.Meaning/
│   ├── A1.2.Architecture/
│   └── A1.3.Operations/      # Все 3 роли!
├── A2.Созидатель/
│   ├── A2.1.Meaning/
│   ├── A2.2.Architecture/
│   └── A2.3.Operations/
└── A3.Экосистема/
    ├── A3.1.Meaning/
    ├── A3.2.Architecture/
    └── A3.3.Operations/
```

**Правило**: **Ядро = 3 системы × 3 роли = 9 папок**.

---

## Антипаттерны именования

### АП-7: Отсутствие префикса у файла

**Проблема**: Имя файла без префикса роли (R., S., AGT., QLF., C., E.).

**❌ Ошибка**:
```
созидатель.md              # ← Нет префикса!
модель-компетенций.md
```

**✅ Правильно**:
```
R.Созидатель.md            # Роль
S.Команды.md               # Система
C.Модель-Компетенций.md    # Компонент
```

**Правило**: **Префикс + PascalCase** (см. [[07-naming.md]]).

---

### АП-8: Пробелы в именах файлов

**Проблема**: Пробелы вместо дефисов в PascalCase.

**❌ Ошибка**:
```
R.Созидатель ученик.md     # ← Пробел!
S.Система создания.md
```

**✅ Правильно**:
```
R.Созидатель-Ученик.md     # Дефис между словами
S.Система-Создания.md
```

**Правило**: **PascalCase + дефисы** для многословных имён.

---

### АП-9: Кириллица в URL и путях

**Проблема**: Кириллица в именах файлов → проблемы с URL и git.

**❌ Проблематично**:
```
А.Созидатель/              # Кириллица А (не латинская A)
А1.Команды/
```

**✅ Рекомендуется**:
```
A.Sozidatel/               # Транслитерация для URL
A.Creator/                 # Или английский
```

**Контекст**: Кириллица допустима, но может вызывать проблемы в web/git.

**Решение**: Использовать латиницу для префиксов и ключевых папок.

---

## Антипаттерны документов

### АП-10: Документ без Frontmatter

**Проблема**: Markdown-файл без YAML-заголовка.

**❌ Ошибка**:
```markdown
# Модель созидателя

Созидатель — это человек...
```

**✅ Правильно**:
```markdown
---
family: F5
kernel: A
system: A2
role: Architecture
target_audience:
  - "Методологи"
status: stable
---
# Модель созидателя

Созидатель — это человек...
```

**Правило**: **Каждый документ должен иметь Frontmatter** (см. [[06-taxonomy.md]]).

---

### АП-11: Несоответствие семейства и аудитории

**Проблема**: target_audience не соответствует семейству документа.

**❌ Ошибка**:
```yaml
---
family: F1                    # Для потенциальных участников
target_audience:
  - "Инвесторы"              # ← ОШИБКА! Инвесторы → F7
---
```

**✅ Правильно**:
```yaml
---
family: F7                    # Для инвесторов
target_audience:
  - "Инвесторы"
  - "Стратеги"
---
```

**Правило**: **Аудитория должна совпадать с семейством** (см. [[06-taxonomy.md]], матрица).

---

### АП-12: Документ в неправильной папке

**Проблема**: Документ лежит не в той папке, что указана в Frontmatter.

**❌ Ошибка**:
```
Файл: A.Созидатель/A1.Команды/A1.1.Meaning/R.Созидатель.md
Frontmatter:
  kernel: B              # ← ОШИБКА! Файл в ядре A
  system: B2
```

**✅ Правильно**:
```
Файл: A.Созидатель/A2.Созидатель/A2.1.Meaning/R.Созидатель.md
Frontmatter:
  kernel: A              # Совпадает с путём
  system: A2
  role: Meaning
```

**Правило**: **Frontmatter должен совпадать с физическим расположением файла**.

---

### АП-13: Отсутствие target_audience

**Проблема**: Не указана целевая аудитория (критический атрибут).

**❌ Ошибка**:
```yaml
---
family: F5
kernel: A
status: stable
# ← target_audience отсутствует!
---
```

**✅ Правильно**:
```yaml
---
family: F5
kernel: A
target_audience:          # ОБЯЗАТЕЛЬНО!
  - "Методологи"
  - "Наставники"
status: stable
---
```

**Правило**: **target_audience — критический атрибут, всегда обязателен**.

---

### АП-14: Дублирование знаний

**Проблема**: Один и тот же контент продублирован в нескольких файлах.

**❌ Ошибка**:
```
A2.2.Architecture/model.md       # Модель созидателя
A2.1.Meaning/vision.md           # Та же модель дублируется
```

**✅ Правильно**:
```
A2.2.Architecture/model.md       # Основной документ
A2.1.Meaning/vision.md           # Ссылается через [[model.md]]
```

**Правило**: **Single Source of Truth** — одно знание = один файл.

**Решение**: Использовать wikilinks `[[...]]` для ссылок на существующие документы.

---

## Антипаттерны связей

### АП-15: Циклические зависимости

**Проблема**: A depends_on B, B depends_on A.

**❌ Ошибка**:
```yaml
# File A:
depends_on:
  - "B.md"

# File B:
depends_on:
  - "A.md"              # ← Цикл!
```

**✅ Правильно**:
```yaml
# File A:
depends_on:
  - "Base.md"

# File B:
depends_on:
  - "Base.md"           # Общий родитель
related:
  - "A.md"              # Горизонтальная связь
```

**Правило**: **Зависимости должны быть ациклическими (DAG)**.

**Решение**: Использовать `related` для горизонтальных связей.

---

### АП-16: Обратные зависимости

**Проблема**: Дочерний документ указан в depends_on (должен быть в affects).

**❌ Ошибка**:
```yaml
# Parent document:
depends_on:
  - "child.md"          # ← ОШИБКА! Родитель не зависит от ребёнка
```

**✅ Правильно**:
```yaml
# Parent document:
affects:
  - "child.md"          # Родитель влияет на ребёнка

# Child document:
depends_on:
  - "parent.md"         # Ребёнок зависит от родителя
```

**Правило**: **depends_on = от кого зависим, affects = на кого влияем**.

---

### АП-17: Битые ссылки

**Проблема**: depends_on указывает на несуществующий файл.

**❌ Ошибка**:
```yaml
depends_on:
  - "old-file.md"       # ← Файл удалён!
```

**Диагностика**: ИИ-агент проверяет все ссылки и выдаёт ошибку.

**Решение**:
1. Обновить ссылку на новый файл
2. Удалить ссылку, если зависимость больше не актуальна

**Инструмент**: `.ops/validate_classifications.py` проверяет битые ссылки.

---

## Антипаттерны процессов

### АП-18: Новый контент сразу в stable

**Проблема**: Новый документ создаётся со статусом `stable` без ревью.

**❌ Ошибка**:
```yaml
status: stable          # ← Новый документ!
created: 2025-01-16
modified: 2025-01-16    # ← Создан сегодня
```

**✅ Правильно**:
```yaml
status: draft           # Сначала draft
created: 2025-01-16
# После ревью → review → stable
```

**Правило**: **Новый контент проходит draft → review → stable**.

---

### АП-19: Файлы в 0.9.Inbox/ старше месяца

**Проблема**: Inbox замусорен старыми файлами.

**❌ Ошибка**:
```
0.9.Inbox/
├── old-idea-2024-11.md  # ← 2 месяца назад!
├── todo-draft.md        # ← Месяц назад
```

**✅ Правильно**:
```
0.9.Inbox/
├── new-idea-2025-01-15.md  # Свежий контент
# Старые → обработать или удалить
```

**Правило**: **Inbox регулярно чистится** (раз в 2 недели).

**Процесс**: Файлы >1 месяца → `0.99.Архив/` или удаление.

---

### АП-20: Изменение без обновления modified

**Проблема**: Файл изменён, но `modified:` не обновлён.

**❌ Ошибка**:
```yaml
created: 2025-01-10
modified: 2025-01-10    # ← Не обновлено!
# Но git log показывает изменения 2025-01-16
```

**✅ Правильно**:
```yaml
created: 2025-01-10
modified: 2025-01-16    # Актуальная дата
```

**Правило**: **При каждом редактировании обновлять `modified`**.

**Автоматизация**: ИИ-агенты могут обновлять автоматически.

---

## Антипаттерны F0 (Мета-уровень)

### АП-21: Попытка создать ядро F0

**Проблема**: F0 трактуется как обычное ядро с SoI.

**❌ Ошибка**:
```
F0.Методология/
├── F0.1.Надсистема/     # ← ОШИБКА! F0 не ядро
├── F0.2.Методология/
└── F0.3.Команда/
```

**✅ Правильно**:
```
0.OPS/                   # F0 = мета-уровень без SoI
├── 0.1.Knowledge-Logic/
├── 0.2.Kernels-Bridge/
├── ...
```

**Правило**: **F0 не является ядром** — это мета-уровень управления (см. [[04-ontology.md]]).

---

### АП-22: Эпистемологический контент вне 0.1

**Проблема**: Фундаментальные знания S2R размазаны по разным папкам.

**❌ Ошибка**:
```
0.2.Kernels-Bridge/
├── ontology.md          # ← Эпистемология!
└── glossary.md
```

**✅ Правильно**:
```
0.1.Knowledge-Logic/
├── 04-ontology.md       # Эпистемология в 0.1
└── 05-glossary.md
```

**Правило**: **0.1 = эпистемология S2R** (что такое S2R, как работает), остальное → 0.2-0.9.

---

## Детектирование антипаттернов

### Автоматическая проверка

ИИ-агенты проверяют:
1. ✅ АП-1: Один SoI на ядро
2. ✅ АП-2, АП-3: Правильные отношения (∋, →)
3. ✅ АП-4: Реальные имена (не Target-System)
4. ✅ АП-5: Английские роли
5. ✅ АП-6: 9 папок в ядре
6. ✅ АП-10: Наличие Frontmatter
7. ✅ АП-11: Соответствие семейства и аудитории
8. ✅ АП-12: Соответствие Frontmatter и пути
9. ✅ АП-13: Наличие target_audience
10. ✅ АП-17: Битые ссылки

**Отчёты**: `0.OPS/0.4.AI-Reports/anti-patterns/`

### Ручная проверка

Ревьюер проверяет:
- АП-7, АП-8: Правильное именование
- АП-14: Дублирование знаний
- АП-15, АП-16: Логичность связей
- АП-18, АП-19, АП-20: Процессы
- АП-21, АП-22: F0 мета-уровень

**Процесс**: Code review + ревью ИИ-агентом.

---

## Рефакторинг антипаттернов

### Приоритет исправлений

| Критичность | Антипаттерны | Действие |
|-------------|--------------|----------|
| **CRITICAL** | АП-1, АП-2, АП-3 | Исправить немедленно (структура нарушена) |
| **HIGH** | АП-10, АП-11, АП-13 | Исправить в течение недели (метаданные) |
| **MEDIUM** | АП-6, АП-7, АП-12 | Исправить в течение месяца (техдолг) |
| **LOW** | АП-8, АП-9, АП-20 | Исправить по возможности (качество) |

### Массовый рефакторинг

**Инструменты**:
- `.ops/normalize_content.py` — нормализация структуры
- `.ops/deduplicate_content.py` — удаление дубликатов
- `.ops/validate_classifications.py` — валидация метаданных

**Процесс**:
1. Создать ветку `refactor/fix-anti-patterns`
2. Запустить автоматические скрипты
3. Проверить результат
4. Code review
5. Merge в main

---

## См. также

- [[04-ontology.md]] — правила композиции (Rules 1-5)
- [[06-taxonomy.md]] — правила классификации
- [[07-naming.md]] — правила именования
- [[09-examples-library.md]] — правильные примеры (противоположность антипаттернам)
- [[../0.6.Repository-Processes/validation.md]] — процесс валидации

---
type: doc
status: draft
created: 2026-01-13
layer: methodology
scope: local-edge
audience: 
  - "Команда экосистемы"
  - "ИИ-агенты"
  - "Разработчики платформы"
---

# Описание процесса создания продуктов из знаний 0.9

## 0. Назначение документа

Этот документ описывает **сквозной процесс** преобразования первичного контента участников экосистемы в информационные продукты через последовательность этапов: сбор → нормализация → индексация → извлечение контекста → генерация продукта.

Процесс объединяет несколько систем и хранилищ в единый поток создания ценности из знаний.

---

## 1. Общая схема процесса

### 1.1. Поток рабочих продуктов и действий

```
┌─────────────────────────────────────────────────────────────────┐
│                    ПОЛЬЗОВАТЕЛЬ (участник)                       │
└─────────────────────────────────────────────────────────────────┘
         │ 
         │ создаёт контент
         ▼
┌─────────────────────────────────────────────────────────────────┐
│  РП-1: ПЕРВИЧНЫЙ КОНТЕНТ                                        │
│  Хранилище: Клуб, LMS, Telegram (до сбора)                      │
└─────────────────────────────────────────────────────────────────┘
         │
         │ импорт через API / ручной ввод
         │ [Индексатор знаний → Сборщик]
         ▼
┌─────────────────────────────────────────────────────────────────┐
│  РП-2: ПЕРВИЧНЫЙ КОНТЕНТ В РЕПОЗИТОРИИ                          │
│  Хранилище: Репозиторий знаний (2.3) — personal-knowledge       │
│             GitHub-репозиторий, раздел /raw или /primary        │
└─────────────────────────────────────────────────────────────────┘
         │
         │ разбивка на фрагменты, присвоение ID, добавление метаданных
         │ [Индексатор знаний → Нормализатор]
         ▼
┌─────────────────────────────────────────────────────────────────┐
│  РП-3: НОРМАЛИЗОВАННЫЕ ЧАНКИ                                    │
│  Хранилище: Репозиторий знаний (2.3) — personal-knowledge       │
│             GitHub-репозиторий, структура: club/, lms/, manual/ │
└─────────────────────────────────────────────────────────────────┘
         │
         │ векторизация текста (embedding)
         │ [Индексатор знаний → Индексатор]
         ▼
┌─────────────────────────────────────────────────────────────────┐
│  РП-4: ИНДЕКС ЗНАНИЙ                                            │
│  Хранилище: База эмбеддингов (2.4) — векторное хранилище       │
│             (Pinecone / Weaviate / Qdrant)                       │
│             Доступ: через MCP-серверы                            │
└─────────────────────────────────────────────────────────────────┘
         │
         │ семантический + лексический поиск, переранжирование
         │ [Сборщик контекста → Ретривер + Реранкер + Компрессор]
         ▼
┌─────────────────────────────────────────────────────────────────┐
│  РП-5: ДИНАМИЧЕСКИЙ КОНТЕКСТ (пакет контекста)                  │
│  Хранилище: Оперативная память (временный объект)                │
│             Формат: JSON/структура в памяти                      │
└─────────────────────────────────────────────────────────────────┘
         │
         │ генерация через LLM с использованием промпт-шаблонов
         │ [Генератор продукта → Guide/Post/Concept/Spec Writer]
         ▼
┌─────────────────────────────────────────────────────────────────┐
│  РП-6: ЧЕРНОВИК ПРОДУКТА                                        │
│  Хранилище: Оперативная память / временное хранилище            │
└─────────────────────────────────────────────────────────────────┘
         │
         │ проверка фактов, полноты, стиля
         │ [Оценщик качества → Grounding/Completeness/Style Checker]
         ▼
┌─────────────────────────────────────────────────────────────────┐
│  РП-7: ФИНАЛЬНЫЙ ПРОДУКТ                                        │
│  Хранилище: Целевое (Клуб, соцсети, документы)                  │
└─────────────────────────────────────────────────────────────────┘
         │
         │ доставка пользователю
         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ПОЛЬЗОВАТЕЛЬ (участник)                       │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2. Карта систем и хранилищ

```
╔═══════════════════════════════════════════════════════════════════╗
║                      ХРАНИЛИЩА ДАННЫХ                             ║
╚═══════════════════════════════════════════════════════════════════╝

┌──────────────────┐  ┌──────────────────────────┐  ┌──────────────┐
│ Клуб, LMS,       │  │ Репозиторий знаний (2.3) │  │ База         │
│ Telegram         │  │ personal-knowledge (Git) │  │ эмбеддингов  │
│                  │  │                          │  │ (2.4)        │
│ РП-1:            │  │ РП-2: /raw (первичка)    │  │              │
│ Первичный        │  │ РП-3: /club, /lms,       │  │ РП-4:        │
│ контент          │  │       /manual (чанки)    │  │ Индекс       │
│                  │  │                          │  │ знаний       │
└────────┬─────────┘  └───────────┬──────────────┘  └──────┬───────┘
         │                        ▲                         ▲
         │ API                    │ Git push               │ API
         │                        │                         │
         └───────────┐            │           ┌─────────────┘
                     │            │           │
╔═══════════════════════════════════════════════════════════════════╗
║                        СИСТЕМЫ ОБРАБОТКИ                          ║
╚═══════════════════════════════════════════════════════════════════╝

    ┌────────────────────────────────────────────────────┐
    │   ИНДЕКСАТОР ЗНАНИЙ (Knowledge Indexer)            │
    │   ИИ-агент 3.2.5                                   │
    ├────────────────────────────────────────────────────┤
    │                                                    │
    │   ┌──────────────┐    ┌──────────────┐           │
    │   │  Сборщик     │ →  │ Нормализатор │           │
    │   │  (Collector) │    │  (Chunker)   │           │
    │   └──────────────┘    └──────────────┘           │
    │         ↓                     ↓                    │
    │   РП-1 → РП-2            РП-2 → РП-3              │
    │                                                    │
    │   ┌──────────────┐    ┌──────────────┐           │
    │   │  Индексатор  │    │Синхронизатор │           │
    │   │  (Embedder)  │    │ (Watcher)    │           │
    │   └──────────────┘    └──────────────┘           │
    │         ↓                                          │
    │   РП-3 → РП-4                                     │
    │                                                    │
    └────────────────────────────────────────────────────┘
                            │
                            │ через MCP
                            ▼
    ┌────────────────────────────────────────────────────┐
    │   СБОРЩИК КОНТЕКСТА (Context Builder)              │
    │   ИИ-система 3.2                                   │
    ├────────────────────────────────────────────────────┤
    │                                                    │
    │   ┌──────────────┐    ┌──────────────┐           │
    │   │  Ретривер    │ →  │  Реранкер    │           │
    │   │ (Retriever)  │    │  (Reranker)  │           │
    │   └──────────────┘    └──────────────┘           │
    │         │                     ↓                    │
    │         │              ┌──────────────┐           │
    │         │           →  │ Компрессор   │           │
    │         │              │ (Compressor) │           │
    │         │              └──────────────┘           │
    │         ↓                     ↓                    │
    │   РП-4 + запрос → РП-5                            │
    │                                                    │
    └────────────────────────────────────────────────────┘
                            │
                            │ пакет контекста
                            ▼
    ┌────────────────────────────────────────────────────┐
    │   ГЕНЕРАТОР ПРОДУКТА (Product Generator)           │
    │   ИИ-ассистент 3.2.4                               │
    ├────────────────────────────────────────────────────┤
    │                                                    │
    │   Guide Writer  │  Post Writer   │  Concept Writer│
    │   Spec Writer   │  Curriculum    │  ...           │
    │                                                    │
    │   РП-5 + промпты → РП-6                            │
    │                                                    │
    └────────────────────────────────────────────────────┘
                            │
                            │ черновик
                            ▼
    ┌────────────────────────────────────────────────────┐
    │   ОЦЕНЩИК КАЧЕСТВА (Quality Checker)               │
    │   ИИ-система 3.2                                   │
    ├────────────────────────────────────────────────────┤
    │                                                    │
    │   Grounding    │  Completeness  │  Style          │
    │   Checker      │  Checker       │  Checker        │
    │                                                    │
    │   РП-6 + РП-5 → РП-7                               │
    │                                                    │
    └────────────────────────────────────────────────────┘
                            │
                            │ финальный продукт
                            ▼
                      ПОЛЬЗОВАТЕЛЬ
```

### 1.3. Связь рабочих продуктов с хранилищами

| РП | Название | Хранилище | Путь/Доступ | Забирается системой |
|----|----------|-----------|-------------|---------------------|
| РП-1 | Первичный контент | Клуб, LMS, Telegram | API endpoints | Индексатор → Сборщик |
| РП-2 | Первичный контент в репо | Репозиторий знаний (2.3) | `/raw` или `/primary` | Индексатор → Нормализатор |
| РП-3 | Нормализованные чанки | Репозиторий знаний (2.3) | `/club`, `/lms`, `/manual` | Индексатор → Индексатор |
| РП-4 | Индекс знаний | База эмбеддингов (2.4) | Векторное хранилище (Pinecone/Weaviate/Qdrant), доступ через MCP | Сборщик контекста → Ретривер |
| РП-5 | Динамический контекст | Оперативная память | JSON-структура в памяти процесса | Генератор продукта |
| РП-6 | Черновик продукта | Оперативная память / временное хранилище | В памяти или `/tmp` | Оценщик качества |
| РП-7 | Финальный продукт | Целевые платформы | Клуб/соцсети/документы | Пользователь |
```

---

## 2. Рабочие продукты (артефакты)

### 2.1. РП-1: Первичный контент

**Что это:**
Исходные текстовые материалы, создаваемые участником экосистемы в различных системах.

**Типы:**
- Посты в Клубе
- Комментарии под постами других участников
- Ответы на домашние задания в LMS
- Комментарии к ДЗ других участников
- Личные заметки в Telegram
- Рефлексии
- Проектная документация

**Характеристики:**
- Формат: текст (markdown, plain text, HTML)
- Размер: любой (от нескольких слов до статей)
- Структура: произвольная, зависит от источника
- Версионирование: нет (до попадания в репозиторий)

**Место хранения (до сбора):**
- Клуб (Circle/Discourse)
- LMS
- Telegram
- Другие источники

### 2.2. РП-2: Первичный контент в репозитории

**Что это:**
Первичный контент после сбора, но до нормализации.

**Характеристики:**
- Сохраняет исходную структуру источника
- Хранится в Git (версионируется)
- Ещё не разбит на чанки
- Может быть любого размера

**Место хранения:**
- Репозиторий знаний (2.3): https://github.com/aisystant/personal-knowledge
- Промежуточная зона до обработки

### 2.3. РП-3: Нормализованные чанки

**Что это:**
Единицы хранения знаний — markdown-файлы с метаданными.

**Характеристики:**
- **Размер:** до 10 000 знаков основного текста (без истории изменений)
- **Формат:** Markdown с YAML frontmatter
- **ID:** `chunk_YYYYMMDD_NNN` (уникальный идентификатор)
- **Метаданные frontmatter:**
  - `id` — уникальный идентификатор
  - `source` — источник (club/posts, lms/homework, manual/notes и т.д.)
  - `type` — тип контента (post, comment, homework-review, note, reflection и т.д.)
  - `created` — дата создания (ISO8601)
  - `updated` — дата последнего изменения (ISO8601)
  - `author` — автор
  - `tags` — список тегов
  - `word_count` — количество слов
  - `char_count` — количество символов (макс 10000)
  - `related_chunks` — связанные чанки
  - `original_url` — URL источника (если есть)
  - `context` — краткое описание контекста

**Структура файла:**
```markdown
---
id: chunk_20260113_042
source: club/posts
type: post
created: 2026-01-13T10:30:00Z
updated: 2026-01-13T10:30:00Z
author: Участник
tags: [системное мышление, архитектура]
word_count: 450
char_count: 2850
related_chunks: [chunk_20260112_015]
original_url: https://club.aisystant.com/posts/12345
context: Размышления об архитектуре хранилищ знаний
---

# Заголовок чанка

Основной текст (до 10 000 знаков)...

---
<!-- EMBEDDINGS_EXCLUDE_START -->
## История изменений

### 2026-01-13 10:30 - Создание
- Импортировано из Клуба
<!-- EMBEDDINGS_EXCLUDE_END -->
```

**Место хранения:**
- Репозиторий знаний (2.3): https://github.com/aisystant/personal-knowledge
- Структура папок: `club/`, `lms/`, `manual/`, `external/`

**Возможность редактирования:**
- Пользователь может вручную редактировать чанки
- Все изменения фиксируются в секции "История изменений"
- История находится между маркерами `<!-- EMBEDDINGS_EXCLUDE_START -->` и `<!-- EMBEDDINGS_EXCLUDE_END -->`
- История не учитывается при индексации

### 2.4. РП-4: Индекс знаний

**Что это:**
Совокупность структур для быстрого поиска релевантных чанков.

**Компоненты:**
1. **Векторный индекс (эмбеддинги):**
   - Векторные представления чанков
   - Размерность: зависит от модели эмбеддингов (например, 1536 для OpenAI ada-002)
   - Связь: chunk_id → вектор
   - Метаданные для фильтрации (tags, source, type, created)

2. **Лексический индекс (опционально):**
   - BM25 или аналог
   - Для точных совпадений ключевых слов

3. **Метаиндекс:**
   - Реестр всех чанков
   - Версия индекса
   - Timestamp последнего обновления

**Характеристики:**
- Обновляется при изменении чанков
- Версионируется (index_version)
- Поддерживает инкрементальное обновление

**Место хранения:**
- База эмбеддингов (2.4) — векторное хранилище (Pinecone, Weaviate, Qdrant и т.п.)
- Доступ через MCP-серверы (fsm-mcp, digital-twin-mcp)

### 2.5. РП-5: Динамический контекст (пакет контекста)

**Что это:**
Подборка релевантных чанков для конкретного запроса.

**Характеристики:**
- Формируется динамически для каждого запроса
- Содержит N наиболее релевантных чанков (N зависит от budget токенов)
- Включает трассировку: почему каждый чанк выбран
- Компрессирован для соответствия ограничениям LLM

**Структура:**
```json
{
  "query": "как организовать хранилище знаний",
  "timestamp": "2026-01-13T12:00:00Z",
  "index_version": "v1.42",
  "chunks": [
    {
      "chunk_id": "chunk_20260110_023",
      "relevance_score": 0.92,
      "retrieval_method": "vector",
      "rerank_score": 0.88,
      "text": "Текст чанка...",
      "source": "club/posts",
      "url": "https://github.com/user/knowledge-repo/blob/main/club/posts/chunk_20260110_023.md",
      "context": "Описание структуры репозитория знаний"
    }
  ],
  "total_tokens": 2850,
  "compression_ratio": 0.65
}
```

**Требования к качеству:**
- Каждый чанк имеет явный source pointer (путь к файлу/URL)
- Есть обоснование выбора (retrieval rationale)
- Соблюдён budget контекста (не превышает лимит токенов LLM)
- Воспроизводимость: один запрос при той же версии индекса → близкий набор чанков

### 2.6. РП-6: Черновик продукта

**Что это:**
Сгенерированный ИИ-системой продукт до проверки качества.

**Характеристики:**
- Создан на основе пакета контекста
- Включает цитаты с указанием источников (chunk_id)
- Соответствует шаблону продукта (из библиотеки промптов)
- Может содержать ошибки или неточности

**Формат:**
```markdown
---
product_type: personal_guide
topic: Организация хранилища знаний
audience: Участник экосистемы
generated: 2026-01-13T12:15:00Z
context_version: v1.42
---

# Персональное руководство: Организация хранилища знаний

## Введение

Хранилище знаний — это... [chunk_20260110_023]

...
```

### 2.7. РП-7: Финальный продукт

**Что это:**
Проверенный и готовый к использованию информационный продукт.

**Типы продуктов:**
1. **Персональные руководства** — пошаговые инструкции для участника на основе его знаний
2. **Посты** — контент для Клуба, соцсетей, блога
3. **Концепции** — описания систем, подходов, методологий
4. **Технические задания** — спецификации для разработки
5. **Маркетинговые материалы** — описания продуктов, лендинги
6. **Структуры курсов** — программы обучения, сценарии занятий
7. **ADR** — архитектурные решения
8. **Спецификации** — технические описания компонентов

**Характеристики:**
- Прошёл проверку качества (Quality Checker)
- Факты заземлены на источники (grounding)
- Соответствует спецификации продукта
- Включает отчёт о качестве
- Готов к публикации или использованию

---

## 3. Системы и подсистемы

### 3.1. Индексатор знаний (Knowledge Indexer)

**Тип:** ИИ-агент  
**Расположение в архитектуре:** 3.2.5. ИИ-агенты  
**Документация:** [[ИИ-агент Индексатор знаний 3.2]]

**Назначение:**
Выполняет полный цикл преобразования первичного контента в индекс знаний.

**Подсистемы:**

#### 3.1.1. Сборщик (Collector)
- **Вход:** Первичный контент из различных источников
- **Действия:**
  - Автоматический сбор из Клуба (API)
  - Автоматический сбор из LMS (API)
  - Сбор из Telegram (Bot API)
  - Ручной импорт пользователем (через интерфейс)
- **Выход:** Первичный контент в репозитории (РП-2)

#### 3.1.2. Нормализатор (Normalizer / Chunker)
- **Вход:** Первичный контент в репозитории (РП-2)
- **Действия:**
  - Автоматическое чанкование:
    - Если контент < 10k знаков → создаёт 1 чанк
    - Если контент > 10k знаков → делит на N чанков
  - Присвоение уникального ID (chunk_YYYYMMDD_NNN)
  - Создание YAML frontmatter с метаданными
  - Создание секции "История изменений" (EMBEDDINGS_EXCLUDE)
  - Определение границ чанков (семантические разрывы, параграфы)
  - Ручное чанкование пользователем (через интерфейс редактирования)
- **Выход:** Нормализованные чанки (РП-3)

#### 3.1.3. Индексатор (Embedder / Indexer)
- **Вход:** Нормализованные чанки (РП-3)
- **Действия:**
  - Извлечение текста чанков (игнорируя EMBEDDINGS_EXCLUDE)
  - Создание векторных представлений (эмбеддингов) через модель эмбеддингов
  - Сохранение эмбеддингов в векторное хранилище
  - Связывание chunk_id с эмбеддингом
  - (Опционально) Создание лексического индекса (BM25)
  - Версионирование индекса
  - Инкрементальное обновление при изменении чанков
- **Выход:** Индекс знаний (РП-4)

#### 3.1.4. Синхронизатор (Synchronizer)
- **Вход:** Изменения в чанках (Git commits)
- **Действия:**
  - Отслеживание изменений в репозитории (Git hooks / webhooks)
  - Определение изменённых/новых/удалённых чанков
  - Запуск переиндексации для изменённых чанков
  - Удаление эмбеддингов для удалённых чанков
  - Обновление версии индекса
- **Выход:** Актуальный индекс знаний (РП-4)

**Технологии:**
- Модели эмбеддингов: OpenAI text-embedding-ada-002, Voyage, Cohere и др.
- Векторное хранилище: Pinecone, Weaviate, Qdrant, Chroma
- MCP-серверы для доступа к хранилищам

### 3.2. Сборщик контекста (Context Builder)

**Тип:** ИИ-система (компонент платформы)  
**Расположение в архитектуре:** 3.2. Архитектура — Платформа и подсистемы

**Назначение:**
Извлекает релевантные чанки из индекса знаний и формирует динамический контекст для генерации продуктов.

**Подсистемы:**

#### 3.2.1. Ретривер (Retriever)
- **Вход:** 
  - Запрос на продукт (query)
  - Индекс знаний (РП-4)
- **Действия:**
  - **Векторный поиск:** семантический поиск через эмбеддинги
  - **Лексический поиск (BM25):** точные совпадения ключевых слов
  - **Гибридное извлечение:** комбинация векторного + лексического
  - Фильтрация по метаданным (tags, source, type, date range)
  - Получение топ-K кандидатов (K = 20-50)
- **Выход:** Список кандидатов (чанки + scores)

#### 3.2.2. Реранкер (Reranker)
- **Вход:** Список кандидатов от ретривера
- **Действия:**
  - Более точное ранжирование с помощью cross-encoder модели
  - Учёт контекста запроса и содержания чанка
  - Удаление дубликатов и слабо релевантных чанков
  - Отбор топ-N наиболее релевантных (N = 5-15)
- **Выход:** Переранжированный список чанков

#### 3.2.3. Компрессор контекста (Context Compressor)
- **Вход:** 
  - Переранжированные чанки
  - Budget токенов (лимит LLM)
- **Действия:**
  - Подсчёт токенов для каждого чанка
  - Отбор чанков в пределах budget
  - (Опционально) Компрессия текста чанков (удаление избыточности)
  - Добавление трассировки источников
  - Формирование итогового пакета контекста
- **Выход:** Динамический контекст / пакет контекста (РП-5)

**Технологии:**
- Векторный поиск: Pinecone, Weaviate, Qdrant API
- BM25: Elasticsearch, custom implementation
- Reranking models: Cohere Rerank, Jina Reranker, cross-encoders
- MCP-серверы для доступа к индексу

### 3.3. Генератор продукта (Product Generator)

**Тип:** ИИ-ассистент (семейство ассистентов)  
**Расположение в архитектуре:** 3.2.4. ИИ-ассистенты

**Назначение:**
Создаёт информационные продукты на основе динамического контекста.

**Подсистемы (типы генераторов):**

#### 3.3.1. Генератор руководств (Guide Writer)
- **Назначение:** Создание персональных руководств для участников
- **Вход:** Пакет контекста + спецификация руководства
- **Промпт-шаблон:** Системный промпт для руководств
- **Выход:** Черновик персонального руководства

#### 3.3.2. Генератор постов (Post Writer)
- **Назначение:** Создание постов для Клуба, соцсетей, блога
- **Вход:** Пакет контекста + требования к посту (тон, длина, аудитория)
- **Промпт-шаблон:** Системный промпт для постов
- **Выход:** Черновик поста

#### 3.3.3. Генератор концепций (Concept Writer)
- **Назначение:** Создание описаний систем, подходов, методологий
- **Вход:** Пакет контекста + шаблон концепции
- **Промпт-шаблон:** Системный промпт для концепций
- **Выход:** Черновик концепции

#### 3.3.4. Генератор ТЗ (Spec Writer)
- **Назначение:** Создание технических заданий, спецификаций
- **Вход:** Пакет контекста + требования к ТЗ
- **Промпт-шаблон:** Системный промпт для ТЗ
- **Выход:** Черновик ТЗ

**Общие действия для всех генераторов:**
- Получение пакета контекста (РП-5)
- Получение спецификации продукта (из библиотеки спецификаций)
- Получение промпт-шаблона (из библиотеки промптов)
- Генерация черновика с использованием LLM
- Включение цитат с указанием chunk_id
- Добавление метаданных генерации
- Сохранение черновика (РП-6)

**Технологии:**
- LLM: GPT-4, Claude 3.5, Gemini и др.
- Библиотека промптов: хранится в репозитории знаний
- Библиотека спецификаций продуктов: шаблоны для разных типов

### 3.4. Оценщик качества (Quality Checker)

**Тип:** ИИ-система (компонент платформы)  
**Расположение в архитектуре:** 3.2. Архитектура — Платформа и подсистемы

**Назначение:**
Проверяет качество сгенерированного продукта перед публикацией.

**Подсистемы:**

#### 3.4.1. Проверка заземления (Grounding Checker)
- **Вход:** Черновик продукта (РП-6) + пакет контекста (РП-5)
- **Действия:**
  - Проверка каждого утверждения на соответствие источникам
  - Выявление галлюцинаций (утверждений без опоры на источники)
  - Проверка корректности цитат и ссылок (chunk_id)
  - Оценка степени заземления (grounding score)
- **Выход:** Отчёт о заземлении

#### 3.4.2. Проверка полноты (Completeness Checker)
- **Вход:** Черновик продукта + спецификация продукта
- **Действия:**
  - Проверка соответствия структуре (все разделы присутствуют)
  - Проверка полноты раскрытия темы
  - Выявление пропущенных важных аспектов
- **Выход:** Отчёт о полноте

#### 3.4.3. Проверка стиля (Style Checker)
- **Вход:** Черновик продукта + требования к стилю
- **Действия:**
  - Проверка тона (формальный, дружелюбный и т.д.)
  - Проверка ясности изложения
  - Проверка соответствия целевой аудитории
  - Грамматика и орфография
- **Выход:** Отчёт о стиле

#### 3.4.4. Интегратор отчётов (Report Integrator)
- **Вход:** Отчёты от всех проверок
- **Действия:**
  - Объединение всех отчётов в единый
  - Определение общей оценки качества
  - Формирование рекомендаций по исправлению
  - (Опционально) Автоматическое исправление простых ошибок
- **Выход:** 
  - Финальный отчёт о качестве
  - Финальный продукт (РП-7) (если качество приемлемо)

**Технологии:**
- LLM для проверок: GPT-4, Claude
- Специализированные модели для grounding
- Инструменты для проверки стиля и грамматики

---

## 4. Хранилища данных

### 4.1. Репозиторий знаний (Knowledge Repository) — (2.3)

**Тип:** Git-репозиторий (GitHub)  
**URL:** https://github.com/aisystant/personal-knowledge  
**Документация:** [[Репозиторий знаний - структура и задание]]

**Содержит:**
- Первичный контент (после сбора)
- Нормализованные чанки
- Metadata (метаданные)
- Библиотека промптов
- Спецификации продуктов

**Структура:**
```
knowledge-repository/
├── club/                  # Контент из Клуба
│   ├── posts/
│   └── comments/
├── lms/                   # Контент из LMS
│   ├── homework-reviews/
│   └── my-homework/
├── manual/                # Ручные добавления
│   ├── notes/
│   ├── reflections/
│   └── projects/
├── external/              # Импорт из других репо
├── metadata/              # Метаданные
├── prompts/               # Библиотека промптов
└── specs/                 # Спецификации продуктов
```

**Версионирование:** Git (полная история изменений)

### 4.2. База эмбеддингов (Vector Store) — (2.4)

**Тип:** Векторное хранилище  
**Технологии:** Pinecone, Weaviate, Qdrant, Chroma

**Содержит:**
- Векторные представления чанков (эмбеддинги)
- Метаданные для фильтрации
- Версия индекса

**Доступ:**
- Через MCP-серверы: fsm-mcp, digital-twin-mcp
- API векторного хранилища

**Операции:**
- Векторный поиск (similarity search)
- Фильтрация по метаданным
- Инкрементальное обновление
- Удаление устаревших эмбеддингов

### 4.3. Лексический индекс (Text Index) — опционально

**Тип:** Поисковая система  
**Технологии:** Elasticsearch, custom BM25

**Содержит:**
- Инвертированный индекс терминов
- TF-IDF статистики
- Связь с chunk_id

**Назначение:**
- Точный поиск по ключевым словам
- Гибридное извлечение (вместе с векторным поиском)

---

## 5. Ключевые процессы

### 5.1. Процесс индексации (Offline / Batch)

**Триггер:** 
- Новый контент в источниках (Клуб, LMS, Telegram)
- Ручной импорт пользователем
- Изменение существующих чанков (Git commit)

**Шаги:**

1. **Сбор** (Индексатор → Сборщик)
   - Автоматический: API Клуба/LMS/Telegram
   - Ручной: UI для импорта
   - Сохранение в репозиторий знаний (РП-2)

2. **Нормализация** (Индексатор → Нормализатор)
   - Автоматическое чанкование
   - Присвоение ID и метаданных
   - Сохранение чанков (РП-3)

3. **Индексация** (Индексатор → Индексатор)
   - Извлечение текста чанков
   - Создание эмбеддингов
   - Сохранение в векторное хранилище (РП-4)

4. **Синхронизация** (Индексатор → Синхронизатор)
   - Отслеживание изменений
   - Переиндексация изменённых чанков
   - Обновление версии индекса

**Частота:** 
- Автоматический сбор: каждые N часов (настраиваемо)
- Синхронизация: при каждом Git push

### 5.2. Процесс генерации продукта (Online)

**Триггер:**
- Запрос пользователя через ИИ-ассистента
- Запрос от другой системы (API)

**Шаги:**

1. **Получение запроса**
   - Тип продукта (руководство, пост, концепция и т.д.)
   - Тема
   - Аудитория
   - Ограничения (длина, тон, дедлайн)

2. **Извлечение контекста** (Сборщик контекста)
   - Ретривер: векторный + лексический поиск → кандидаты
   - Реранкер: переранжирование → топ-N чанков
   - Компрессор: сборка пакета контекста (РП-5)

3. **Генерация черновика** (Генератор продукта)
   - Выбор промпт-шаблона
   - Выбор спецификации продукта
   - Генерация через LLM → черновик (РП-6)

4. **Проверка качества** (Оценщик качества)
   - Проверка заземления
   - Проверка полноты
   - Проверка стиля
   - Интеграция отчётов

5. **Финализация**
   - Если качество OK → финальный продукт (РП-7)
   - Если нет → возврат на шаг 3 с корректировками

6. **Доставка пользователю**
   - Предоставление продукта пользователю
   - (Опционально) Публикация в Клуб/соцсети

**Время выполнения:** Несколько секунд до минуты (зависит от сложности)

---

## 6. Требования к качеству процесса

### 6.1. Динамический контекст

Динамический контекст считается корректным, если:

- ✅ Каждый чанк имеет **явный source pointer** (path/URL/chunk_id)
- ✅ Есть **retrieval rationale** — объяснение, почему этот чанк выбран
- ✅ Соблюдён **budget контекста** (не превышает лимит токенов LLM)
- ✅ Не потеряны ключевые тезисы при компрессии
- ✅ **Воспроизводимость**: один запрос при той же версии индекса → близкий набор чанков
- ✅ **Разнообразие**: чанки покрывают разные аспекты темы (не дубликаты)

### 6.2. Финальный продукт

Финальный продукт считается качественным, если:

- ✅ **Заземлён**: все утверждения опираются на источники (чанки)
- ✅ **Полон**: раскрывает тему согласно спецификации
- ✅ **Стилистически корректен**: соответствует тону и аудитории
- ✅ **Цитирован**: включает ссылки на источники (chunk_id или URL)
- ✅ **Без галлюцинаций**: нет выдуманных фактов
- ✅ **Воспроизводим**: при том же контексте и промпте → похожий результат

### 6.3. Индекс знаний

Индекс знаний считается актуальным, если:

- ✅ **Синхронизирован**: отражает последние изменения в репозитории (не старше N часов)
- ✅ **Версионирован**: есть `index_version` и timestamp
- ✅ **Полон**: все чанки из репозитория проиндексированы
- ✅ **Консистентен**: chunk_id в индексе соответствует chunk_id в репозитории

---

## 7. Минимальный SoTA-апгрейд (рекомендуемый)

Чтобы качество процесса было ближе к state-of-the-art practice, рекомендуется добавить:

### 7.1. Гибридное извлечение + переранжирование (обязательно)

- ✅ **Hybrid retrieval**: векторный поиск + BM25 (лексический)
- ✅ **Reranking**: cross-encoder модель для точного ранжирования (Cohere Rerank, Jina Reranker)

### 7.2. Стратегия чанкования (обязательно)

- ✅ **Фиксированная политика chunking**:
  - Размер: 512-1024 токена (или до 10k знаков)
  - Перекрытие (overlap): 10-20%
  - Семантические границы: параграфы, разделы
- ✅ Документирование выбранной стратегии

### 7.3. Продвинутые методы (опционально)

- ⚪ **Late interaction retrieval**: ColBERT/ColBERTv2 для более точного поиска
- ⚪ **Query augmentation**: HyDE (Hypothetical Document Embeddings) для сложных запросов
- ⚪ **Контекстная компрессия**: LLMLingua или аналоги для сжатия контекста без потери смысла
- ⚪ **Observability**: логирование всех этапов (query → chunks → product → quality)

---

## 8. Связанные документы

- [[Репозиторий знаний - структура и задание]] — детальное описание структуры репозитория
- [[ИИ-агент Индексатор знаний 3.2]] — описание Индексатора знаний
- [[3.2.6. Хранилища данных/README]] — обзор всех хранилищ экосистемы
- [[Структура хранилища 0.1]] — структура текущего хранилища ecosystem-development
- [[О разделе 3.0]] — обзор раздела об экосистеме развития

---

## 9. История изменений

### 2026-01-13 — Создание v0.1
- Первая версия документа
- Описаны все рабочие продукты (РП-1 — РП-7)
- Описаны все системы и подсистемы
- Добавлены процессы индексации и генерации
- Добавлены требования к качеству
- Добавлены рекомендации по SoTA-апгрейду

---

**Статус:** Draft  
**Версия:** 0.1  
**Дата создания:** 2026-01-13  
**Целевая аудитория:** Команда экосистемы, разработчики платформы, ИИ-агенты

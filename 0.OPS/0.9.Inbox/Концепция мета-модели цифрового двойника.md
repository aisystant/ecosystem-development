---
title: Концепция мета-модели цифрового двойника
type: doc
status: draft
created: 2026-02-01
layer: methodology
scope: core-infrastructure
audience:
  - "Команда экосистемы"
  - "Разработчики платформы"
  - "Методологи"
related_documents:
  - "C2.2.Architecture/3.2.3.1. Цифровой двойник/Модель данных цифрового двойника 3.2.md"
  - "C2.2.Architecture/3.2.3.1. Цифровой двойник/MCP-сервер цифрового двойника 3.2.md"
  - "Реестр мета-модели цифрового двойника.md"
---

# Концепция мета-модели цифрового двойника

> **Версия:** 0.2

## 1. Назначение

### 1.1. Что такое мета-модель?

**Мета-модель** — это описание структуры данных цифрового двойника (`PRS.Twin`):
- Какие показатели существуют (коды, названия)
- Какие у них типы и форматы (float, enum, list)
- Пороги по ступеням Ученика
- Связи между показателями
- Правила использования в промптах

**Цифровой двойник** — это набор конкретных данных о человеке, соответствующий мета-модели.

```
Мета-модель (schema)              →    Данные (values)
────────────────────────────────────────────────────────
IND.2.1.1: float, часы/неделю     →    3.5 (для user_123)
IND.2.4.2: enum[5 ступеней]       →    "Систематический"
IND.1.5.1: list[pomodoro]         →    [{date, duration}, ...]
```

### 1.2. Зачем нужна мета-модель?

**Проблема:** Существующая [[Модель данных цифрового двойника 3.2]] описывает *какие* показатели есть, но не описывает:
- Машиночитаемые форматы для валидации
- Пороги по ступеням для автоматической квалификации
- Связи между показателями
- Правила использования в промптах

**Решение:** Мета-модель добавляет слой описаний поверх модели данных:

```
┌─────────────────────────────────────────────────────────────┐
│  Мета-модель                                                │
│  - Концепция (этот документ)                                │
│  - Реестр показателей (отдельный документ)                  │
│  - Пороги, форматы, связи                                   │
├─────────────────────────────────────────────────────────────┤
│  Модель данных (существующий документ)                      │
│  - Список первичных данных (IND.1.*)                        │
│  - Список производных показателей (IND.2.*)                 │
├─────────────────────────────────────────────────────────────┤
│  Данные участников                                          │
│  - Конкретные значения в БД                                 │
│  - История изменений                                        │
└─────────────────────────────────────────────────────────────┘
```

### 1.3. Согласование с репозиторием

| Аспект | Принятое решение |
|--------|------------------|
| **Нотация показателей** | `IND.1.*` (первичные), `IND.2.*` (производные), `IND.1.PREF.*` (настройки) |
| **Терминология** | `PRS.Twin`, `STG.Student.*`, `AGT.RouteGuide` |
| **Ступени Ученика** | Случайный → Практикующий → Систематический → Дисциплинированный → Проактивный |

### 1.4. Разделение первичных данных и мета-модели

**Первичные данные (IND.1.1 — IND.1.11)** — это сырые данные из ИТ-систем (LMS, клуб, боты). Их полный перечень описан в [[Модель данных цифрового двойника 3.2]].

**Мета-модель** фокусируется на:
- **Настройках (IND.1.PREF.*)** — настраиваемые предпочтения человека
- **Производных показателях (IND.2.*)** — вычисляемые из первичных данных
- **Порогах для квалификации** — критерии переходов между ступенями

Первичные данные не требуют порогов и форматов мета-модели — они задаются схемой БД и ETL-процессами.

---

## 2. Гибридная архитектура хранения

### 2.1. Принцип: мета-модель в репозитории, данные в БД

```
ecosystem-development/                    ← Мета-модель (версионируется)
└── 0.OPS/.../
    ├── Концепция мета-модели...md       # Этот документ
    └── Реестр мета-модели...md          # Реестр показателей

digital-twin-storage/                     ← Данные (отдельная БД)
└── SurrealDB / PostgreSQL
    ├── persons/{user_id}/               # Данные по человеку
    │   ├── IND.2.1.1: 3.5
    │   ├── IND.2.4.2: "Систематический"
    │   └── ...
    └── history/                         # История изменений
```

### 2.2. Преимущества гибридной архитектуры

| Аспект | Мета-модель в репо | Данные в БД |
|--------|-------------------|-------------|
| **Версионирование** | Git history, PR review | Не нужно для каждого значения |
| **Редактирование** | Методологи через markdown | API/MCP для ИИ и систем |
| **Валидация** | CI/CD проверки схемы | Валидация по схеме из репо |
| **Доступ** | Публичный (open source) | Приватный (персональные данные) |

### 2.3. Почему не одно хранилище?

**Мета-модель (schema):**
- Редко меняется (при изменении методологии)
- Должна версионироваться с кодом
- Методологи редактируют через git

**Данные (values):**
- Часто меняются (ежедневно)
- Персональные данные требуют защиты
- ИИ-агенты читают/пишут через API

---

## 3. Один MCP-сервер с двумя группами tools

### 3.1. Архитектура

```
┌─────────────────────────────────────────────────────────────┐
│           MCP-сервер цифрового двойника                     │
│           (расширение существующего сервера)                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────┐    ┌─────────────────────┐        │
│  │   Группа META       │    │   Группа DATA       │        │
│  │   (мета-модель)     │    │   (данные)          │        │
│  ├─────────────────────┤    ├─────────────────────┤        │
│  │ describe_indicator  │    │ get_learner_summary │        │
│  │ list_indicators     │    │ get_learner_metrics │        │
│  │ get_stage_thresholds│    │ upsert_stage_eval   │        │
│  │ validate_value      │    │ read_indicator      │        │
│  │                     │    │ write_indicator     │        │
│  └──────────┬──────────┘    └──────────┬──────────┘        │
│             │                          │                    │
│             ▼                          ▼                    │
│  ┌─────────────────────┐    ┌─────────────────────┐        │
│  │   Репозиторий       │    │   База данных       │        │
│  │   (markdown/JSON)   │    │   (SurrealDB)       │        │
│  └─────────────────────┘    └─────────────────────┘        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2. Группа META — работа с мета-моделью

Инструменты для чтения структуры и описаний показателей.

#### `describe_indicator`

Возвращает полное описание показателя из мета-модели.

**Вход:**
```json
{
  "tool": "describe_indicator",
  "input": {"code": "IND.2.1.1"}
}
```

**Выход:**
```json
{
  "code": "IND.2.1.1",
  "name": "Среднее число часов саморазвития в неделю",
  "group": "2.1 Агентность и учебный ритм",
  "type": "temporal",
  "format": "float",
  "unit": "hours/week",
  "for_prompts": true,
  "for_qualification": true,
  "thresholds": {
    "STG.Student.Random": {"max": 0.5},
    "STG.Student.Practicing": {"min": 4},
    "STG.Student.Systematic": {"min": 6},
    "STG.Student.Disciplined": {"min": 8},
    "STG.Student.Proactive": {"min": 10}
  },
  "depends_on": ["IND.1.3.4", "IND.1.5.1"],
  "affects": ["IND.2.4.2", "IND.2.1.6"]
}
```

---

#### `list_indicators`

Возвращает список показателей по фильтру.

**Вход:**
```json
{
  "tool": "list_indicators",
  "input": {"group": "2.1", "for_qualification": true}
}
```

**Выход:**
```json
{
  "indicators": [
    {"code": "IND.2.1.1", "name": "Среднее число часов в неделю"},
    {"code": "IND.2.1.2", "name": "Доля дней со слотом"},
    {"code": "IND.2.1.6", "name": "Индекс регулярности"}
  ],
  "count": 3
}
```

---

#### `get_stage_thresholds`

Возвращает пороги показателей для конкретной ступени.

**Вход:**
```json
{
  "tool": "get_stage_thresholds",
  "input": {"stage": "STG.Student.Systematic"}
}
```

**Выход:**
```json
{
  "stage": "STG.Student.Systematic",
  "name": "Систематический",
  "period_weeks": 8,
  "thresholds": [
    {"code": "IND.2.1.1", "name": "Часы в неделю", "min": 6},
    {"code": "IND.2.1.2", "name": "Доля дней со слотом", "min": 0.71}
  ]
}
```

---

#### `validate_value`

Проверяет значение на соответствие формату и порогам.

**Вход:**
```json
{
  "tool": "validate_value",
  "input": {"code": "IND.2.1.1", "value": 5.5, "target_stage": "STG.Student.Systematic"}
}
```

**Выход:**
```json
{
  "valid": true,
  "format_ok": true,
  "threshold_check": {
    "target_stage": "STG.Student.Systematic",
    "required_min": 6,
    "meets_threshold": false,
    "gap": 0.5,
    "message": "Не хватает 0.5 часов для Систематического"
  }
}
```

---

### 3.3. Группа DATA — работа с данными

Расширяет существующий [[MCP-сервер цифрового двойника 3.2]].

#### Существующие tools (из 3.2):
- `get_learner_summary` — сводка по ученику
- `get_learner_core_metrics` — ядро показателей
- `upsert_learner_stage_evaluation` — запись оценки ступени
- `get_learning_route` / `upsert_learning_route` — маршрут

#### Новые tools:

**`read_indicator`** — читает значение показателя для человека.

```json
// Вход
{"tool": "read_indicator", "input": {"code": "IND.2.1.1", "period": "4_weeks"}}

// Выход
{
  "code": "IND.2.1.1",
  "value": 5.2,
  "unit": "hours/week",
  "stage_context": {"current_stage": "Практикующий", "threshold_for_next": 6, "gap": 0.8}
}
```

**`write_indicator`** — записывает значение (для настраиваемых параметров).

```json
// Вход
{"tool": "write_indicator", "input": {"code": "IND.1.PREF.daily_task_time", "value": "08:30"}}

// Выход
{"success": true, "previous": "08:00", "new_value": "08:30"}
```

**`get_person_context`** — возвращает контекст для промптов.

```json
// Выход
{
  "person_id": "user_123",
  "stage": {"current": "Практикующий", "next_target": "Систематический"},
  "metrics": {
    "IND.2.1.1": {"value": 5.2, "name": "Часы в неделю"},
    "IND.2.1.2": {"value": 0.57, "name": "Доля дней со слотом"}
  },
  "preferences": {"daily_task_time": "08:00", "role_set": ["менеджер", "отец"]},
  "stagnation_profile": "Тупик"
}
```

---

## 4. Связь с существующими документами

### 4.1. Отношение к Модели данных цифрового двойника 3.2

| Аспект | Модель данных 3.2 | Мета-модель |
|--------|-------------------|-------------|
| **Что описывает** | Какие показатели существуют | Как описаны показатели |
| **Формат** | Таблицы с перечнем | Markdown + JSON с деталями |
| **Пороги** | Упомянуты в тексте | Структурированы машиночитаемо |
| **Использование** | Понимание структуры | Валидация, автоматизация |

**Мета-модель НЕ заменяет, а дополняет** существующую модель данных.

### 4.2. Маппинг показателей из таблицы стажёра

| Показатель из таблицы | Код в мета-модели | Группа |
|-----------------------|-------------------|--------|
| Регулярность саморазвития | IND.2.1.2 | 2.1 Агентность |
| Устойчивость слотов | IND.2.1.4 | 2.1 Агентность |
| Частота рефлексий | IND.2.3.2 | 2.3 Характеристики |
| Инвестированное время | IND.2.1.1 | 2.1 Агентность |
| Ступень квалификации | IND.2.4.2 | 2.4 Квалификация |
| Профиль застревания | IND.2.10.1 | 2.10 Профили |
| Время получения задания | IND.1.PREF.daily_task_time | 1.PREF Настройки |
| Текущие роли | IND.1.PREF.role_set | 1.PREF Настройки |

---

## 5. Расширение мета-модели

### 5.1. Процесс добавления показателя

1. **Определить код** по нотации:
   - `IND.1.X.Y` — первичные данные
   - `IND.2.X.Y` — производные показатели
   - `IND.1.PREF.*` — настраиваемые предпочтения

2. **Добавить в реестр** [[Реестр мета-модели цифрового двойника.md]]

3. **Обновить MCP-сервер** (если нужна специальная логика)

### 5.2. Версионирование

- **Мажорная версия:** изменение структуры групп, удаление показателей
- **Минорная версия:** добавление новых показателей
- **Патч:** уточнение описаний, исправление ошибок

---

## См. также

- [[Реестр мета-модели цифрового двойника.md]] — реестр показателей
- [[C2.2.Architecture/3.2.3.1. Цифровой двойник/Модель данных цифрового двойника 3.2.md]] — базовая модель данных
- [[C2.2.Architecture/3.2.3.1. Цифровой двойник/MCP-сервер цифрового двойника 3.2.md]] — существующий MCP-сервер

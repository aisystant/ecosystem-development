---
type: template
status: draft
version: 0.2
created: 2025-12-24
layer: methodology
scope: ecosystem
description: "Шаблон документирования MCP-инструментов и ресурсов для ecosystem-mcp"
related:
  - "FSM-архитектура ИИ-ассистентов 3.2"
  - "Общая архитектура ИТ-платформы 3.2"
---

# Канонический шаблон описания MCP Tools и Resources

## Контекст

В экосистеме есть **два типа MCP-серверов**:

| MCP-сервер | Назначение | Инструменты |
|------------|------------|-------------|
| **fsm-mcp** | Логика ИИ-ассистентов | `get_instruction(state?)` |
| **ecosystem-mcp** | Доступ к данным ЦД и руководствам | `dt.*`, `edu.*` |

Этот шаблон описывает формат документирования **Tools и Resources для ecosystem-mcp** — сервера, предоставляющего доступ к данным Цифрового двойника и образовательному контенту.

> **Принцип:** Один Tool отвечает на один осмысленный вопрос человека.

---

# Шаблон описания MCP Tools

## 0) Заголовок

```
**Tool name:** `dt.get_time_invested_summary`
**Подсистема-владелец:** Цифровой двойник (Digital Twin)
**Статус:** draft | stable | deprecated
**Версия контракта:** `v1`
**Дата обновления:** YYYY-MM-DD
**Ответственный:** роль/команда
**Зависимости:** какие ресурсы/таблицы/сервисы читает/пишет
```

---

## 1) Назначение (Intent)

Коротко: что tool делает и какую пользовательскую задачу закрывает.

**Пример:**
Возвращает агрегаты инвестированного времени за период (total/avg/breakdown) из данных Цифрового двойника с указанием качества данных.

---

## 2) Когда использовать / когда НЕ использовать

**Use when:**
- нужно получить агрегаты по времени за период
- нужно сравнить неделю к неделе

**Do NOT use when:**
- нужен список событий поштучно → `dt.list_activity_events`
- нужна оценка "продуктивности" → это другая метрика

> Эта секция снижает "угадывание" модели и повышает корректность выбора.

---

## 3) Контракт вызова

### 3.1 Input schema (JSON Schema)

```json
{
  "type": "object",
  "required": ["start_date", "end_date"],
  "properties": {
    "start_date": {
      "type": "string",
      "description": "Начало периода (YYYY-MM-DD)"
    },
    "end_date": {
      "type": "string",
      "description": "Конец периода (YYYY-MM-DD)"
    },
    "timezone": {
      "type": "string",
      "description": "IANA timezone, например Europe/Moscow"
    },
    "granularity": {
      "type": "string",
      "enum": ["none", "day", "week"],
      "default": "day"
    }
  }
}
```

### 3.2 Output schema

```json
{
  "period": { "start_date": "YYYY-MM-DD", "end_date": "YYYY-MM-DD" },
  "total_minutes": 0,
  "avg_minutes_per_day": 0,
  "breakdown": [
    { "date": "YYYY-MM-DD", "minutes": 0 }
  ],
  "data_quality": {
    "coverage_ratio": 0.0,
    "sources": ["timer", "manual_log"],
    "last_sync_at": "ISO-8601"
  }
}
```

---

## 4) Семантика данных

Здесь "заземляется" смысл, чтобы модель не додумывала:

- **Определение метрики:** что считается "инвестированным временем"
- **Единицы измерения:** минуты (целое)
- **Границы периода:** включительность start/end
- **Что НЕ входит:** примеры исключений (сон, дорога, idle)

> Рекомендуется ссылаться на ресурс-каталог метрик вместо копирования определений.

---

## 5) Метаданные качества данных

Обязательный стандарт, чтобы агент не делал уверенных выводов при неполных данных:

| Поле | Назначение |
|------|------------|
| `coverage_ratio` | Полнота данных (0..1) |
| `last_sync_at` | Момент последней синхронизации |
| `sources[]` | Какие источники участвовали |
| `notes` | Краткая причина низкого покрытия |

---

## 6) Ошибки и валидация

**Валидация:**
- формат дат, start ≤ end
- максимальная длина периода (≤ 366 дней)

**Коды ошибок:**

| Код | Описание |
|-----|----------|
| `INVALID_ARGUMENT` | Неверный формат дат/фильтра |
| `NO_DATA` | Данных за период нет |
| `PARTIAL_DATA` | coverage_ratio < threshold |
| `UNAUTHORIZED` | Нет прав |
| `INTERNAL` | Внутренняя ошибка |

---

## 7) Примеры (минимум 2)

### Пример A: "Сводка за неделю"

**User intent:** "Сколько времени я инвестировал за неделю?"
**Tool call:** `dt.get_time_invested_summary({start_date: "2025-12-15", end_date: "2025-12-21"})`
**Response:** total + avg + breakdown + quality

### Пример B: "За месяц без детализации"

**User intent:** "Общее время за декабрь"
**Tool call:** `dt.get_time_invested_summary({..., granularity: "none"})`

---

## 8) Безопасность и доступ

- **Scopes/permissions:** какие роли имеют доступ
- **Минимизация данных:** возвращать только нужное
- **Аудит:** логировать кто/когда/что запрашивал

---

## 9) Версионирование

- Нейминг: `dt.<verb>_<object>_<qualifier>`
- **MAJOR** — breaking changes (удаление/переименование полей)
- **MINOR** — добавление полей (backward compatible)
- **PATCH** — исправления без изменения контракта

---

# Шаблон описания MCP Resources

Resources — read-only контекст (схемы, каталоги, определения), повышающий корректность интерпретации.

## 0) Заголовок

```
**Resource URI:** `dt://catalogs/metrics`
**MIME type:** `application/json`
**Статус:** draft | stable | deprecated
**Версия:** `v1`
**Дата обновления:** YYYY-MM-DD
**Владелец:** команда ЦД
```

---

## 1) Назначение

Пример: "Каталог метрик Цифрового двойника: определения, единицы, правила агрегации."

---

## 2) Структура

```json
{
  "metrics": [
    {
      "id": "time_invested_minutes",
      "title": "Инвестированное время",
      "unit": "minutes",
      "definition": "...",
      "aggregation_rules": ["sum_by_day", "sum_by_period"],
      "exclusions": ["..."],
      "recommended_tools": ["dt.get_time_invested_summary"]
    }
  ]
}
```

---

## 3) Свежесть и изменчивость

- Частота обновления: редко / часто
- TTL/etag (если используется кэширование)

---

## 4) Ограничения доступа

- Кто может читать (scope)
- Есть ли персональные данные (желательно избегать в resources)

---

## 5) Примеры использования

"Если агент не уверен, что такое 'инвестированное время', он должен сначала прочитать `dt://catalogs/metrics`, затем вызвать tool."

---

# Базовый пакет для ecosystem-mcp

## Минимальный набор Resources

| URI | Назначение |
|-----|------------|
| `dt://catalogs/metrics` | Каталог метрик ЦД |
| `dt://schemas/activity_event` | Схема события активности |
| `dt://catalogs/activity_types` | Типы активностей |
| `dt://policies/data_quality` | Правила качества данных |
| `dt://changelog` | История изменений контрактов |

## Минимальный набор Tools

| Tool | Назначение |
|------|------------|
| `dt.get_time_invested_summary` | Агрегаты времени + quality |
| `dt.get_data_coverage` | Диагностика "есть ли данные" |
| `dt.list_activity_events` | Сырые события |
| `dt.get_goals` | Цели пользователя |
| `dt.save_reflection_note` | Сохранить заметку рефлексии |

---

# Связь с FSM-архитектурой

ecosystem-mcp и fsm-mcp работают **совместно**:

```
┌─────────────────────────────────────────────────────────────────┐
│                         LLM (Claude/GPT)                         │
│                                                                   │
│  1. get_instruction() ──────────────────────► fsm-mcp            │
│     (получает инструкции состояния)           │                   │
│                                               ▼                   │
│  2. Инструкции говорят: "вызови dt.get_time_invested_summary"    │
│                                               │                   │
│  3. dt.get_time_invested_summary ───────────► ecosystem-mcp      │
│     (получает данные)                                            │
│                                                                   │
│  4. Формирует ответ пользователю                                 │
└─────────────────────────────────────────────────────────────────┘
```

**Принцип разделения:**
- **fsm-mcp** знает *когда* и *зачем* вызывать инструменты
- **ecosystem-mcp** знает *как* получить данные

---

## Связанные документы

- [[FSM-архитектура ИИ-ассистентов 3.2]] — архитектура логики ассистентов
- [[Общая архитектура ИТ-платформы 3.2]] — место MCP в платформе

---

## Changelog

| Дата | Версия | Изменения |
|------|--------|-----------|
| 2025-12-24 | v0.2 | Добавлен контекст двух MCP-серверов, связь с FSM-архитектурой |

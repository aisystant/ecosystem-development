---

type: doc
audience: mixed
edit_mode: manual
layer: architecture
scope: local-edge
security: internal
status: draft
version: 0.1
created: 2026-01-06

---


# Описание Knowledge Indexer

Knowledge Indexer — система, которая выполняет полный цикл преобразования **первичного контента** участников в **векторные представления (эмбеддинги)** для использования ИИ-системами.

## Три этапа работы

1. **Сбор первичного контента** — получение постов, комментариев, ответов на ДЗ из Клуба, LMS, Telegram, ручного ввода
2. **Нормализация (чанкование)** — автоматическая и ручная разбивка первичного контента на чанки (до 10 000 знаков) и сохранение в Репозиторий знаний (2.3)  
3. **Индексация (эмбеддингизация)** — преобразование чанков в векторные представления и сохранение в Базу эмбеддингов (2.4)

ИИ-системы используют эмбеддинги для создания **информационных продуктов**: постов, руководств, концепций, ТЗ, маркетинговых материалов, структур курсов, спецификаций и т.п.

## Схема потока данных

```
ПОЛЬЗОВАТЕЛЬ
    │
    │ создает
    ▼
ПЕРВИЧНЫЙ КОНТЕНТ (в Клубе, LMS, Telegram)
    │ ├─ Посты в Клубе
    │ ├─ Комментарии
    │ ├─ Ответы на ДЗ в LMS
    │ ├─ Заметки Telegram
    │ └─ Рефлексии
    │
    │ СБОР (Индексатор 1.2)
    ▼
КОНТЕНТ В РЕПОЗИТОРИИ ЗНАНИЙ (2.3)
    │ (первичная форма)
    │
    │ НОРМАЛИЗАЦИЯ/ЧАНКОВАНИЕ
    │ (Индексатор 1.2 автоматически + Пользователь вручную)
    ▼
ЧАНКИ В РЕПОЗИТОРИИ ЗНАНИЙ (2.3)
    │ ├─ Markdown-файлы до 10 000 знаков
    │ ├─ YAML frontmatter с метаданными
    │ └─ История изменений (EMBEDDINGS_EXCLUDE)
    │
    │ ИНДЕКСАЦИЯ/ЭМБЕДДИНГИЗАЦИЯ (Индексатор 1.2)
    ▼
ЭМБЕДДИНГИ В БАЗЕ ДАННЫХ (2.4)
    │ ├─ Векторные представления чанков
    │ ├─ Доступ через MCP
    │ └─ Семантический поиск
    │
    │ ИСПОЛЬЗОВАНИЕ (ИИ-системы)
    ▼
ИНФОРМАЦИОННЫЕ ПРОДУКТЫ
    │ ├─ Персональные руководства
    │ ├─ Концепции и ТЗ
    │ ├─ Маркетинговые материалы
    │ ├─ Структуры курсов
    │ └─ Спецификации
    │
    ▼
ПОЛЬЗОВАТЕЛЬ
```

## Глоссарий терминов

### Первичный контент
Любые текстовые материалы, создаваемые участником экосистемы в исходной форме:
- Посты в Клубе
- Комментарии под постами и ДЗ
- Ответы на домашние задания в LMS
- Личные заметки и рефлексии в Telegram
- Проектная документация

**Где находится:** В разных системах (Клуб, LMS, Telegram) до момента сбора  
**Что с ним происходит:** Собирается Индексатором знаний (1.2) и нормализуется (разбивается на чанки)

### Чанкование (Chunking)
Процесс нормализации первичного контента — разбивка на управляемые части (чанки):
- **Автоматическое:** Если первичный контент < 10 000 знаков → становится одним чанком
- **Автоматическое:** Если первичный контент > 10 000 знаков → автоматически делится на несколько чанков
- **Ручное:** Пользователь может сам разбить длинный материал на смысловые чанки любого размера (до 10 000 знаков)

**Выполняется:** Индексатором знаний (1.2) автоматически + пользователем вручную  
**Результат:** Нормализованные чанки сохраняются в Репозиторий знаний (2.3)

### Чанк (Chunk)
Отдельный markdown-файл с нормализованным контентом:
- **Размер:** до 10 000 знаков (без учета истории изменений)
- **Формат:** Markdown с YAML frontmatter
- **Метаданные:** id, source, type, tags, author, created, updated и др.
- **История:** Хранится в секции EMBEDDINGS_EXCLUDE (не индексируется)
- **ID формат:** `chunk_YYYYMMDD_NNN`

**Где хранится:** Репозиторий знаний (2.3) — GitHub-репозиторий `personal-knowledge`  
**Редактирование:** Пользователь может редактировать чанки вручную для улучшения качества

**Пример структуры чанка:**
```markdown
---
id: chunk_20250111_001
source: club/posts
type: post
created: 2025-01-11T10:30:00Z
tags: [архитектура, хранилища]
char_count: 2500
---

# Заголовок

Содержание чанка (до 10 000 знаков)

---
<!-- EMBEDDINGS_EXCLUDE_START -->
## История изменений
### 2025-01-11 - Создание
- Импортировано из Клуба
<!-- EMBEDDINGS_EXCLUDE_END -->
```

### Репозиторий знаний (2.3)
GitHub-репозиторий для хранения нормализованных чанков:
- **Содержит:** Чанки первичного контента после нормализации
- **Структура:** Директории по источникам (club/, lms/, manual/)
- **Наполнение:** Автоматически (Индексатор 1.2) + вручную (пользователь)
- **Версионирование:** Git + история изменений внутри чанков
- **Ссылка:** https://github.com/aisystant/personal-knowledge

### Индексатор знаний (1.2)
ИИ-система, выполняющая полный цикл преобразования первичного контента в эмбеддинги:

**Этапы работы:**
1. **Сбор** — получение первичного контента из источников (Клуб, LMS, Telegram, ручной ввод)
2. **Нормализация (чанкование)** — автоматическая и ручная разбивка первичного контента на чанки (до 10 000 знаков) и сохранение в Репозиторий знаний (2.3)
3. **Индексация (эмбеддингизация)** — преобразование чанков в векторные представления и сохранение в Базу эмбеддингов (2.4)
4. **Синхронизация** — отслеживание изменений чанков и автоматическое обновление эмбеддингов

**Важно:** Индексатор знаний — это не только конвертер «чанки→эмбеддинги», но полноценная система **сбора, нормализации и индексации** первичного контента.

### Эмбеддинг (Embedding)
Векторное представление чанка:
- **Формат:** Массив чисел (вектор)
- **Размерность:** Зависит от модели (обычно 768, 1536 или 3072)
- **Назначение:** Семантический поиск похожих чанков
- **Хранение:** База эмбеддингов (2.4)

**Создание:** Индексатором знаний (1.2) из чанков  
**Использование:** ИИ-системами через MCP для создания информационных продуктов

### База эмбеддингов (2.4)
Векторная база данных с эмбеддингами всех чанков:
- **Доступ:** MCP (Model Context Protocol)
- **Функции:** Семантический поиск, поиск похожих
- **Потребители:** Все ИИ-системы (1.1, 1.3, 1.6, 1.7 и др.)

### MCP (Model Context Protocol)
Протокол доступа ИИ-систем к Базе эмбеддингов:
- **Операции:** Поиск по запросу, поиск похожих, фильтрация
- **Безопасность:** Права доступа на уровне пользователя
- **Интеграция:** Унифицированный интерфейс для всех ИИ

### Информационный продукт
Артефакт, созданный ИИ-системой на основе эмбеддингов:
- Персональное руководство
- Концепция или техническое задание  
- Маркетинговые материалы
- Структура образовательного курса
- Спецификация системы
- Пост или статья

---

## 0. Назначение документа

Документ определяет концепцию, архитектуру и метод работы Knowledge Indexer — системы для управления знаниями участников экосистемы и подготовки контекста для LLM-генерации продуктов.

**Для кого:**
- Архитекторы — для понимания места системы в ИТ-платформе
- Разработчики — для реализации компонентов
- Участники экосистемы — для понимания возможностей работы со своими знаниями

## 1. Назначение системы

**Статус:** Система 1.2, готовится к запуску в январе 2025 (Q1 2025, v2.1)

**Ключевые изменения в архитектуре (январь 2025):**
- Knowledge Indexer теперь работает в связке с четырьмя хранилищами данных (2.1-2.4)
- Репозиторий знаний (2.3) запускается в январе 2025 на базе https://github.com/aisystant/personal-knowledge
- База эмбеддингов (2.4) также запускается в январе для обеспечения векторного поиска
- Цифровой двойник (2.2) остается в статусе "Идея" и планируется к февралю 2025

Основная цель системы и решаемые задачи:

- **Сбор первичного контента** — агрегация первичного контента из множества источников (Клуб, LMS, Telegram, заметки) с приведением к единому формату
- **Нормализация и чанкование** — автоматическая и ручная разбивка первичного контента на управляемые чанки (до 10 000 знаков) с метаданными и сохранением в Репозиторий знаний (2.3)
- **Индексация (эмбеддингизация)** — преобразование чанков в векторные представления (эмбеддинги) и сохранение в Базу эмбеддингов (2.4) для семантического поиска
- **Синхронизация** — отслеживание изменений чанков и автоматическое обновление соответствующих эмбеддингов
- **Доступ для ИИ-систем** — предоставление MCP-доступа к эмбеддингам для семантического поиска и создания информационных продуктов

**Интеграция с хранилищами данных:**
- **Репозиторий гайдов (2.1)** — работает, содержит готовые руководства и методологические материалы
- **Цифровой двойник (2.2)** — в стадии проектирования (запуск февраль 2025), будет хранить персональный контекст участника
- **Репозиторий знаний (2.3)** — запуск январь 2025, хранит нормализованные чанки первичного контента участников (до 10 000 знаков каждый)
- **База эмбеддингов (2.4)** — запуск январь 2025, векторные представления чанков для семантического поиска через MCP

### 1.1. Ключевые функции

1. **Автоматическое и ручное чанкование** — первичный контент автоматически разбивается на чанки (если < 10 000 знаков, становится одним чанком; если больше — делится). Пользователь может вручную создавать и редактировать чанки
2. **Персональная база знаний** — каждый участник получает свой набор чанков и эмбеддингов для работы с ИИ-системами
3. **Общий корпус знаний** — возможность делиться чанками с сообществом (с контролем доступа)
4. **Семантический поиск** — ИИ-системы находят релевантные чанки через эмбеддинги для создания продуктов

## 2. Концепция использования

### 2.1. Основные сущности и поток данных

```
┌─────────────────────────────────────────────────────────────────┐
│                         ИСТОЧНИКИ                                │
│  Клуб, LMS, Telegram, ручной ввод                               │
│  (где создается первичный контент)                              │
└──────────────────────────┬──────────────────────────────────────┘
                           │ СБОР
                           │ (Индексатор 1.2)
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│              ПЕРВИЧНЫЙ КОНТЕНТ В РЕПОЗИТОРИИ (2.3)               │
│  Посты, ДЗ, комментарии, заметки в исходной форме               │
│  (как собрано из источников, до нормализации)                   │
└──────────────────────────┬──────────────────────────────────────┘
                           │ НОРМАЛИЗАЦИЯ (ЧАНКОВАНИЕ)
                           │ (Индексатор 1.2 + Пользователь)
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│                  ЧАНКИ В РЕПОЗИТОРИИ ЗНАНИЙ (2.3)                │
│  • Markdown-файлы до 10 000 знаков                              │
│  • YAML frontmatter с метаданными                               │
│  • ID формат: chunk_YYYYMMDD_NNN                                │
│  • История изменений (EMBEDDINGS_EXCLUDE)                       │
│  • Структурированные, готовые к индексации                      │
└──────────────────────────┬──────────────────────────────────────┘
                           │ ИНДЕКСАЦИЯ (ЭМБЕДДИНГИЗАЦИЯ)
                           │ (Индексатор 1.2)
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│                 ЭМБЕДДИНГИ В БАЗЕ ДАННЫХ (2.4)                   │
│  • Векторные представления чанков                               │
│  • Семантический поиск через MCP                                │
│  • Права доступа и метаданные                                   │
│  • Связи между чанками                                          │
└──────────────────────────┬──────────────────────────────────────┘
                           │ ИСПОЛЬЗОВАНИЕ
                           │ (ИИ-системы через MCP)
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│                   ИНФОРМАЦИОННЫЕ ПРОДУКТЫ                        │
│  Руководства, концепции, ТЗ, посты, курсы, спецификации и т.п.  │
│  (создаются ИИ-системами на основе эмбеддингов)                 │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2. Чанк — единица хранения и индексации

Чанк — это не просто "кусок текста", а структурированный файл с метаданными:

| Компонент | Описание |
|-----------|----------|
| **Содержание** | Текст/структура: тезис, определение, шаги, чек-лист, пример (до 10 000 знаков) |
| **Метаданные** | id, source, type, tags, author, created, updated, char_count, related_chunks |
| **Права доступа** | Только мне / Сообществу / Публично + дополнительные ограничения |
| **Происхождение** | Из какого источника собрано (club/posts, lms/homework, manual/notes и т.д.) |
| **История изменений** | В секции EMBEDDINGS_EXCLUDE (не индексируется) |

### 2.3. Процесс чанкования

**Чанкование** — это процесс нормализации первичного контента:

- **Автоматическое чанкование (Индексатор 1.2):**
  - Контент < 10 000 знаков → сохраняется как один чанк
  - Контент > 10 000 знаков → автоматически делится на несколько связанных чанков
  - Добавление метаданных (source, type, tags, timestamps)
  - Создание уникального ID

- **Ручное чанкование (Пользователь):**
  - Разбивка материала на смысловые части
  - Редактирование автоматически созданных чанков
  - Улучшение формулировок для лучшей индексации
  - Настройка метаданных и прав доступа

### 2.4. ИИ-ассистент для работы с чанками (опциональный компонент)

Помощник для ускорения настройки и улучшения качества чанков:

- Предлагает правила включения/исключения источников при сборе
- Помогает разметить чанки (темы, типы знаний, теги)
- Находит дубли и слабые места в чанках
- Предлагает улучшения формулировок
- Помогает настроить права доступа

Система работает и без него — это надстройка для снижения ручных затрат.

## 3. Метод индексации знаний

### 3.1. Этапы работы Knowledge Indexer

```
1. СБОР (ИНГЕСТ)         2. НОРМАЛИЗАЦИЯ         3. ЧАНКОВАНИЕ
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ Источники       │ ──→ │ Очистка         │ ──→ │ Разбивка на     │
│ (LMS, Telegram, │     │ Структура       │     │ чанки до 10k    │
│  заметки, клуб) │     │ Дедупликация    │     │ Метаданные      │
└─────────────────┘     │ Метаданные      │     │ Сохранение в    │
                        │ Права доступа   │     │ Репозиторий 2.3 │
                        └─────────────────┘     └────────┬────────┘
                                                         │
                                                         ↓
4. ПОСТРОЕНИЕ            5. ИНДЕКСАЦИЯ           6. ИЗВЛЕЧЕНИЕ
   ПРИЗНАКОВ
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ Эмбеддинги      │ ──→ │ Запись в        │ ──→ │ Семантический   │
│ Ключевые слова  │     │ Базу            │     │ поиск           │
│ Сущности        │     │ эмбеддингов 2.4 │     │ С учётом:       │
│ Сигналы         │     │ Версионирование │     │ • доступа       │
│ ранжирования    │     │ Связывание      │     │ • свежести      │
└─────────────────┘     └─────────────────┘     │ • качества      │
                                                 └─────────────────┘
                                                         │
                        7. ИСПОЛЬЗОВАНИЕ                 │
                           ИИ-СИСТЕМАМИ                  │
                        ┌─────────────────┐              │
                        │ Поиск через MCP │ ←────────────┘
                        │ Создание        │
                        │ информационных  │
                        │ продуктов       │
                        └─────────────────┘
```

### 3.2. Детализация этапов

**1. Сбор первичного контента (ингест)**
- Индексатор знаний получает первичный контент из источников в рамках настроек пользователя
- Источники: Клуб (посты, комментарии), LMS (ответы на ДЗ), Telegram (заметки), ручной ввод
- Сохранение в Репозиторий знаний (2.3) в исходной форме

**2. Нормализация**
- Очистка и приведение к единому формату
- Извлечение метаданных из источника
- Дедупликация (проверка на дубли)
- Применение правил доступа
- Подготовка к чанкованию

**3. Чанкование**
- **Автоматическое:** Разбивка контента на чанки до 10 000 знаков
  - < 10k знаков → один чанк
  - \> 10k знаков → несколько связанных чанков
- **Ручное:** Пользователь сам нарезает на смысловые части
- Добавление метаданных (id, source, type, tags, timestamps)
- Сохранение нормализованных чанков в Репозиторий знаний (2.3)

**4. Построение признаков (feature extraction)**
- Генерация эмбеддингов (векторных представлений)
- Извлечение ключевых слов и сущностей
- Создание дополнительных сигналов для ранжирования

**5. Индексация (эмбеддингизация)**
- Сохранение эмбеддингов в Базу эмбеддингов (2.4)
- Версионирование эмбеддингов
- Связывание чанков (related_chunks)
- Учёт прав доступа

**6. Извлечение (семантический поиск)**
- ИИ-системы выполняют поиск через MCP
- Поиск релевантных чанков по семантике запроса
- Учёт доступа, свежести, качества чанков
- Ранжирование результатов

**7. Использование ИИ-системами**
- ИИ-системы получают релевантные эмбеддинги через MCP
- Создают информационные продукты на основе найденных чанков
## 4. Сценарии использования

### 4.1. Сценарий A — создание персонального набора чанков и эмбеддингов

```
Участник                   Индексатор (1.2)           Репозиторий (2.3) / База (2.4)
    │                             │                            │
    │  1. Создает контент         │                            │
    │     в Клубе/LMS             │                            │
    │                             │                            │
    │                             │  2. Сбор первичного        │
    │                             │     контента               │
    │                             │ ─────────────────────────→ │
    │                             │  3. Нормализация           │
    │                             │     (чанкование)           │
    │                             │ ─────────────────────────→ │
    │  4. Редактирует чанки       │                            │
    │     вручную (опционально)   │                            │
    │ ←──────────────────────────────────────────────────────── │
    │                             │                            │
    │                             │  5. Создание эмбеддингов   │
    │                             │ ─────────────────────────→ │
    │                             │                            │
    │  6. Работает с ИИ           │  7. ИИ используют          │
    │     (получает продукты)     │     эмбеддинги через MCP   │
    │ ←──────────────────────────────────────────────────────── │
```

### 4.2. Сценарий B — обмен чанками с сообществом

```
Участник                   Индексатор (1.2)           Другие участники
    │                             │                            │
    │  1. Настраивает права       │                            │
    │     доступа к своим         │                            │
    │     чанкам (Сообществу)     │                            │
    │ ─────────────────────────→  │                            │
    │                             │  2. Обновление эмбеддингов │
    │                             │     с учетом прав доступа  │
    │                             │                            │
    │                             │  3. Эмбеддинги доступны    │
    │                             │     другим через MCP       │
    │                             │ ─────────────────────────→ │
    │                             │                            │
    │                             │  4. ИИ других участников   │
    │                             │     используют эмбеддинги  │
    │                             │     для своих продуктов    │
```

### 4.3. Сценарий C — создание информационного продукта

```
Пользователь               ИИ-система                 База эмбеддингов (2.4)
    │                             │                            │
    │  1. Формулирует задачу      │                            │
    │     для ИИ-системы          │                            │
    │ ─────────────────────────→  │                            │
    │                             │  2. Семантический поиск    │
    │                             │     релевантных чанков     │
    │                             │ ─────────────────────────→ │
    │                             │                            │
    │                             │  3. Получение эмбеддингов  │
    │                             │     найденных чанков       │
    │                             │ ←─────────────────────────│
    │                             │                            │
    │                             │  4. Генерация              │
    │                             │     информационного        │
    │                             │     продукта               │
    │  5. Получение продукта      │                            │
    │ ←────────────────────────── │                            │
    │                             │                            │
    │  6. Итерация / уточнение    │                            │
    │     при необходимости       │                            │
```

## 5. Контур качества чанков и эмбеддингов

### 5.1. Механизм тестирования

**Проверка качества** — ключевой механизм управления качеством чанков и эмбеддингов:

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ 1. Контрольные  │ ──→ │ 2. Поиск через  │ ──→ │ 3. Оценка       │
│    вопросы /    │     │    эмбеддинги   │     │    результатов  │
│    сценарии     │     │    (MCP)        │     │    поиска       │
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
                                              ┌──────────┴──────────┐
                                              │                     │
                                              ↓                     ↓
                                      ┌───────────────┐    ┌───────────────┐
                                      │ Качество OK   │    │ Качество      │
                                      │ → Использовать│    │ неудовл.      │
                                      └───────────────┘    └───────┬───────┘
                                                                   │
                                                                   ↓
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ 5. Повторить    │ ←── │ 4. Редактирование│ ←──│ Анализ проблем  │
│    тест         │     │    чанков        │     │ (через ИИ-      │
│                 │     │    в Репозитории │     │  ассистента)    │
│                 │     │    (2.3)         │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### 5.2. Типичные правки чанков

По итогам теста обычно правят:

| Что править | Примеры действий |
|-------------|------------------|
| **Структурирование материала** | Выделение тезисов, определений, процедур, чек-листов |
| **Контекст применимости** | Добавление условий, исключений, граничных случаев |
| **Формулировки** | Уточнение "канонической версии" мысли |
| **Разметка** | Темы, типы знаний, приоритет |
| **Права доступа** | Настройка на уровне частей/чанков |
| **Логика чанкования** | Где дробить, где объединять |

## 6. Архитектура

### 6.1. Компоненты

```
┌─────────────────────────────────────────────────────────────────┐
│                      KNOWLEDGE INDEXER                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Source          │  │ Normalization   │  │ Chunking        │  │
│  │ Connector       │  │ Engine          │  │ Engine          │  │
│  │                 │  │                 │  │                 │  │
│  │ • LMS adapter   │  │ • Cleaning      │  │ • Auto chunking │  │
│  │ • Telegram bot  │  │ • Deduplication │  │ • Manual split  │  │
│  │ • Club API      │  │ • Metadata      │  │ • Boundaries    │  │
│  │ • Notes sync    │  │ • Classification│  │ • Linking       │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Embedding       │  │ Database        │  │ Retrieval       │  │
│  │ Service         │  │ Manager         │  │ Engine          │  │
│  │                 │  │                 │  │                 │  │
│  │ • Vector models │  │ • Write/update  │  │ • RAG search    │  │
│  │ • Keywords      │  │ • Versioning    │  │ • Ranking       │  │
│  │ • Entities      │  │ • Permissions   │  │ • Filtering     │  │
│  │ • Ranking sigs  │  │ • Linking       │  │ • MCP access    │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Repository      │  │ LLM Editor      │  │ AI Assistant    │  │
│  │ Storage (2.3)   │  │                 │  │ for Chunks      │  │
│  │                 │  │                 │  │                 │  │
│  │ • Chunks store  │  │ • Structuring   │  │ • Rules suggest │  │
│  │ • Access policy │  │ • Clarification │  │ • Markup help   │  │
│  │ • Versions      │  │ • Markup        │  │ • Duplicates    │  │
│  │ • Frontmatter   │  │ • Permissions   │  │ • Quality check │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2. Технологический стек (предварительный)

| Компонент | Технология | Обоснование |
|-----------|------------|-------------|
| **Embeddings Database** | SurrealDB / Qdrant | Мультимодельность, векторный поиск |
| **Embedding Models** | OpenAI Ada / Cohere / E5 | Качество семантического поиска |
| **Repository (2.3)** | GitHub (personal-knowledge) | Markdown + Git версионирование |
| **LLM Editor** | Claude / GPT-4 | Качество структурирования |
| **Event Bus** | Kafka | Асинхронность, масштабируемость |
| **API** | Go / Python | Производительность + ML-экосистема |

## 7. Интеграции

### 7.1. Входящие интеграции (источники данных)

| Система | Что получает Knowledge Indexer |
|---------|-------------------------------|
| [[3.2.3.4. LMS и обучение]] | ДЗ, ответы, прогресс обучения |
| [[3.2.3.5. Клуб]] | Посты, комментарии, обсуждения |
| Telegram-чаты | Сообщения, дискуссии, инсайты |
| [[3.2.3.1. Цифровой двойник]] | Контекст участника, предпочтения |
| [[3.2.3.7. Централизованное хранилище]] | Документы, руководства, методологии |

### 7.2. Исходящие интеграции (потребители)

| Система | Что предоставляет Knowledge Indexer |
|---------|-------------------------------------|
| [[3.2.3.8. Операционная система ИТ-платформы]] | Эмбеддинги через MCP для ИИ-систем |
| [[3.2.3.1. Цифровой двойник]] | Обновление профиля знаний участника |
| LLM-генераторы продуктов | Контекст для генерации (через MCP) |
| [[3.2.3.13. Эпистемический граф]] | Статусы чанков знаний |

## 8. API и контракты

### 8.1. Основные эндпоинты

**Source Management:**
```
POST /ki/sources                    # Подключение источника
GET  /ki/sources                    # Список источников
PUT  /ki/sources/:id/config         # Настройка источника
POST /ki/sources/:id/sync           # Запуск синхронизации
```

**Repository Operations:**
```
GET  /ki/chunks/:user_id/items      # Чанки пользователя
PUT  /ki/chunks/item/:id            # Редактирование чанка
POST /ki/chunks/item/:id/llm-edit   # LLM-редактирование
PUT  /ki/chunks/item/:id/access     # Настройка доступа
```

**Embeddings Operations:**
```
POST /ki/embeddings/reindex         # Переиндексация
GET  /ki/embeddings/stats           # Статистика базы
GET  /ki/embeddings/search          # Семантический поиск
```

**Retrieval & Context:**
```
POST /ki/retrieve                   # Извлечение чанков по запросу
POST /ki/mcp/query                  # MCP-запрос для ИИ-систем
POST /ki/test-retrieval             # Проверка качества поиска
```

### 8.2. События

Система генерирует следующие события:

- `ki.source.connected` — подключён новый источник
- `ki.content.collected` — собран первичный контент
- `ki.chunk.created` — создан чанк в Репозитории (2.3)
- `ki.chunk.updated` — обновлён чанк
- `ki.embedding.created` — создан эмбеддинг в Базе (2.4)
- `ki.database.updated` — обновлена база эмбеддингов
- `ki.quality.tested` — выполнена проверка качества

## 9. Метрики и мониторинг

### 9.1. Ключевые метрики

| Метрика | Целевое значение | Описание |
|---------|------------------|----------|
| **Retrieval Latency (p95)** | <500ms | Время извлечения чанков через эмбеддинги |
| **MCP Query (p95)** | <2s | Время ответа на MCP-запрос |
| **Index Freshness** | <1h | Задержка индексации нового контента |
| **Retrieval Precision@10** | >0.8 | Точность топ-10 результатов |
| **Chunk Coverage** | >90% | Доля контента, преобразованного в чанки |
| **Chunk Quality** | >70% | Доля размеченных чанков |

### 9.2. Алерты

**Критические:**
- Embeddings database недоступна
- Embedding service error rate >5%
- Retrieval latency >2s

**Предупреждения:**
- Index freshness >4h
- Low retrieval precision (<0.6)
- High duplicate rate in chunks (>20%)
- Source sync failures

## 10. Roadmap

### v1.0 (MVP)

- [ ] Базовые коннекторы источников (LMS, Telegram)
- [ ] Нормализация и базовое чанкование
- [ ] Векторный поиск (embedding-based)
- [ ] Простой MCP-доступ для ИИ-систем
- [ ] API для интеграции

### v1.1 (Q1-Q2 2025)

- [ ] LLM-редактор чанков
- [ ] Права доступа на уровне чанков
- [ ] Проверка качества поиска
- [ ] Улучшенное ранжирование
- [ ] Интеграция с Цифровым двойником (2.2) — планируется после его запуска в феврале 2025
- [ ] Интеграция с Репозиторием гайдов (2.1) для использования методологических материалов

### v2.0

- [ ] ИИ-ассистент для работы с чанками
- [ ] Гибридный поиск (vector + keyword + structured)
- [ ] Автоматическая разметка и классификация
- [ ] Продвинутые сценарии создания продуктов
- [ ] Федеративная база (объединение эмбеддингов участников)

## 11. Связанные документы

**Стратегия и архитектура:**
- [[Стратегия развития ИТ-платформы Q1 2025]] — актуальная стратегия развития, разделение систем и хранилищ
- [[3.2.2. Архитектурные решения]] — общая архитектура ИТ-платформы
- [[0.2. Процессы работы с хранилищем]] — процессы управления знаниями

**Хранилища данных (2.x):**
- **2.1. Репозиторий гайдов** (Работает) — методологические материалы и руководства
- **2.2. Цифровой двойник** (Идея, февраль 2025) — персональный контекст участника
- **2.3. Репозиторий знаний** (Проект, январь 2025) — первичное хранилище материалов, https://github.com/aisystant/personal-knowledge
- **2.4. База эмбеддингов** (Проект, январь 2025) — векторные представления для поиска

**Связанные системы:**
- [[3.2.3.8. Операционная система ИТ-платформы]] — основной потребитель эмбеддингов через MCP
- [[3.2.3.13. Эпистемический граф]] — статусы и валидация знаний
- [[Репозиторий знаний - структура и задание]] — техническое задание на реализацию хранилища

## 12. История изменений

| Дата | Версия | Описание |
|------|--------|----------|
| 2026-01-13 | 0.9 | Полная ревизия терминологии: унификация всех документов с использованием терминов "первичный контент", "чанки", "эмбеддинги" вместо старых "вторичный слой", "фрагменты", "индекс знаний", "пакеты контекста" |
| 2026-01-13 | 0.2 | Обновление в соответствии со стратегией Q1 2025 v2.1: добавлена информация о четырех хранилищах (2.1-2.4), планах запуска в январе 2025, интеграции с Репозиторием знаний (personal-knowledge) и Базой эмбеддингов |
| 2026-01-06 | 0.1 | Первое создание документа на основе концепции |

---

**Status:** 🟡 Draft (входящие) → 🟢 Ready (готовится к запуску январь 2025)
**Owner:** Architecture & Knowledge Team
**Last Updated:** 2026-01-13
**Связанные системы:** 1.2 Knowledge Indexer, 2.3 Репозиторий знаний, 2.4 База эмбеддингов

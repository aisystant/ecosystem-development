# Соответствие экранов и инструментов MCP

## Матрица экран → инструменты

| Экран | Инструменты MCP | Порядок вызова |
|-------|-----------------|----------------|
| Результат (Success) | `get_week_state`, `get_week_time`, `get_slot_consistency`, `get_work_products` | Параллельно |
| Пустая неделя (Empty) | `get_week_state` | Один вызов |
| Ошибка (Error) | — | Результат ошибки любого инструмента |

## Детализация вызовов

### Экран результата

При нажатии "Показать мою неделю" выполняются параллельно:

```
┌─────────────────────────────────────────────────────────┐
│ Параллельные вызовы                                     │
├─────────────────────────────────────────────────────────┤
│ 1. get_week_state(twin_id)                              │
│    → days_with_activity, total_actions, actions_by_type │
│                                                         │
│ 2. get_week_time(twin_id)                               │
│    → total_minutes, average_minutes_per_day             │
│                                                         │
│ 3. get_slot_consistency(twin_id)                        │
│    → primary_slot, consistency_percent                  │
│                                                         │
│ 4. get_work_products(twin_id)                           │
│    → total_count, products_by_type, products[]          │
└─────────────────────────────────────────────────────────┘
```

### Логика определения экрана

```
if (get_week_state.error) → показать Error
if (get_week_state.days_with_activity === 0) → показать Empty
else → показать Success с данными всех инструментов
```

## Таймауты и retry

| Параметр | Значение |
|----------|----------|
| Таймаут одного вызова | 5 секунд |
| Общий таймаут | 10 секунд |
| Количество retry | 2 |
| Задержка между retry | 1 секунда |

## Fallback-логика

Если часть инструментов вернула ошибку:

| Ситуация | Поведение |
|----------|-----------|
| `get_week_state` ошибка | Показать Error |
| `get_week_time` ошибка | Показать "Время: недоступно" |
| `get_slot_consistency` ошибка | Скрыть блок систематичности |
| `get_work_products` ошибка | Показать "Продукты: недоступно" |

## Кэширование

| Инструмент | Время кэша |
|------------|------------|
| `get_week_state` | 5 минут |
| `get_week_time` | 5 минут |
| `get_slot_consistency` | 5 минут |
| `get_work_products` | 1 минута |

---

**Связанные документы:**
- [[../3.2.4.1.1.4 Контракты-MCP/Список-инструментов-минимальный]]
- [[Карта-экранов-и-состояний]]

# Совместимость версий MCP и контрактов

## Версионирование

### Схема версий

```
[major].[minor].[patch]

major — breaking changes в контрактах
minor — новые поля/инструменты (обратно совместимые)
patch — багфиксы
```

### Текущие версии

| Компонент | Версия | Дата |
|-----------|--------|------|
| MCP-сервер | 0.1.0 | 2025-12-23 |
| Контракты | 0.1.0 | 2025-12-23 |
| UI Apps SDK | 0.1.0 | 2025-12-23 |

## Матрица совместимости

| MCP-сервер | Контракты | UI | Совместимость |
|------------|-----------|-----|---------------|
| 0.1.x | 0.1.x | 0.1.x | ✅ Полная |
| 0.2.x | 0.1.x | 0.1.x | ✅ Обратная |
| 0.2.x | 0.2.x | 0.1.x | ⚠️ Частичная |
| 1.0.x | 0.x.x | 0.x.x | ❌ Несовместимо |

## Правила обратной совместимости

### Разрешено (minor версия)

- Добавление новых optional полей в ответ
- Добавление новых инструментов
- Добавление новых значений в enum (если UI игнорирует неизвестные)

### Запрещено без major версии

- Удаление полей из ответа
- Изменение типов полей
- Изменение семантики существующих полей
- Удаление инструментов

## Проверка версий

### Запрос версии

```
GET /mcp/version
```

### Ответ

```json
{
  "mcp_server": "0.1.0",
  "contracts": "0.1.0",
  "protocol": "mcp-2024-11",
  "supported_tools": [
    "get_week_state",
    "get_week_time",
    "get_slot_consistency",
    "get_work_products"
  ]
}
```

## Миграции

### 0.1.x → 0.2.x (планируется)

Добавление:
- Поле `trend` в метрики (сравнение с прошлой неделей)
- Инструмент `get_week_comparison`

Действия:
- UI может игнорировать новые поля
- Новые инструменты опциональны

### 0.x.x → 1.0.0 (планируется)

Breaking changes:
- Обязательная авторизация
- Новый формат `twin_id`

Действия:
- Параллельная поддержка старой версии 3 месяца
- Уведомление клиентов за 1 месяц

## Тестирование совместимости

Перед деплоем новой версии:

1. Запустить тесты с фикстурами предыдущей версии
2. Проверить, что старый UI работает с новым сервером
3. Проверить, что новый UI работает со старым сервером (если поддерживается)

---

**Связанные документы:**
- [[../3.2.4.1.1.4 Контракты-MCP/Список-инструментов-минимальный]]
- [[Ссылка-на-MCP-эндпоинт-и-описание]]

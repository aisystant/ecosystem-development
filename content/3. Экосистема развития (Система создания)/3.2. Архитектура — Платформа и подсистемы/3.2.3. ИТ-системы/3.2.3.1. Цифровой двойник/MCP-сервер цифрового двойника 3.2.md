---

title: MCP-сервер цифрового двойника
family: F8
cell: '3.2'
version: v1.0
status: active
date_created: '2025-12-09'
date_modified: '2025-12-09'
related:
- Модель данных цифрового двойника 3.2
- Цифровой двойник 3.2
- Описание ИИ-Проводника по персональному маршруту развития 3.2
description: 'Описание MCP-сервера над Моделью данных цифрового двойника: архитектура,
  tools, сценарии использования для ИИ-Проводника'
type: doc
created: '2025-12-12'
layer: operations
scope: local-edge
aliases:
- MCP-сервер цифрового двойника 32md
---

# MCP-сервер цифрового двойника 3.2

## Цель и назначение

Документ описывает, как использовать MCP-сервер над Моделью данных цифрового двойника для работы ИИ-Проводника, который ведёт человека по ступеням Ученика от Случайного до Проактивного.

Документ связывает:

- Модель данных цифрового двойника (первичные данные 1.* и производные показатели 2.*);
- MCP-сервер как интерфейсный слой поверх централизованного хранилища;
- функции Проводника по оценке ступени, формированию маршрута и сопровождению;
- набор MCP-tools, доступных языковой модели.

## Контекст и область применения

MCP-сервер является интерфейсным слоем между:

- базой данных цифрового двойника (SurrealDB или другая СУБД);
- языковыми моделями (Проводник и служебные ассистенты).

Он предоставляет функции чтения агрегатов, событий, ступеней, маршрутов, а также функции записи оценок ступени, маршрутов, результатов сессий.

---

## 1. Главные объекты внимания

### 1.1. Человек (ученик) и его цифровой двойник

Центральный объект — взрослый человек, развивающий роль Ученика. Его цифровой двойник включает:

- **первичные данные 1.***: профиль в LMS и клубе, участие в курсах и потоках, учебные сессии, задания и ответы, помидорки, события квалификации, активность в клубе, логи ботов;
- **производные показатели 2.***: агентность и учебный ритм, степень мастерства Ученика, индексы рефлексии, качества вопросов, ресурсности, внутреннюю ступень Ученика 2.4.2, историю ступеней 2.4.3, профиль застревания 2.10.1.

### 1.2. Проводник по персональному маршруту развития

Проводник — языковая модель с ролью методолога-наставника, которая:

- понимает ступени Ученика и критерии перехода между ними;
- использует данные цифрового двойника;
- помогает выйти на ежедневное удержание внимания на саморазвитии (15+ минут в день) и 10+ часов в неделю;
- ведёт человека к состоянию Проактивного ученика.

### 1.3. MCP-сервер над цифровым двойником

MCP-сервер:

- предоставляет **функции чтения** агрегатов, событий, ступеней, маршрутов;
- предоставляет **функции записи** оценок ступени, маршрутов, результатов сессий;
- реализует фильтрацию и агрегацию данных под задачи Проводника.

### 1.4. Внешние системы: LMS, клуб, боты

LMS, клуб, Telegram-боты и другие интерфейсы:

- генерируют первичные события;
- складывают их в централизованное хранилище по Модели данных цифрового двойника;
- косвенно влияют на производные показатели.

---

## 2. Общая архитектура MCP-сервера

### 2.1. Потоки данных и роли компонентов

```
┌─────────────────────────────────────────────────────────────┐
│  Интерфейс (ChatGPT-приложение, LMS, бот)                   │
│  Человек пишет запрос Проводнику                            │
└─────────────────────────┬───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  Проводник (LLM)                                            │
│  - анализирует запрос                                       │
│  - вызывает MCP-tools                                       │
│  - формирует ответ и решения                                │
└─────────────────────────┬───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  MCP-сервер над цифровым двойником                          │
│  - принимает вызовы от модели                               │
│  - читает/обновляет данные в хранилище                      │
│  - возвращает агрегированные структуры                      │
└─────────────────────────┬───────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────────┐
│  Централизованное хранилище                                 │
│  - первичные данные и производные показатели                │
│  - обновляется внешними системами и Проводником             │
└─────────────────────────────────────────────────────────────┘
```

### 2.2. Направления потоков через MCP

**Чтение (diagnostics / analytics):**
- сводки за период (часы, регулярность, практика, активность в клубе);
- ядро показателей (2.*);
- текущая и прошлые ступени, профиль застревания;
- текущий маршрут и статусы шагов.

**Запись (updates / logging):**
- новая оценка ступени (2.4.2 и обновление истории 2.4.3);
- сформированный маршрут и шаги;
- лог сессии Проводника.

### 2.3. Что означает «MCP-сервер не меняет модель данных»

- **MCP-сервер не меняет структуру модели**: он не придумывает новые сущности и поля;
- **Но MCP-сервер обновляет данные внутри модели**: он создаёт и изменяет записи (например, новые записи истории ступеней, маршрутов, сессий Проводника).

> Модель данных (сущности, поля, связи, список показателей) задаётся отдельно.
> MCP-сервер реализует доступ к данным **по этой модели**, включая их чтение и обновление, но не меняет саму _схему_ модели.

---

## 3. Использование MCP Проводником: сценарии

### 3.1. Функции Проводника по ступеням Ученика

1. **Диагностика ступени и застревания** — определение текущей ступени и профиля застревания.
2. **Формирование шага маршрута** — выбор приоритетов, подбор объёма времени и практик.
3. **Сопровождение выполнения маршрута** — отслеживание выполнения, обнаружение провалов.
4. **Рефлексия и компиляция знаний** — опора на рефлексивные тексты.
5. **Анализ динамики и ресурсов** — скорость прохождения ступеней, индекс ресурсности.

### 3.2. Сценарий 1. Первичная диагностика нового ученика

**Ситуация:** человек впервые приходит к Проводнику.

**Последовательность:**
1. `get_learner_summary(period=4-8 недель)` — базовая сводка
2. `get_learner_core_metrics(period=4-8 недель)` — ядро показателей
3. `upsert_learner_stage_evaluation(stage=Случайный, reason=...)` — запись ступени
4. `log_guide_session(...)` — фиксация сессии
5. `upsert_learning_route(...)` — создание нулевого маршрута

### 3.3. Сценарий 2. Еженедельное сопровождение

**Ситуация:** регулярная сессия для корректировки плана.

**Последовательность:**
1. `get_learner_summary(period=неделя)` — сводка за неделю
2. `get_learner_core_metrics(period=4 недели)` — ядро показателей + тренды
3. `get_learning_route()` — текущий маршрут
4. Диалог с человеком
5. `upsert_learner_stage_evaluation(...)` — если ступень изменилась
6. `upsert_learning_route(...)` или `update_route_step_status(...)` — обновление маршрута
7. `log_guide_session(...)` — фиксация сессии

### 3.4. Сценарий 3. Подготовка к переходу на следующую ступень

**Ситуация:** человек "подпирает" следующую ступень.

**Последовательность:**
1. `get_stage_history()` — история ступеней
2. `get_learner_core_metrics(period=8-12 недель)` — расширенный период
3. Диалог с человеком
4. `upsert_learner_stage_evaluation(stage=Новая_ступень, ...)` — если переход оправдан
5. `upsert_learning_route(focus=критерии новой ступени)` — переходный маршрут
6. `log_guide_session(type=transition, ...)` — фиксация перехода

### 3.5. Сценарий 4. Реактивация после провала

**Ситуация:** длительное отсутствие слотов, падение активности.

**Последовательность:**
1. `get_learner_core_metrics(...)` — особенно 2.1.*, 2.2.*, 2.10.1
2. `get_learning_route()` — последний маршрут
3. Диалог о причинах провала
4. `upsert_learner_stage_evaluation(...)` — корректировка ступени (возможно откат)
5. `upsert_learning_route(minimal_daily_slot=15-20 минут)` — компактный маршрут
6. `log_guide_session(type=reactivation, ...)` — фиксация

### 3.6. Сценарий 5. Плановые фоновые проверки

**Ситуация:** запуск по расписанию без запроса человека.

**Последовательность:**
1. `recalc_aggregates_for_period(period=неделя)` — для каждого ученика
2. `get_learner_core_metrics(period=4 недели)` — ядро показателей
3. Определение группы риска
4. Создание сигналов для выбранных учеников

---

## 4. Список MCP-tools над цифровым двойником

### 4.1. Группа A. Диагностика и ступени Ученика

#### A1. `get_learner_summary`

- **Назначение:** сводка по ученику за период
- **Входы:** `period_start`, `period_end` или предустановленный период
- **Выходы:** суммарные часы, количество сессий и помидорок, выполненные задания, активность в клубе
- **Безопасность:** без технических ID, только нужные данные

#### A2. `get_learner_core_metrics`

- **Назначение:** ядро производных показателей 2.* для анализа ступени
- **Входы:** `period` (4_недели, 8_недель, 3_месяца)
- **Выходы:** 2.1.* (часы, регулярность), 2.2.* (практика, мастерство), 2.3.* (вопросы, рефлексия), 2.4.2 (ступень), 2.10.1 (застревание)
- **Безопасность:** агрегированные значения, без сырых текстов

#### A3. `get_stage_history`

- **Назначение:** история смены ступеней Ученика
- **Входы:**  опционально `limit`
- **Выходы:** список записей: дата, ступень, комментарий, ключевые метрики

#### A4. `upsert_learner_stage_evaluation`

- **Назначение:** записать или обновить оценку ступени
- **Входы:**  `stage` (Случайный/Практикующий/Систематический/Дисциплинированный/Проактивный), `reason`, `metrics_snapshot`
- **Выход:** подтверждение записи (id события)

### 4.2. Группа B. Маршрут и шаги маршрута

#### B1. `get_learning_route`

- **Назначение:** текущий маршрут Ученика
- **Входы:** 
- **Выходы:** цели на период, шаги маршрута со статусами, история изменений

#### B2. `upsert_learning_route`

- **Назначение:** создать или обновить маршрут
- **Входы:**  структура маршрута (цели, шаги, связи)
- **Выход:** id маршрута/версии

#### B3. `update_route_step_status`

- **Назначение:** обновить статус шага
- **Входы:**  `step_id`, `new_status`, комментарий
- **Выход:** обновлённый статус шага

### 4.3. Группа C. Сессии Проводника и события

#### C1. `log_guide_session`

- **Назначение:** зафиксировать сессию Проводника
- **Входы:**  `session_type` (разовая, еженедельная, переход, реактивация), `input_summary`, `actions`, `used_data_refs`
- **Выход:** id сессии

#### C2. `get_recent_guide_sessions`

- **Назначение:** последние сессии для контекста диалога
- **Входы:**  опционально `limit`
- **Выходы:** список сессий (тип, дата, решения)

### 4.4. Группа D. Агрегаты и динамика

#### D1. `recalc_aggregates_for_period`

- **Назначение:** пересчитать производные показатели 2.* за период
- **Входы:**  `period`
- **Выход:** подтверждение обновления

#### D2. `get_aggregate_trends`

- **Назначение:** динамика ключевых показателей
- **Входы:**  список показателей, период
- **Выходы:** временные ряды

### 4.5. Группа E. Универсальные tools

#### E1. `read_entities`

- **Назначение:** читать сущности по фильтрам
- **Входы:** `entity_type`, фильтры, `limit`
- **Выход:** список сущностей

#### E2. `upsert_entity`

- **Назначение:** создать/обновить сущность
- **Входы:** `entity_type`, `entity_id`, JSON-данные
- **Выход:** id сущности

---

## 4.6. Связь tools со ступенями Ученика

| Переход | Задачи Проводника | Ключевые tools |
|---------|-------------------|----------------|
| **Случайный → Практикующий** | Вытащить из хаоса, запустить 15+ минут в день | A1, A2, A4, B2, C1 |
| **Практикующий → Систематический** | Стабилизировать слот на 4+ недель, связать с маршрутом | A1, A2, B1, B2, B3, C1, C2 |
| **Систематический → Дисциплинированный** | Увеличить до 10+ часов в неделю на 2-3+ месяца | A2, B1, B2, B3, D2, C1, C2 |
| **Дисциплинированный → Проактивный** | Сместить фокус к инициативе, образу будущего | A2, A3, B1, B2, D2, C1, C2 |
| **Проактивный → Интеллектуал** | Перевести практику к работе с задачами и системами | A2, A3, D2, B1, B2, C1, C2 |

---

## Связанные документы

- [[Модель данных цифрового двойника 3.2]] — модель данных первичных и производных показателей
- [[Цифровой двойник 3.2]] — обзор подсистемы цифрового двойника
- [[Описание ИИ-Проводника по персональному маршруту развития 3.2]] — описание ИИ-Проводника
- [[Централизованное хранилище 3.2]] — техническая реализация хранилища

---

## Changelog / История версий

| Дата | Версия | Автор | Изменения |
|------|--------|-------|-----------|
| 2025-12-09 | v1.0 | — | Создан документ, перенесён из 0.9. Входящие, оформлен по стандартам |

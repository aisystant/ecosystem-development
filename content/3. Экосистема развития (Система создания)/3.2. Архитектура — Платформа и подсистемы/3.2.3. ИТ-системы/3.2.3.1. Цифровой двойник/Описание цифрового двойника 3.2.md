---
type: doc
audience: mixed
edit_mode: manual
layer: architecture
scope: local-edge
security: internal
status: draft
version: 3.0
created: 2025-11-12
updated: 2025-12-09
---

# Описание цифрового двойника

Цифровой двойник (`PRS.Twin`) — живая модель участника экосистемы, ядро персонализации всей платформы. Хранит и непрерывно обновляет профиль, цели, навыки, предпочтения, историю активности и показатели развития. Обеспечивает трассировку развития участника по FPF: эволюционность через обновление модели, сквозную целостность от личных целей до глобальных систем, дидактическую прозрачность истории изменений.

## 0. Назначение документа

Этот документ описывает архитектуру, назначение и реализацию системы цифрового двойника (`S.DigitalTwinStorage`) в экосистеме. Терминология и обозначения сущностей соответствуют [[Словарь сущностей и правила обозначений для экосистемы развития]].

---

## 1. Назначение цифрового двойника

Цифровой двойник (`PRS.Twin`) — это **персонализированный контекст участника** (`PRS.Person`), который делает возможным:

### 1.1. Ключевые функции

1. **Персонализация траекторий развития** (`PTH.*`)
   - Адаптивные маршруты на основе текущей ступени роли Ученика (`STG.Student.*`)
   - Рекомендации руководств (`C.Guide.*`) и стажировок (`C.Internship.*`)
   - Динамическая сложность заданий от Проводника (`AGT.RouteGuide`)
   - Оптимизация слотов саморазвития (`SLT.*`)

2. **Отслеживание показателей развития** (`IND.*`, `MET.*`)
   - Первичные показатели (`IND.1.*`) — факты из событий (`E.*`)
   - Агрегированные показатели (`IND.2.*`) — вычисляемые метрики
   - Ступени роли Ученика (`IND.2.4.2` → `STG.Student.*`)
   - Степени квалификации МИМ (`IND.2.4.1` → `QLF.*`)
   - Статусы участия в экосистеме (`IND.2.5.1` → `STS.*`)

3. **Единый контекст для ИИ-агентов** (`AGT.*`)
   - `AGT.RouteGuide` — Проводник по персональному маршруту развития
   - `AGT.Navigator` — Навигатор по экосистеме
   - `AGT.Methodist` — Методологический ассистент
   - `AGT.Evaluator` — Ассистент для оценки

4. **Учёт вклада для токеномики** (`T.*`)
   - Полная история активностей (`E.*`)
   - Связь действий с результатами (`W.*` → Evidence)
   - Расчёт Proof-of-Impact
   - Справедливое распределение вознаграждений (`TKN.STK`)

5. **Развитие компетенций и квалификаций**
   - Трассировка роста по ступеням Ученика (`STG.Student.Random` → `STG.Student.Proactive`)
   - Присвоение квалификаций МИМ (`QLF.L1.Student` → `QLF.L8.PublicLeader`)
   - Портфолио достижений и рабочих продуктов (`W.*`)

---

## 2. Архитектура хранилища цифрового двойника

### 2.1. Централизованная система на базе SurrealDB

Принято решение создать **централизованную систему для хранения цифровых двойников** на базе **SurrealDB** (`S.DigitalTwinStorage`), которая:

- **Получает данные** из всех ИТ-систем экосистемы:
  - `S.LMS` — платформа обучения
  - `S.CommunityForum` — Клуб (systemsworld.club)
  - `S.AIPlatform` — ИИ-платформа
  - `S.TokenEngine` — система токеномики
  - Telegram-боты и другие интерфейсы (`INT.*`)

- **Записывает активные действия** (`E.*`) с дублированием исходных данных:
  - Пост из клуба → дублируется в хранилище ЦД + записывается событие `E.Club.PostCreated`
  - Завершение раздела в LMS → дублируется + событие `E.LMS.SectionCompleted`
  - Сообщение ИИ-боту → событие `E.Telegram.MessageToBot`

- **Хранит дополнительные данные**:
  - Полученные лайки и реакции по постам (`E.Club.LikeGiven`)
  - Комментарии и peer reviews
  - История взаимодействий участника

- **Отдаёт информацию** в другие подсистемы:
  - Проводник (`AGT.RouteGuide`) — для персонализации маршрута
  - Эпистемическая система — для отображения наград и календарика
  - Генератор персонального руководства

### 2.2. Обоснование выбора SurrealDB

- ✅ **Мультимодельность** — поддержка графов, документов и реляционных данных
- ✅ **Event-sourcing** — нативная поддержка live queries
- ✅ **Graph traversal** — для трассировки связей между сущностями
- ✅ **Масштабируемость** — горизонтальное масштабирование
- ✅ **Record-level permissions** — безопасность на уровне записей

### 2.3. Схема данных в SurrealDB

```surql
-- Цифровой двойник (PRS.Twin)
DEFINE TABLE twin SCHEMAFULL;
DEFINE FIELD person_id ON twin TYPE record(person);
DEFINE FIELD display_name ON twin TYPE string;
DEFINE FIELD current_stage ON twin TYPE string;  -- STG.Student.*
DEFINE FIELD qualification ON twin TYPE string;  -- QLF.*
DEFINE FIELD participation_status ON twin TYPE string;  -- STS.*
DEFINE FIELD preferences ON twin TYPE object;
DEFINE FIELD created_at ON twin TYPE datetime;
DEFINE FIELD updated_at ON twin TYPE datetime;

-- Показатели (MET.*)
DEFINE TABLE metric SCHEMAFULL;
DEFINE FIELD twin_id ON metric TYPE record(twin);
DEFINE FIELD indicator_code ON metric TYPE string;  -- IND.x.x.x
DEFINE FIELD value ON metric TYPE any;
DEFINE FIELD period_start ON metric TYPE datetime;
DEFINE FIELD period_end ON metric TYPE datetime;
DEFINE FIELD computed_at ON metric TYPE datetime;

-- События активных действий (E.*)
DEFINE TABLE activity_event SCHEMAFULL;
DEFINE FIELD twin_id ON activity_event TYPE record(twin);
DEFINE FIELD event_type ON activity_event TYPE string;  -- EVT.*
DEFINE FIELD source_system ON activity_event TYPE string;  -- S.*
DEFINE FIELD payload ON activity_event TYPE object;
DEFINE FIELD timestamp ON activity_event TYPE datetime;
DEFINE FIELD source_id ON activity_event TYPE string;  -- ID в исходной системе

-- Дублированный контент из Клуба
DEFINE TABLE club_post SCHEMAFULL;
DEFINE FIELD twin_id ON club_post TYPE record(twin);
DEFINE FIELD original_id ON club_post TYPE string;
DEFINE FIELD content ON club_post TYPE string;
DEFINE FIELD likes_count ON club_post TYPE int DEFAULT 0;
DEFINE FIELD comments_count ON club_post TYPE int DEFAULT 0;
DEFINE FIELD created_at ON club_post TYPE datetime;
DEFINE FIELD synced_at ON club_post TYPE datetime;

-- Слоты саморазвития (SLT.*)
DEFINE TABLE slot SCHEMAFULL;
DEFINE FIELD twin_id ON slot TYPE record(twin);
DEFINE FIELD slot_type ON slot TYPE string;  -- SLT.Planned, SLT.Actual
DEFINE FIELD scheduled_at ON slot TYPE datetime;
DEFINE FIELD duration_minutes ON slot TYPE int;
DEFINE FIELD method_used ON slot TYPE string;  -- M.*
DEFINE FIELD report ON slot TYPE option<record(work_product)>;

-- Рабочие продукты (W.*)
DEFINE TABLE work_product SCHEMAFULL;
DEFINE FIELD twin_id ON work_product TYPE record(twin);
DEFINE FIELD product_type ON work_product TYPE string;  -- W.Student.*, W.RouteGuide.*
DEFINE FIELD content ON work_product TYPE string;
DEFINE FIELD related_slot ON work_product TYPE option<record(slot)>;
DEFINE FIELD created_at ON work_product TYPE datetime;

-- Присвоения ступеней и квалификаций (STGA.*)
DEFINE TABLE stage_assignment SCHEMAFULL;
DEFINE FIELD twin_id ON stage_assignment TYPE record(twin);
DEFINE FIELD assignment_type ON stage_assignment TYPE string;  -- StudentStageAssigned, QualificationAssigned
DEFINE FIELD new_value ON stage_assignment TYPE string;  -- STG.* или QLF.*
DEFINE FIELD evidence_metrics ON stage_assignment TYPE array;  -- MET.* использованные
DEFINE FIELD assigned_at ON stage_assignment TYPE datetime;
DEFINE FIELD assigned_by ON stage_assignment TYPE option<record(person)>;
```

---

## 3. Интеграции с ИТ-системами

### 3.1. Входящие интеграции (источники данных)

| Система | Обозначение | Типы событий | Данные |
|---------|-------------|--------------|--------|
| Платформа обучения | `S.LMS` | `E.LMS.SectionCompleted`, `E.LMS.TaskAnswered` | Прогресс, оценки, время |
| Клуб | `S.CommunityForum` | `E.Club.PostCreated`, `E.Club.LikeGiven`, `E.Club.CommentAdded` | Посты, лайки, комментарии |
| Telegram-боты | `INT.Telegram.*` | `E.Telegram.MessageToBot` | Сообщения, команды |
| Система токеномики | `S.TokenEngine` | `E.Payment.Made`, `E.Token.Earned` | Транзакции, начисления |
| ORY (идентификация) | `S.ORY` | Создание identity | Согласия, роли |

### 3.2. Исходящие интеграции (потребители данных)

| Потребитель | Обозначение | Используемые данные |
|-------------|-------------|---------------------|
| Проводник по маршруту | `AGT.RouteGuide` | Ступень `STG.*`, показатели `MET.*`, история слотов `SLT.*` |
| Генератор персонального руководства | — | Граф понятий, прогресс по `C.Guide.*` |
| Эпистемическая система | `S.EpistemicGraph` | Награды, календарик достижений |
| ОС ИИ-платформы | `S.AIPlatform` | Полный контекст для агентов |
| Клуб (публичный профиль) | `S.CommunityForum` | Портфолио, репутация |

### 3.3. Пример потока данных

```
┌─────────────────────────────────────────────────────────────────────┐
│  1. КЛУБ: Участник публикует пост                                   │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  2. ХРАНИЛИЩЕ ЦД (SurrealDB):                                       │
│     • Дублирует пост в таблицу club_post                            │
│     • Записывает событие E.Club.PostCreated                         │
│     • Обновляет показатель IND.1.x.x (количество постов)            │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  3. ПОЛУЧЕНИЕ ЛАЙКОВ:                                               │
│     • Клуб отправляет событие E.Club.LikeGiven                      │
│     • Хранилище ЦД увеличивает likes_count в club_post              │
│     • Обновляется показатель MET.2.x.x (социальная активность)      │
└─────────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│  4. ПРОВОДНИК ИСПОЛЬЗУЕТ ДАННЫЕ:                                    │
│     • AGT.RouteGuide запрашивает контекст участника                 │
│     • Получает: текущую ступень STG.Student.*, показатели MET.*     │
│     • Формирует персонализированное задание W.RouteGuide.DailyAssignment │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. Показатели цифрового двойника

### 4.1. Первичные показатели (IND.1.*)

Факты, извлекаемые напрямую из событий (`E.*`):

| Код | Название | Источник события |
|-----|----------|------------------|
| `IND.1.1.1` | Количество учебных сессий | `E.LMS.SectionCompleted` |
| `IND.1.2.1` | Количество постов в клубе | `E.Club.PostCreated` |
| `IND.1.2.2` | Полученные лайки | `E.Club.LikeGiven` |
| `IND.1.3.1` | Сообщения ИИ-боту | `E.Telegram.MessageToBot` |
| `IND.1.4.1` | Совершённые платежи | `E.Payment.Made` |

### 4.2. Агрегированные показатели (IND.2.*)

Вычисляемые метрики на основе первичных:

| Код | Название | Формула/Логика |
|-----|----------|----------------|
| `IND.2.1.1` | Среднее число часов саморазвития в неделю | sum(SLT.Actual.duration) / weeks |
| `IND.2.2.1` | Индекс вовлечённости | composite(posts, comments, likes, sessions) |
| `IND.2.4.1` | Степень квалификации МИМ | Ссылка на `QLF.*` |
| `IND.2.4.2` | Текущая ступень роли Ученика | Ссылка на `STG.Student.*` |
| `IND.2.4.3` | Скорость движения по ступеням | delta(stage_assignments) / time |
| `IND.2.5.1` | Статус участия в экосистеме | Ссылка на `STS.*` |

### 4.3. Ступени роли Ученика (STG.Student.*)

Проводник (`AGT.RouteGuide`) диагностирует и сопровождает переход между ступенями:

| Обозначение | Название | Характеристика |
|-------------|----------|----------------|
| `STG.Student.Random` | Случайный ученик | Нерегулярная активность |
| `STG.Student.Practicing` | Практикующий ученик | Начал практиковать методы |
| `STG.Student.Systematic` | Систематический ученик | Регулярные слоты саморазвития |
| `STG.Student.Disciplined` | Дисциплинированный ученик | Устойчивые привычки |
| `STG.Student.Proactive` | Проактивный ученик | Самостоятельное развитие |

---

## 5. Планы миграции сервисов из LMS

### 5.1. Текущее состояние

В текущем бэкенде LMS (`S.LMS`) находятся сервисы, которые **не относятся напрямую** к обучению:

| Сервис | Текущее расположение | Целевая система | Статус миграции |
|--------|---------------------|-----------------|-----------------|
| Учёт наград | LMS | Эпистемическая система (`S.EpistemicGraph`) | Планируется |
| Календарик достижений | LMS | Эпистемическая система | Планируется |
| Заметки по руководству | LMS | Экзокортекс | Планируется |
| Вопросы и замечания | LMS | Экзокортекс | Планируется |
| Кабинет админа | LMS | **Не переносится** | На месте |

### 5.2. Детализация миграции

#### Учёт наград → Эпистемическая система

- **Награды** (badges, achievements) переносятся в `S.EpistemicGraph`
- **Сервис отображения** — визуализация достижений участника
- **Календарик** — хронология присвоения наград
- Данные берутся из хранилища ЦД (`S.DigitalTwinStorage`)

#### Заметки и замечания → Экзокортекс

- **Заметки** по разделам руководств (`C.Guide.*`)
- **Вопросы** по материалам
- **Замечания** и предложения по улучшению
- Связь с конкретными понятиями и методами (`M.*`)

#### Кабинет админа — остаётся в LMS

- Необходима связка с CRM (`S.CRM`)
- Интеграция с платёжной системой (`S.Billing`)
- Поддержка оплаты через Telegram-бота
- Миграция отложена до рефакторинга платёжного контура

### 5.3. Порядок миграции

1. **Фаза 1**: Реализация хранилища ЦД на SurrealDB
2. **Фаза 2**: Настройка интеграций с LMS и Клубом
3. **Фаза 3**: Миграция учёта наград в эпистемическую систему
4. **Фаза 4**: Миграция заметок в экзокортекс
5. **Фаза 5**: Генерация персонального руководства и Проводника

---

## 6. Генерация персонального руководства и Проводника

### 6.1. Архитектура после реализации хранилища ЦД

```
┌──────────────────────────────────────────────────────────────────┐
│                   ХРАНИЛИЩЕ ЦД (SurrealDB)                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐           │
│  │ PRS.Twin     │  │ MET.*        │  │ E.*          │           │
│  │ (профили)    │  │ (показатели) │  │ (события)    │           │
│  └──────────────┘  └──────────────┘  └──────────────┘           │
└──────────────────────────────────────────────────────────────────┘
                              │
              ┌───────────────┼───────────────┐
              ▼               ▼               ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ ГЕНЕРАТОР       │  │ ПРОВОДНИК       │  │ ЭПИСТЕМИЧЕСКАЯ  │
│ ПЕРСОНАЛЬНОГО   │  │ AGT.RouteGuide  │  │ СИСТЕМА         │
│ РУКОВОДСТВА     │  │                 │  │                 │
│                 │  │ • Диагностика   │  │ • Награды       │
│ • C.Guide.*     │  │   STG.Student.* │  │ • Календарик    │
│   + контекст    │  │ • Задания       │  │ • Статусы       │
│   участника     │  │ • Nudges        │  │                 │
└─────────────────┘  └─────────────────┘  └─────────────────┘
```

### 6.2. Персональное руководство

На основе данных из хранилища ЦД генерируется **персонализированное руководство**:

- **Адаптация примеров** под контекст участника (его проекты, домен)
- **Порядок изучения** на основе текущих навыков и ступени (`STG.*`)
- **Темп освоения** с учётом показателей `MET.2.1.1` (время саморазвития)
- **Дневник прохождения** — прогресс по руководству с рабочими продуктами (`W.*`)

### 6.3. Проводник по персональному маршруту

`AGT.RouteGuide` использует данные хранилища ЦД для:

1. **Диагностики текущей ступени** (`M.RouteGuide.CheckStudentStage`)
   - Анализ показателей `MET.*`
   - Определение `STG.Student.*`

2. **Генерации заданий** (`W.RouteGuide.DailyAssignment`)
   - На основе разрыва между текущим и целевым состоянием
   - С учётом доступных слотов (`SLT.Planned`)

3. **Обратной связи** (`W.RouteGuide.Feedback`)
   - Оценка выполненных заданий
   - Корректировка маршрута (`PTH.Student.PersonalRoute`)

4. **Адаптивных nudges**
   - При снижении активности
   - При достижении вех
   - При риске выгорания

---

## 7. API хранилища цифрового двойника

### 7.1. Основные эндпоинты

**Профиль участника (PRS.Twin):**
```
GET  /twin/:person_id                    # Получить цифрового двойника
PUT  /twin/:person_id                    # Обновить профиль
GET  /twin/:person_id/stage              # Текущая ступень STG.*
GET  /twin/:person_id/qualification      # Квалификация QLF.*
```

**Показатели (MET.*):**
```
GET  /twin/:person_id/metrics            # Все показатели
GET  /twin/:person_id/metrics/:code      # Конкретный показатель IND.x.x.x
POST /twin/:person_id/metrics/:code      # Записать значение
```

**События (E.*):**
```
POST /twin/:person_id/events             # Записать активное действие
GET  /twin/:person_id/events             # История событий
GET  /twin/:person_id/events?type=:evt   # Фильтр по типу EVT.*
```

**Контент из Клуба:**
```
GET  /twin/:person_id/club/posts         # Посты участника
GET  /twin/:person_id/club/posts/:id/likes  # Лайки по посту
```

**Слоты и рабочие продукты:**
```
GET  /twin/:person_id/slots              # Слоты саморазвития SLT.*
POST /twin/:person_id/slots              # Создать слот
GET  /twin/:person_id/work-products      # Рабочие продукты W.*
```

### 7.2. MCP-инструменты для агентов (TOOL.*)

| Инструмент | Назначение |
|------------|------------|
| `TOOL.DBTwin.QueryMetrics` | Чтение показателей из хранилища ЦД |
| `TOOL.DBTwin.WriteEvent` | Запись событий и агрегатов |
| `TOOL.DBTwin.GetContext` | Получение полного контекста для агента |
| `TOOL.DBTwin.UpdateStage` | Обновление ступени роли Ученика |

---

## 8. Метрики и мониторинг

### 8.1. Ключевые метрики

| Метрика | Целевое значение | Описание |
|---------|------------------|----------|
| Event Ingestion Latency (P95) | <100 мс | Время записи события |
| Query Latency (P95) | <50 мс | Время ответа на запрос |
| Data Sync Delay (LMS → ЦД) | <5 сек | Задержка синхронизации |
| Data Sync Delay (Club → ЦД) | <5 сек | Задержка синхронизации |
| API Availability | 99.9% | Доступность API |

### 8.2. Алерты

**Критические:**
- Хранилище ЦД недоступно
- Синхронизация с LMS/Клубом остановлена
- Потеря данных (event loss detected)

**Предупреждения:**
- Высокая задержка синхронизации (>30 сек)
- Низкое качество данных (много null-значений)
- Аномальный рост событий (возможный спам)

---

## 9. Roadmap

### v1.0 — MVP хранилища ЦД
- [ ] Развёртывание SurrealDB
- [ ] Базовая схема данных (twin, metric, activity_event)
- [ ] Интеграция с LMS (события `E.LMS.*`)
- [ ] Интеграция с Клубом (события `E.Club.*`, дублирование постов)
- [ ] API для чтения/записи показателей
- [ ] MCP-инструменты для Проводника

### v1.1 — Расширенная функциональность
- [ ] Миграция учёта наград в эпистемическую систему
- [ ] Диагностика ступеней Ученика (`STG.Student.*`)
- [ ] История присвоений (`STGA.*`)
- [ ] Календарик достижений

### v2.0 — Генерация персонального руководства
- [ ] Интеграция с графом понятий (Knowledge Graph)
- [ ] Генератор персонализированного руководства
- [ ] Дневник прохождения с прогрессом
- [ ] Полноценный Проводник (`AGT.RouteGuide`)

### v2.1 — Миграция заметок
- [ ] Экзокортекс для заметок и замечаний
- [ ] Связь заметок с понятиями (`M.*`, `C.Guide.*`)

---

## 10. Связанные документы

- [[Словарь сущностей и правила обозначений для экосистемы развития]] — терминология
- [[Карта подсистем 3.2]] — реестр всех систем
- [[Хаб активностей 3.2]] — источник событий
- [[Централизованное хранилище 3.2]] — Memory Bank
- [[LMS и обучение 3.2]] — платформа обучения
- [[Клуб 3.2]] — сообщество
- [[Эпистемический граф 3.2]] — эпистемическая система
- [[Персональный маршрут развития 2.3]] — маршруты участников

---

## 11. История изменений

| Дата | Версия | Описание |
|------|--------|----------|
| 2025-12-09 | 3.0 | Полное переписывание: SurrealDB как хранилище ЦД, терминология из Словаря сущностей, интеграции с LMS/Клубом, план миграции сервисов, генерация персонального руководства |
| 2025-11-12 | 2.0 | Предыдущая версия с PostgreSQL/TimescaleDB |
| [ранее] | 1.0 | Первоначальный концепт |

---

**Status:** 🟡 Draft
**Owner:** Architecture & Personalization Team
**Last Updated:** 2025-12-09

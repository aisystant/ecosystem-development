---
type: doc
audience: mixed
edit_mode: manual
layer: architecture
scope: local-edge
security: internal
status: draft
version: 2.1
created: 2025-11-12
updated: 2025-11-18
---

# 12. Единое хранилище знаний (Memory Bank)

Центральное хранилище знаний, контекста, эпистем, методописаний и трасс работ для всей экосистемы. Реализует принцип **дидактической прозрачности** через трассируемость от идеи до доказанного воздействия.

## Назначение

Основная цель системы и решаемые задачи:
- **Единый source of truth** для всех знаний экосистемы (Episteme, MethodDescription, Work, Evidence)
- **Трассируемость** — полная история от идеи до воздействия (shape → evidence → operate)
- **Контекст для ИИ-агентов** — RAG (Retrieval-Augmented Generation) для всех агентов экосистемы
- **Эволюционность знаний** — версионирование, статусы, улучшение через циклы обратной связи
- **Дидактическая прозрачность** — каждый артефакт показывает свою причинно-следственную дорожку
- **Сквозная целостность** — от личных целей до глобальных систем единая модель данных

## Три варианта концептуальной структуры

Ниже представлены три фундаментально разных подхода к организации знаний в Memory Bank. Каждый вариант имеет свои преимущества для разных сценариев использования.

---

## Вариант 1: Граф-центричная структура

### Концепция

Все сущности экосистемы представлены как **узлы графа знаний**, связанные **типизированными рёбрами**. Навигация и поиск происходят через обход графа. Каждый узел имеет тип, атрибуты и связи с другими узлами.

**Философия:** Знания — это сеть взаимосвязанных концепций. Понимание приходит через исследование связей.

### Структура узлов графа

```
ТИПЫ УЗЛОВ (Node Types):

┌─────────────────────────────────────────────────────────┐
│                  EPISTEME NODES                          │
│  (Знания, документы, модели, концепции)                │
│                                                          │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐        │
│  │  Document  │  │   Model    │  │  Concept   │        │
│  │            │  │            │  │            │        │
│  │ • id       │  │ • id       │  │ • id       │        │
│  │ • title    │  │ • name     │  │ • name     │        │
│  │ • content  │  │ • schema   │  │ • definition│       │
│  │ • layer    │  │ • purpose  │  │ • examples │        │
│  │ • status   │  │ • status   │  │ • status   │        │
│  │ • created  │  │ • version  │  │ • domain   │        │
│  └────────────┘  └────────────┘  └────────────┘        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│              METHOD DESCRIPTION NODES                    │
│  (Описания методов, практик, процессов)                │
│                                                          │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐        │
│  │  Method    │  │  Practice  │  │  Process   │        │
│  │            │  │            │  │            │        │
│  │ • id       │  │ • id       │  │ • id       │        │
│  │ • name     │  │ • name     │  │ • name     │        │
│  │ • steps    │  │ • technique│  │ • workflow │        │
│  │ • inputs   │  │ • context  │  │ • stages   │        │
│  │ • outputs  │  │ • evidence │  │ • actors   │        │
│  │ • precond. │  │ • outcomes │  │ • outcomes │        │
│  └────────────┘  └────────────┘  └────────────┘        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│                    WORK NODES                            │
│  (Трассы выполнения, действия, результаты)             │
│                                                          │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐        │
│  │ WorkTrace  │  │ Execution  │  │  Artifact  │        │
│  │            │  │            │  │            │        │
│  │ • id       │  │ • id       │  │ • id       │        │
│  │ • actor_id │  │ • work_id  │  │ • created_ │        │
│  │ • method   │  │ • timestamp│  │   by       │        │
│  │ • started  │  │ • action   │  │ • type     │        │
│  │ • finished │  │ • context  │  │ • content  │        │
│  │ • outcome  │  │ • result   │  │ • status   │        │
│  └────────────┘  └────────────┘  └────────────┘        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│                  EVIDENCE NODES                          │
│  (Доказательства, метрики, валидация)                  │
│                                                          │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐        │
│  │  Evidence  │  │   Metric   │  │   Review   │        │
│  │            │  │            │  │            │        │
│  │ • id       │  │ • id       │  │ • id       │        │
│  │ • type     │  │ • name     │  │ • reviewer │        │
│  │   formal   │  │ • value    │  │ • rating   │        │
│  │   empirical│  │ • unit     │  │ • comments │        │
│  │   social   │  │ • measured │  │ • approved │        │
│  │ • source   │  │ • baseline │  │ • date     │        │
│  │ • data     │  │ • target   │  │            │        │
│  └────────────┘  └────────────┘  └────────────┘        │
└─────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────┐
│                   PERSON NODES                           │
│  (Участники, роли, профили)                            │
│                                                          │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐        │
│  │   Person   │  │    Role    │  │  Agent     │        │
│  │            │  │            │  │            │        │
│  │ • id       │  │ • id       │  │ • id       │        │
│  │ • name     │  │ • name     │  │ • name     │        │
│  │ • twin_id  │  │ • responsi-│  │ • purpose  │        │
│  │ • skills   │  │   bilities │  │ • tools    │        │
│  │ • goals    │  │ • permissi-│  │ • owner    │        │
│  │ • context  │  │   ons      │  │ • status   │        │
│  └────────────┘  └────────────┘  └────────────┘        │
└─────────────────────────────────────────────────────────┘
```

### Типы связей (рёбер графа)

```
СВЯЗИ МЕЖДУ УЗЛАМИ (Edge Types):

┌──────────────────────────────────────────────────────────┐
│  СТРУКТУРНЫЕ СВЯЗИ (Structure)                          │
├──────────────────────────────────────────────────────────┤
│  • CONTAINS       — иерархия (документ содержит раздел) │
│  • PART_OF        — принадлежность                      │
│  • REFERENCES     — ссылка на другой артефакт           │
│  • BUILDS_ON      — основывается на предыдущем          │
│  • SUPERSEDES     — заменяет устаревший                 │
│  • RELATED_TO     — общая тематическая связь            │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  ПРОЦЕССНЫЕ СВЯЗИ (Process)                             │
├──────────────────────────────────────────────────────────┤
│  • USES_METHOD    — Work использует MethodDescription   │
│  • PRODUCES       — Work производит Artifact            │
│  • EXECUTED_BY    — выполнено участником                │
│  • TRANSFORMS     — преобразует входной артефакт        │
│  • TRIGGERS       — инициирует другой Work              │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  ЭПИСТЕМИЧЕСКИЕ СВЯЗИ (Epistemic)                       │
├──────────────────────────────────────────────────────────┤
│  • EVIDENCES      — Evidence подтверждает Claim         │
│  • SUPPORTS       — поддерживает утверждение            │
│  • CONTRADICTS    — противоречит                        │
│  • DERIVES_FROM   — выводится из                        │
│  • VALIDATES      — валидирует (review → episteme)      │
│  • HAS_STATUS     — связь со статусом (ESG)             │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  СОЦИАЛЬНЫЕ СВЯЗИ (Social)                              │
├──────────────────────────────────────────────────────────┤
│  • CREATED_BY     — создано участником                  │
│  • MENTORED_BY    — курировал процесс                   │
│  • REVIEWED_BY    — проверено участником                │
│  • COLLABORATES   — совместная работа                   │
│  • BELONGS_TO     — принадлежит группе/проекту          │
└──────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────┐
│  IMPACT-СВЯЗИ (Impact & Value)                          │
├──────────────────────────────────────────────────────────┤
│  • CONTRIBUTES_TO — вносит вклад в цель                 │
│  • MEASURES       — метрика измеряет Work               │
│  • IMPROVES       — улучшает показатель                 │
│  • ENABLES        — делает возможным                    │
│  • APPLIES_TO     — применяется в контексте             │
└──────────────────────────────────────────────────────────┘
```

### Пример графа знаний

```
Пример: Создание и валидация методики

     ┌──────────────┐
     │   Person:    │
     │  "Алексей"   │
     └──────┬───────┘
            │ CREATED_BY
            ↓
     ┌──────────────────────────┐
     │  MethodDescription:      │
     │  "Системное мышление"    │
     │  layer: methodology      │
     │  status: draft           │
     └─────┬──────────┬─────────┘
           │          │
           │          │ BUILDS_ON
           │          ↓
           │   ┌──────────────────┐
           │   │  Concept:        │
           │   │  "Холизм"        │
           │   │  domain: systems │
           │   └──────────────────┘
           │
           │ USES_METHOD
           ↓
     ┌──────────────────────────┐
     │  WorkTrace:              │
     │  "Пилот методики"        │
     │  started: 2025-01-15     │
     │  finished: 2025-02-28    │
     └─────┬──────────┬─────────┘
           │          │
           │PRODUCES  │ EXECUTED_BY
           ↓          ↓
     ┌─────────┐  ┌──────────────┐
     │Artifact:│  │   Person:    │
     │"Отчет"  │  │  "Мария"     │
     └────┬────┘  └──────────────┘
          │
          │ EVIDENCES
          ↓
     ┌──────────────────────────┐
     │  Evidence:               │
     │  type: empirical         │
     │  source: survey_results  │
     │  data: {n: 50, Δ: +35%}  │
     └─────┬────────────────────┘
           │
           │ VALIDATES
           ↓
     ┌──────────────────────────┐
     │  Review:                 │
     │  reviewer: "Эксперт"     │
     │  rating: 4.5/5           │
     │  approved: true          │
     └─────┬────────────────────┘
           │
           │ HAS_STATUS (transition)
           ↓
     ┌──────────────────────────┐
     │  MethodDescription:      │
     │  "Системное мышление"    │
     │  status: ACCEPTED  ← обновлено
     └──────────────────────────┘
```

### Запросы к графу

**Запрос 1: Найти все методы, используемые в успешных Work**
```cypher
MATCH (w:WorkTrace)-[:USES_METHOD]->(m:MethodDescription)
WHERE w.outcome = 'success'
RETURN m.name, count(w) as usage_count
ORDER BY usage_count DESC
```

**Запрос 2: Трассировка от идеи до доказательства**
```cypher
MATCH path = (c:Concept)-[:BUILDS_ON*]-(m:MethodDescription)
             -[:USES_METHOD]-(w:WorkTrace)
             -[:PRODUCES]-(a:Artifact)
             -[:EVIDENCES]-(e:Evidence)
WHERE c.name = 'Системное мышление'
RETURN path
```

**Запрос 3: Найти экспертов по теме (через граф работ)**
```cypher
MATCH (p:Person)-[:CREATED_BY|EXECUTED_BY]-(w:WorkTrace)
      -[:USES_METHOD]-(m:MethodDescription)
WHERE m.domain CONTAINS 'systems thinking'
WITH p, count(w) as work_count
WHERE work_count > 5
RETURN p.name, work_count, p.skills
ORDER BY work_count DESC
```

### Преимущества и ограничения

**Преимущества:**
- ✅ **Естественная трассируемость** — легко проследить цепочки причин и следствий
- ✅ **Гибкость запросов** — любые сложные связи можно выразить через обход графа
- ✅ **Эволюционность** — легко добавлять новые типы узлов и связей
- ✅ **Семантическая навигация** — обход по смысловым связям, а не по иерархии
- ✅ **Визуализация** — граф можно визуализировать для понимания взаимосвязей

**Ограничения:**
- ❌ **Производительность на больших объёмах** — обход глубоких графов может быть медленным
- ❌ **Сложность поддержки** — много типов связей требуют тщательного моделирования
- ❌ **Консистентность** — легко создать противоречивые связи
- ❌ **Версионирование графа** — сложно откатывать изменения структуры

### Когда использовать

- ✅ Приоритет на **трассируемость** и **прозрачность** причинно-следственных связей
- ✅ Нужны **сложные запросы** типа "найди все методы, основанные на X и успешно применённые командой Y"
- ✅ **Эволюционирующая онтология** — типы связей и узлов меняются со временем
- ✅ Важна **визуализация** знаний для участников

---

## Вариант 2: Слоистая структура (Semantic Layers)

### Концепция

Знания организованы в **семантические слои** согласно уровню абстракции и назначению. Каждый слой имеет свои типы артефактов, правила и связи. Навигация происходит как горизонтально (внутри слоя), так и вертикально (между слоями).

**Философия:** Знания имеют уровни абстракции — от философских принципов до конкретных данных. Структура отражает эту иерархию.

### Структура слоёв

```
СЕМАНТИЧЕСКИЕ СЛОИ (Semantic Layers):

┌────────────────────────────────────────────────────────────┐
│  СЛОЙ 0: PHILOSOPHY (Философия и принципы)                │
│  Зачем? Ценности, миссия, инварианты                      │
├────────────────────────────────────────────────────────────┤
│  Артефакты:                                                │
│  • Principles (принципы)                                   │
│  • Values (ценности)                                       │
│  • Invariants (инварианты FPF)                            │
│  • Vision (видение)                                        │
│                                                             │
│  Примеры:                                                  │
│  - "Эволюционность"                                       │
│  - "Сквозная целостность по масштабу"                     │
│  - "Дидактическая прозрачность"                           │
└────────────────────────────────────────────────────────────┘
                           │ влияет на
                           ↓
┌────────────────────────────────────────────────────────────┐
│  СЛОЙ 1: METHODOLOGY (Методология)                        │
│  Как мыслить? Методы, практики, подходы                  │
├────────────────────────────────────────────────────────────┤
│  Артефакты:                                                │
│  • Methods (методы)                                        │
│  • Practices (практики)                                    │
│  • Frameworks (фреймворки)                                │
│  • Heuristics (эвристики)                                 │
│                                                             │
│  Примеры:                                                  │
│  - "Системное мышление"                                   │
│  - "Shape → Evidence → Operate"                           │
│  - "C4 + ADR"                                             │
└────────────────────────────────────────────────────────────┘
                           │ реализуется через
                           ↓
┌────────────────────────────────────────────────────────────┐
│  СЛОЙ 2: ONTOLOGY (Онтология)                            │
│  Что? Понятия, модели, таксономии                        │
├────────────────────────────────────────────────────────────┤
│  Артефакты:                                                │
│  • Concepts (концепции)                                    │
│  • Models (модели данных)                                 │
│  • Taxonomies (классификации)                             │
│  • Relationships (отношения)                              │
│                                                             │
│  Примеры:                                                  │
│  - "Episteme"                                             │
│  - "MethodDescription"                                    │
│  - "Work"                                                 │
│  - "Evidence"                                             │
└────────────────────────────────────────────────────────────┘
                           │ описывает
                           ↓
┌────────────────────────────────────────────────────────────┐
│  СЛОЙ 3: PROGRAM (Программы и цели)                      │
│  Куда? Стратегии, OKR, roadmaps                          │
├────────────────────────────────────────────────────────────┤
│  Артефакты:                                                │
│  • Programs (программы развития)                          │
│  • Objectives & Key Results (OKR)                         │
│  • Roadmaps (дорожные карты)                             │
│  • Goals (цели)                                           │
│                                                             │
│  Примеры:                                                  │
│  - "Развитие навыков системного анализа"                 │
│  - "OKR: Обучить 1000 участников за Q1"                  │
│  - "Roadmap: Memory Bank v2.0"                           │
└────────────────────────────────────────────────────────────┘
                           │ декомпозируется в
                           ↓
┌────────────────────────────────────────────────────────────┐
│  СЛОЙ 4: REQUIREMENTS (Требования)                        │
│  Что нужно? Функциональные и нефункциональные требования │
├────────────────────────────────────────────────────────────┤
│  Артефакты:                                                │
│  • User Stories                                            │
│  • Use Cases                                               │
│  • Non-Functional Requirements                            │
│  • Acceptance Criteria                                    │
│                                                             │
│  Примеры:                                                  │
│  - "Как участник, я хочу найти методику по ключевому слову"│
│  - "Latency p95 < 200ms"                                  │
│  - "Availability 99.9%"                                   │
└────────────────────────────────────────────────────────────┘
                           │ проектируется как
                           ↓
┌────────────────────────────────────────────────────────────┐
│  СЛОЙ 5: ARCHITECTURE (Архитектура)                      │
│  Как устроено? Компоненты, интерфейсы, решения           │
├────────────────────────────────────────────────────────────┤
│  Артефакты:                                                │
│  • Components (компоненты)                                 │
│  • ADR (архитектурные решения)                            │
│  • API Contracts                                           │
│  • System Diagrams                                        │
│                                                             │
│  Примеры:                                                  │
│  - "ADR-001: Выбор Neo4j для графа знаний"               │
│  - "API: /query_knowledge"                                │
│  - "C4 Context diagram"                                   │
└────────────────────────────────────────────────────────────┘
                           │ реализуется в
                           ↓
┌────────────────────────────────────────────────────────────┐
│  СЛОЙ 6: SERVICE (Сервисы и операции)                    │
│  Как работает? Код, конфигурация, deployment             │
├────────────────────────────────────────────────────────────┤
│  Артефакты:                                                │
│  • Source Code                                             │
│  • Configurations                                          │
│  • Deployments                                            │
│  • Runbooks                                               │
│                                                             │
│  Примеры:                                                  │
│  - "memory-bank-service.py"                               │
│  - "k8s/deployment.yaml"                                  │
│  - "Runbook: Database failover"                           │
└────────────────────────────────────────────────────────────┘
                           │ генерирует
                           ↓
┌────────────────────────────────────────────────────────────┐
│  СЛОЙ 7: DATA (Данные и артефакты)                       │
│  Что есть? Конкретные экземпляры, факты, результаты      │
├────────────────────────────────────────────────────────────┤
│  Артефакты:                                                │
│  • Data Records                                            │
│  • Work Traces                                            │
│  • Artifacts                                              │
│  • Evidence                                               │
│                                                             │
│  Примеры:                                                  │
│  - "Work ID 12345: Анализ кейса X"                       │
│  - "Evidence: Survey results, n=50"                       │
│  - "Artifact: Report.pdf"                                 │
└────────────────────────────────────────────────────────────┘
```

### Вертикальные связи между слоями

```
СВЯЗИ МЕЖДУ СЛОЯМИ (Cross-Layer Relations):

Philosophy
    │
    ├─ DRIVES ────────→ Methodology
    │                       │
    └─ CONSTRAINS ─────→ Requirements
                            │
Methodology                 │
    │                       │
    ├─ DEFINES ────────→ Ontology
    │                       │
    └─ GUIDES ─────────→ Architecture
                            │
Ontology                    │
    │                       │
    ├─ DESCRIBES ──────→ Data
    │                       │
    └─ STRUCTURES ─────→ Service
                            │
Program                     │
    │                       │
    ├─ DECOMPOSES_TO ──→ Requirements
    │                       │
    └─ MEASURES ───────→ Data (metrics)
                            │
Requirements                │
    │                       │
    ├─ SATISFIED_BY ───→ Architecture
    │                       │
    └─ VALIDATED_BY ───→ Data (tests)
                            │
Architecture                │
    │                       │
    ├─ IMPLEMENTED_IN ─→ Service
    │                       │
    └─ PRODUCES ───────→ Data
                            │
Service                     │
    │                       │
    └─ EXECUTES ───────→ Data (Work traces)
```

### Пример слоистой организации

```
Пример: Развитие навыка "Системное мышление"

┌─ PHILOSOPHY ─────────────────────────────────────────┐
│  Principle: "Сквозная целостность по масштабу"      │
│  Value: "Эволюционность через обратную связь"      │
└──────────────────────────────────────────────────────┘
           │ DRIVES
           ↓
┌─ METHODOLOGY ────────────────────────────────────────┐
│  Method: "Системное мышление"                       │
│  Practice: "Холистический анализ кейсов"           │
│  Framework: "Shape → Evidence → Operate"           │
└──────────────────────────────────────────────────────┘
           │ DEFINES
           ↓
┌─ ONTOLOGY ───────────────────────────────────────────┐
│  Concept: "Холизм"                                  │
│  Model: "MethodDescription"                         │
│  Relationship: Method USES Concept                  │
└──────────────────────────────────────────────────────┘
           │ DESCRIBES
           ↓
┌─ PROGRAM ────────────────────────────────────────────┐
│  Program: "Развитие навыков системного анализа"    │
│  OKR: "Обучить 1000 участников методу за Q1"       │
│  Roadmap: Phase 1 → Phase 2 → Phase 3              │
└──────────────────────────────────────────────────────┘
           │ DECOMPOSES_TO
           ↓
┌─ REQUIREMENTS ───────────────────────────────────────┐
│  User Story: "Как участник, хочу найти метод..."   │
│  Acceptance: "Участник может найти за <30 сек"     │
│  NFR: "Поиск работает с latency <200ms"           │
└──────────────────────────────────────────────────────┘
           │ SATISFIED_BY
           ↓
┌─ ARCHITECTURE ───────────────────────────────────────┐
│  Component: "Memory Bank Search Service"           │
│  ADR: "ADR-003: Semantic search через embeddings"  │
│  API: "POST /search {query, filters}"              │
└──────────────────────────────────────────────────────┘
           │ IMPLEMENTED_IN
           ↓
┌─ SERVICE ────────────────────────────────────────────┐
│  Code: "search_service.py"                          │
│  Config: "vector_db_config.yaml"                   │
│  Deployment: "k8s/search-service.yaml"             │
└──────────────────────────────────────────────────────┘
           │ EXECUTES
           ↓
┌─ DATA ───────────────────────────────────────────────┐
│  Work: "Поиск методики ID 789"                     │
│  Evidence: "Query latency: 127ms"                  │
│  Artifact: "Search results: 15 methods found"      │
└──────────────────────────────────────────────────────┘
```

### Преимущества и ограничения

**Преимущества:**
- ✅ **Иерархическая ясность** — чёткое разделение уровней абстракции
- ✅ **Масштабируемость понимания** — можно фокусироваться на одном слое
- ✅ **Сквозная трассируемость** — от философии до данных через вертикальные связи
- ✅ **Управление сложностью** — каждый слой решает свой класс задач
- ✅ **Governance** — разные слои могут управляться разными ролями

**Ограничения:**
- ❌ **Жёсткость** — сложно добавлять артефакты, не попадающие в слои
- ❌ **Overhead на поддержку** — нужно следить за консистентностью связей между слоями
- ❌ **Ограниченная гибкость запросов** — сложные связи внутри слоя менее выражены
- ❌ **Риск siloing** — слои могут развиваться изолированно

### Когда использовать

- ✅ Приоритет на **управление сложностью** через иерархию
- ✅ Нужна **governance** с разными ролями для разных слоёв (архитекторы vs разработчики vs участники)
- ✅ Важна **сквозная целостность** от философии до реализации
- ✅ Команда большая (>20 человек), нужно разделение ответственности

---

## Вариант 3: Поточная структура (Event-Sourced Streams)

### Концепция

Все знания и действия представлены как **потоки событий** (event streams). Текущее состояние — это результат применения (replay) всех событий. Трассируемость достигается через просмотр истории потока.

**Философия:** Знания — это не статические артефакты, а процесс. Важна не точка назначения, а путь.

### Структура потоков

```
ПОТОКИ СОБЫТИЙ (Event Streams):

┌────────────────────────────────────────────────────────────┐
│  CURATED STREAM (Курированные знания)                     │
│  Source: Эксперты, команда, эпистемический совет          │
├────────────────────────────────────────────────────────────┤
│  События:                                                  │
│  • EPISTEME_CREATED                                        │
│  • EPISTEME_UPDATED                                        │
│  • EPISTEME_STATUS_CHANGED (Draft→PeerChecked→Accepted)   │
│  • METHOD_DESCRIBED                                        │
│  • CONCEPT_DEFINED                                         │
│  • ONTOLOGY_EXTENDED                                       │
│                                                             │
│  Пример события:                                           │
│  {                                                         │
│    event_id: "evt_001",                                    │
│    type: "EPISTEME_CREATED",                              │
│    timestamp: "2025-01-15T10:30:00Z",                     │
│    actor: "expert@example.com",                           │
│    payload: {                                             │
│      episteme_id: "ep_789",                               │
│      title: "Системное мышление",                         │
│      content: "...",                                      │
│      layer: "methodology",                                │
│      status: "draft"                                      │
│    }                                                       │
│  }                                                         │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│  DERIVED STREAM (Производные артефакты)                   │
│  Source: ИИ-агенты, ETL, автоматические процессы          │
├────────────────────────────────────────────────────────────┤
│  События:                                                  │
│  • ARTIFACT_GENERATED (ИИ создал черновик)                │
│  • INDEX_UPDATED (обновлён поисковый индекс)              │
│  • EMBEDDING_CREATED (векторное представление)            │
│  • AGGREGATION_COMPUTED (метрики пересчитаны)             │
│  • RECOMMENDATION_GENERATED                               │
│                                                             │
│  Пример:                                                   │
│  {                                                         │
│    event_id: "evt_002",                                    │
│    type: "EMBEDDING_CREATED",                             │
│    timestamp: "2025-01-15T10:31:05Z",                     │
│    actor: "embedding-service",                            │
│    payload: {                                             │
│      source_episteme_id: "ep_789",                        │
│      vector: [0.23, -0.45, ...],  // 1536 dims           │
│      model: "openai-ada-002"                              │
│    }                                                       │
│  }                                                         │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│  WORK STREAM (Трассы выполнения)                          │
│  Source: Участники, ИИ-агенты                             │
├────────────────────────────────────────────────────────────┤
│  События:                                                  │
│  • WORK_STARTED                                            │
│  • ACTION_EXECUTED                                         │
│  • RESULT_PRODUCED                                         │
│  • WORK_COMPLETED                                          │
│  • WORK_FAILED                                             │
│                                                             │
│  Пример:                                                   │
│  {                                                         │
│    event_id: "evt_003",                                    │
│    type: "WORK_STARTED",                                   │
│    timestamp: "2025-02-01T14:00:00Z",                     │
│    actor: "participant_id_123",                           │
│    payload: {                                             │
│      work_id: "work_456",                                  │
│      method_used: "ep_789",  // ссылка на методику        │
│      context: {                                           │
│        goal: "Провести системный анализ кейса",          │
│        resources: ["case_study.pdf"]                      │
│      }                                                     │
│    }                                                       │
│  }                                                         │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│  EVIDENCE STREAM (Поток доказательств)                    │
│  Source: Измерения, ревью, валидация                      │
├────────────────────────────────────────────────────────────┤
│  События:                                                  │
│  • EVIDENCE_ADDED                                          │
│  • METRIC_MEASURED                                         │
│  • REVIEW_SUBMITTED                                        │
│  • CLAIM_VALIDATED                                         │
│  • IMPACT_CONFIRMED                                        │
│                                                             │
│  Пример:                                                   │
│  {                                                         │
│    event_id: "evt_004",                                    │
│    type: "EVIDENCE_ADDED",                                 │
│    timestamp: "2025-02-28T16:45:00Z",                     │
│    actor: "participant_id_123",                           │
│    payload: {                                             │
│      evidence_id: "evd_999",                              │
│      related_work: "work_456",                            │
│      type: "empirical",                                    │
│      source: "survey_results",                            │
│      data: {                                              │
│        n: 50,                                              │
│        improvement: "+35%",                               │
│        confidence: 0.85                                    │
│      }                                                     │
│    }                                                       │
│  }                                                         │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│  IMPACT STREAM (Поток воздействия)                        │
│  Source: Proof-of-Impact система                          │
├────────────────────────────────────────────────────────────┤
│  События:                                                  │
│  • IMPACT_SUBMITTED (отправлено на оценку)                │
│  • WEIGHT_CALCULATED (рассчитан вес доказательств)        │
│  • REWARD_CALCULATED (вознаграждение рассчитано)          │
│  • TOKENS_DISTRIBUTED (токены распределены)               │
│  • TOKENS_UNFROZEN (заморозка снята)                      │
│                                                             │
│  Пример:                                                   │
│  {                                                         │
│    event_id: "evt_005",                                    │
│    type: "TOKENS_DISTRIBUTED",                            │
│    timestamp: "2025-03-01T10:00:00Z",                     │
│    actor: "poi-service",                                  │
│    payload: {                                             │
│      work_id: "work_456",                                  │
│      total_tokens: 1000,                                   │
│      split: {                                             │
│        author: 500,      // 50%                           │
│        mentor: 300,      // 30%                           │
│        treasury: 200     // 20%                           │
│      },                                                    │
│      frozen_until: "2025-05-01T00:00:00Z" // 60 days     │
│    }                                                       │
│  }                                                         │
└────────────────────────────────────────────────────────────┘
```

### Агрегации и снимки (Aggregates & Snapshots)

```
АГРЕГАТЫ (Materialized Views из потоков):

┌────────────────────────────────────────────────────────────┐
│  EPISTEME AGGREGATE                                        │
│  Источник: CURATED_STREAM + EVIDENCE_STREAM                │
├────────────────────────────────────────────────────────────┤
│  Структура:                                                │
│  {                                                         │
│    episteme_id: "ep_789",                                  │
│    current_version: 3,                                     │
│    title: "Системное мышление",                           │
│    status: "ACCEPTED",  // последнее STATUS_CHANGED       │
│    created_at: "2025-01-15T10:30:00Z",                    │
│    updated_at: "2025-03-10T14:22:00Z",                    │
│    created_by: "expert@example.com",                      │
│    evidence_count: 5,   // агрегация EVIDENCE_ADDED       │
│    usage_count: 127,    // агрегация WORK_STARTED         │
│    avg_impact_score: 0.82  // агрегация IMPACT_CONFIRMED │
│  }                                                         │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│  WORK TRACE AGGREGATE                                      │
│  Источник: WORK_STREAM + EVIDENCE_STREAM + IMPACT_STREAM   │
├────────────────────────────────────────────────────────────┤
│  Структура:                                                │
│  {                                                         │
│    work_id: "work_456",                                    │
│    status: "COMPLETED",                                    │
│    started_at: "2025-02-01T14:00:00Z",                    │
│    completed_at: "2025-02-28T16:45:00Z",                  │
│    method_used: "ep_789",                                  │
│    actor: "participant_id_123",                           │
│    evidence: ["evd_999", "evd_1000"],                     │
│    impact_weight: 0.85,                                    │
│    tokens_earned: 1000,                                    │
│    tokens_frozen: true,                                    │
│    unfreezes_at: "2025-05-01T00:00:00Z"                   │
│  }                                                         │
└────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────┐
│  DIGITAL TWIN AGGREGATE                                    │
│  Источник: Все потоки (проекция на участника)             │
├────────────────────────────────────────────────────────────┤
│  Структура:                                                │
│  {                                                         │
│    participant_id: "participant_id_123",                  │
│    total_works: 42,                                        │
│    completed_works: 38,                                    │
│    methods_mastered: ["ep_789", "ep_456", ...],           │
│    total_tokens_earned: 45000,                            │
│    total_tokens_frozen: 5000,                             │
│    avg_impact_score: 0.78,                                │
│    epistemic_reputation: 4.3/5,                           │
│    last_activity: "2025-03-10T14:22:00Z"                  │
│  }                                                         │
└────────────────────────────────────────────────────────────┘
```

### Пример поточной трассировки

```
Трассировка: От создания метода до подтверждённого воздействия

TIME: 2025-01-15 10:30:00
STREAM: CURATED_STREAM
EVENT: EPISTEME_CREATED
  → episteme_id: "ep_789"
  → title: "Системное мышление"
  → status: "draft"
  → created_by: "expert@example.com"

TIME: 2025-01-15 10:31:05
STREAM: DERIVED_STREAM
EVENT: EMBEDDING_CREATED
  → source_episteme_id: "ep_789"
  → vector: [0.23, -0.45, ...]

TIME: 2025-02-01 14:00:00
STREAM: WORK_STREAM
EVENT: WORK_STARTED
  → work_id: "work_456"
  → method_used: "ep_789"  ← использована методика!
  → actor: "participant_id_123"

TIME: 2025-02-28 16:45:00
STREAM: WORK_STREAM
EVENT: WORK_COMPLETED
  → work_id: "work_456"
  → outcome: "success"

TIME: 2025-02-28 17:00:00
STREAM: EVIDENCE_STREAM
EVENT: EVIDENCE_ADDED
  → evidence_id: "evd_999"
  → related_work: "work_456"
  → data: {n: 50, improvement: "+35%"}

TIME: 2025-03-01 09:00:00
STREAM: EVIDENCE_STREAM
EVENT: REVIEW_SUBMITTED
  → evidence_id: "evd_999"
  → reviewer: "expert_panel"
  → approved: true

TIME: 2025-03-01 10:00:00
STREAM: IMPACT_STREAM
EVENT: WEIGHT_CALCULATED
  → work_id: "work_456"
  → evidence_weight: 0.85

TIME: 2025-03-01 10:05:00
STREAM: IMPACT_STREAM
EVENT: TOKENS_DISTRIBUTED
  → work_id: "work_456"
  → total_tokens: 1000
  → split: {author: 500, mentor: 300, treasury: 200}
  → frozen_until: "2025-05-01"

TIME: 2025-03-10 12:00:00
STREAM: CURATED_STREAM
EVENT: EPISTEME_STATUS_CHANGED
  → episteme_id: "ep_789"
  → old_status: "draft"
  → new_status: "ACCEPTED"  ← метод принят!
  → reason: "Validated by 3 successful Works with strong evidence"

TIME: 2025-05-01 00:00:00
STREAM: IMPACT_STREAM
EVENT: TOKENS_UNFROZEN
  → work_id: "work_456"
  → tokens_released: 1000
  → reason: "Regression window passed, no issues detected"

ИТОГ:
  - Метод создан → использован → доказан → принят
  - Участник получил токены за доказанное воздействие
  - Полная прозрачность каждого шага
```

### Запросы к потокам

**Запрос 1: Replay событий для восстановления состояния**
```sql
-- Восстановить текущий статус Episteme "ep_789"
SELECT * FROM curated_stream
WHERE payload->>'episteme_id' = 'ep_789'
ORDER BY timestamp ASC;

-- Применить события последовательно:
-- 1. EPISTEME_CREATED → status = "draft"
-- 2. EPISTEME_STATUS_CHANGED → status = "ACCEPTED"
```

**Запрос 2: Найти все Work, использовавшие метод**
```sql
SELECT payload->>'work_id', actor, timestamp
FROM work_stream
WHERE type = 'WORK_STARTED'
  AND payload->>'method_used' = 'ep_789'
ORDER BY timestamp DESC;
```

**Запрос 3: Рассчитать impact score участника**
```sql
-- Агрегация из IMPACT_STREAM
SELECT actor,
       SUM((payload->>'total_tokens')::int) as total_tokens,
       AVG((payload->>'evidence_weight')::float) as avg_weight,
       COUNT(*) as works_count
FROM impact_stream
WHERE type = 'TOKENS_DISTRIBUTED'
  AND timestamp >= '2025-01-01'
GROUP BY actor
ORDER BY total_tokens DESC;
```

### Преимущества и ограничения

**Преимущества:**
- ✅ **Полная аудитируемость** — каждое изменение записано как событие
- ✅ **Воспроизводимость** — можно replay события для восстановления состояния
- ✅ **Temporal queries** — легко отвечать на вопросы "что было на момент X"
- ✅ **Масштабируемость** — event streams хорошо шардируются
- ✅ **Интеграция** — другие системы могут подписываться на потоки

**Ограничения:**
- ❌ **Сложность запросов** — для текущего состояния нужны агрегаты
- ❌ **Overhead хранения** — все события хранятся вечно (или нужны политики удаления)
- ❌ **Eventual consistency** — агрегаты обновляются асинхронно
- ❌ **Сложность отладки** — нужно replay многих событий для понимания

### Когда использовать

- ✅ Приоритет на **аудит и compliance** — нужна полная история
- ✅ **Временные запросы** важны — "покажи состояние на 2025-01-01"
- ✅ **Event-driven архитектура** — другие системы подписываются на изменения
- ✅ **Proof-of-Impact** критичен — каждый шаг трассируется

---

## Интеграции между вариантами

Варианты структур не взаимоисключающие — их можно комбинировать:

```
ГИБРИДНЫЙ ПОДХОД:

┌─────────────────────────────────────────────────────────┐
│  СЛОЙ ХРАНЕНИЯ: Event Streams (Вариант 3)             │
│  • Append-only log всех изменений                      │
│  • Source of truth для аудита                          │
└─────────────────────────────────────────────────────────┘
                        │
                        │ проецируется в
                        ↓
┌─────────────────────────────────────────────────────────┐
│  СЛОЙ ПРЕДСТАВЛЕНИЯ: Граф знаний (Вариант 1)          │
│  • Материализованное представление из событий          │
│  • Оптимизировано для навигации и поиска связей       │
└─────────────────────────────────────────────────────────┘
                        │
                        │ организован как
                        ↓
┌─────────────────────────────────────────────────────────┐
│  СЛОЙ ДОСТУПА: Семантические слои (Вариант 2)         │
│  • Фильтры и виды для разных ролей                    │
│  • Архитекторы видят Architecture layer               │
│  • Участники видят Methodology + Data layers          │
└─────────────────────────────────────────────────────────┘
```

---

## Технологическая реализация: комбинированный подход

### SurrealDB как основное хранилище

Принято решение использовать **SurrealDB** как ключевую платформу для Memory Bank и всех операционных данных экосистемы (см. [[0.3. Решения#ADR-003]]).

**Обоснование выбора SurrealDB:**
- ✅ **Мультимодельность** — поддержка графов, документов и реляционных таблиц в одной базе
- ✅ **Event-sourcing** — нативная поддержка live queries и изменений
- ✅ **Граф знаний** — встроенный механизм graph traversal для трассируемости
- ✅ **Масштабируемость** — горизонтальное масштабирование для роста до миллиона участников
- ✅ **Безопасность** — встроенная авторизация на уровне записей (Record-level permissions)

### Что хранится в SurrealDB

1. **Цифровой след стажеров (Digital Shadow)**
   - Активные действия
   - Заметки и ссылки
   - Источники информации
   - Комментарии
   - История взаимодействий

2. **Операционные данные**
   - Метрики
   - Логи событий (Activity Hub)
   - Эпистемические статусы
   - Доказательства (Evidence)
   - Work traces

3. **Knowledge Graph (Граф понятий)**
   - Понятия и их определения
   - Связи между понятиями
   - Методологии и практики
   - Трассировка: идея → метод → применение → доказательство

4. **Данные из клуба и телеграм-чатов**
   - Сообщения и обсуждения
   - Извлеченные инсайты
   - Связи с артефактами
   - Полезно для обучения AI-моделей

### Комбинированный подход к хранению знаний

Для **руководств и методологии** предложен гибридный подход (см. [[0.3. Решения#ADR-003]]):

**Вариант A: Полный текст руководств**
- Хранилище: [aisystant/docs](https://github.com/aisystant/docs)
- Формат: Markdown
- Процесс: Разработчик пишет/редактирует руками или с помощью LLM

**Вариант B: Knowledge Graph**
- Хранилище: SurrealDB
- Альтернативы: Git (Markdown + YAML), Coda.io (с синхронизацией)
- Интерфейс: Специализированный UI для редактирования графа понятий

**Рекомендуемый комбинированный подход:**

```
┌─────────────────────────────────────────────────────────┐
│  1. ПОЛНЫЙ ТЕКСТ РУКОВОДСТВА (aisystant/docs)          │
│     • Markdown файлы                                   │
│     • Написаны людьми/LLM                              │
│     • Source of truth для контента                     │
└─────────────────────────────────────────────────────────┘
                        │
                        │ извлечение структуры
                        ↓
┌─────────────────────────────────────────────────────────┐
│  2. ГРАФ ПОНЯТИЙ (SurrealDB)                           │
│     • Понятия как узлы                                 │
│     • Связи между понятиями                            │
│     • Метаданные (уровень, статус, примеры)            │
└─────────────────────────────────────────────────────────┘
                        │
                        │ генерация на основе
                        ↓
┌─────────────────────────────────────────────────────────┐
│  3. ПЕРСОНАЛИЗИРОВАННЫЕ РУКОВОДСТВА                    │
│     • "Универсальное" руководство (стандартный путь)   │
│     • "Индивидуальное" руководство (адаптированное)    │
│     • "Дневник прохождения" (с прогрессом стажера)     │
└─────────────────────────────────────────────────────────┘
```

**Пример работы:**
1. Эксперт пишет полный текст руководства "Системное мышление" в Markdown
2. AI-агент извлекает из текста граф понятий → сохраняет в SurrealDB
3. ИИ-проводник для стажера генерирует персональный маршрут на основе графа:
   - Учитывает текущие знания стажера (из Digital Twin)
   - Подбирает примеры из контекста стажера
   - Предлагает темп и порядок изучения
4. Стажер проходит маршрут → прогресс фиксируется как "дневник прохождения"
5. Опыт стажера (Work traces, Evidence) обогащает граф новыми связями

### Интеграция с другими системами

**SurrealDB в архитектуре экосистемы:**

```
┌────────────────────────────────────────────────────────┐
│  ПЛАТФОРМЕННЫЕ СЕРВИСЫ                                │
├────────────────────────────────────────────────────────┤
│  • SurrealDB — Memory Bank, Digital Shadows, Activity │
│  • ORY — Аутентификация и авторизация                 │
└────────────────────────────────────────────────────────┘
            │
            │ используется
            ↓
┌────────────────────────────────────────────────────────┐
│  ПОДСИСТЕМЫ ЭКОСИСТЕМЫ                                │
├────────────────────────────────────────────────────────┤
│  • 4.2. ОС ИИ-платформы → извлекает контекст из MB    │
│  • 4.5. Проводник → читает граф знаний для маршрутов  │
│  • 4.6. Activity Hub → пишет Work traces в MB         │
│  • 4.11. Digital Twin → хранит профиль в SurrealDB    │
│  • 4.12. Proof-of-Impact → читает Evidence из MB      │
│  • 4.16. ESG → обновляет эпистемические статусы       │
└────────────────────────────────────────────────────────┘
```

### Модель данных и доступа

**Статус:** Требует детальной проработки совместно с @TserenTserenov

**Ключевые вопросы:**
- Схема SurrealDB для всех сущностей (Episteme, Work, Evidence, etc.)
- Record-level permissions для разных ролей
- Механизм синхронизации Git ↔ SurrealDB для knowledge graph
- Backup и disaster recovery стратегия
- Миграция схемы при эволюции онтологии

---

## Связанные документы

- [[4.1. Список подсистем]] — реестр всех систем
- [[4.2. Операционная система ИИ-платформы]] — основной потребитель Memory Bank
- [[4.6. Система учета активностей (хаб активностей)]] — источник Work событий
- [[4.16. Эпистемический граф и статусы]] — управление статусами артефактов
- [[4.12. Система Proof-of-Impact]] — валидация доказательств
- [[1.4. Концепция функционирования экосистемы для ЦА]] — концепция с FPF
- [[4.0. Информация]] — обзор раздела Системы

## История изменений

| Дата | Версия | Описание |
|------|--------|----------|
| 2025-11-18 | 2.1 | Добавлена секция о технологической реализации с SurrealDB, комбинированный подход (markdown + knowledge graph → персонализированные руководства) |
| 2025-11-12 | 2.0 | Переписан с фокусом на 3 концептуальные структуры (граф, слои, потоки) вместо технической реализации |
| 2025-11-12 | 1.0 | Первая версия с 4 техническими вариантами |

---

**Status:** 🟡 Draft v2.1
**Owner:** Architecture & Knowledge Team
**Last Updated:** 2025-11-18

---

type: doc
audience: mixed
edit_mode: manual
layer: architecture
scope: local-edge
security: internal
status: draft
version: 0.1
created: 2026-01-06

---


# Описание Knowledge Indexer

Knowledge Indexer — система, которая превращает разрозненный **первичный контент** участников в управляемый **индекс знаний**, а затем использует его для сборки **пакетов контекста** для LLM. LLM, опираясь на пакеты контекста, генерирует **продукты**.

**Продукт** — любой артефакт, создаваемый LLM с использованием пакета контекста: пост, руководство, концепция, ТЗ, маркетинговые материалы, структура курса, спецификация, заготовки для ИТ-систем и т.п.

## 0. Назначение документа

Документ определяет концепцию, архитектуру и метод работы Knowledge Indexer — системы для управления знаниями участников экосистемы и подготовки контекста для LLM-генерации продуктов.

**Для кого:**
- Архитекторы — для понимания места системы в ИТ-платформе
- Разработчики — для реализации компонентов
- Участники экосистемы — для понимания возможностей работы со своими знаниями

## 1. Назначение системы

Основная цель системы и решаемые задачи:

- **Сбор и нормализация первички** — агрегация контента из множества источников (LMS, клуб, Telegram, заметки) с приведением к единому формату
- **Управление вторичным слоем знаний** — структурированное хранилище с правами доступа, разметкой и версионированием
- **Индексация и поиск** — построение поисковых представлений (эмбеддинги, ключевые слова, сущности) для качественного извлечения
- **Сборка пакетов контекста** — формирование релевантных подборок фрагментов под задачи LLM
- **Контур качества** — цикл тестирования и улучшения выдачи через "Проверку выдачи"

### 1.1. Ключевые функции

1. **Персональный индекс знаний** — каждый участник получает управляемый слой знаний и индекс для работы с LLM
2. **Общий корпус знаний сообщества** — контролируемая публикация, прозрачное происхождение, явный доступ
3. **Воспроизводимая сборка продуктов** — создатели получают способ собирать пакеты контекста и генерировать продукты на основе знаний сообщества
4. **Управляемое качество** — цикл тестирования и улучшений вместо "надеемся, что LLM поймёт"

## 2. Концепция использования

### 2.1. Основные сущности

```
┌─────────────────────────────────────────────────────────────────┐
│                         ИСТОЧНИКИ                                │
│  LMS, Клуб, Telegram-чаты, Заметки, Документы                   │
│  (где возникает и живёт первичка)                               │
└──────────────────────────┬──────────────────────────────────────┘
                           │ сбор (ингест)
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│                    ПЕРВИЧНЫЙ КОНТЕНТ (ПЕРВИЧКА)                  │
│  Посты, ДЗ, комментарии, заметки, руководства, обсуждения       │
│  (как есть, без обработки)                                      │
└──────────────────────────┬──────────────────────────────────────┘
                           │ нормализация
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│                  ВТОРИЧНЫЙ СЛОЙ ЗНАНИЙ                           │
│  • Единый вид (структура, метаданные)                           │
│  • Политика доступа (личное / сообщество / публично)            │
│  • Правки и структурирование                                    │
│  • LLM-редактор для улучшения                                   │
└──────────────────────────┬──────────────────────────────────────┘
                           │ фрагментация + индексация
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│                      ИНДЕКС ЗНАНИЙ                               │
│  • Коллекция фрагментов знаний                                  │
│  • Права доступа и метаданные                                   │
│  • Поисковые представления (векторные/текстовые/гибридные)      │
│  • Структуры индексации                                         │
└──────────────────────────┬──────────────────────────────────────┘
                           │ извлечение (RAG-поиск)
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│                     ПАКЕТ КОНТЕКСТА                              │
│  • Фрагменты в нужном формате                                   │
│  • Атрибуция и ссылки на происхождение                          │
│  • Сводки/уплотнение для контекста LLM                          │
│  • Системные инструкции/шаблон генерации                        │
└──────────────────────────┬──────────────────────────────────────┘
                           │ генерация
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│                         ПРОДУКТ                                  │
│  Пост, руководство, концепция, ТЗ, структура курса,            │
│  спецификация, маркетинговые материалы и т.п.                   │
└─────────────────────────────────────────────────────────────────┘
```

### 2.2. Фрагмент знаний — единица индекса

Фрагмент знаний — не просто "чанк текста", а управляемая единица смысла:

| Компонент | Описание |
|-----------|----------|
| **Чанк содержания** | Текст/структура: тезис, определение, шаги, чек-лист, пример |
| **Метаданные** | Тема/теги, тип знания, автор, источник, дата, версия, статус качества |
| **Права доступа** | Только мне / Сообществу / Публично + дополнительные ограничения |
| **Происхождение** | Откуда взято и в каком контексте |
| **Поисковые представления** | Эмбеддинги, ключевые фразы, сущности (часть индексного слоя) |

### 2.3. Вторичный слой знаний

**Вторичный слой** — это не просто копия первички, а пространство осмысленной подготовки знаний:

- Приведение к единому виду (структура, метаданные)
- Применение политики доступа
- Правки и структурирование для повышения качества выдачи
- Работа через LLM-редактор

**LLM-редактор вторичного слоя** — режим, в котором участник редактирует вторичный слой с помощью LLM:
- Структурирует материал
- Уточняет формулировки
- Размечает темы и типы знаний
- Назначает уровни доступа
- Улучшает пригодность для индексации

### 2.4. Индекс-ассистент (опциональный компонент)

Помощник для ускорения настройки и улучшения качества:

- Предлагает правила включения/исключения источников
- Помогает разметить вторичный слой (темы, типы знаний, статус)
- Находит дубли и слабые места
- Объясняет, почему "Проверка выдачи" не проходит
- Предлагает, что поправить во вторичном слое

Система работает и без него — это надстройка для снижения ручных затрат.

## 3. Метод индексации знаний

### 3.1. Этапы работы Knowledge Indexer

```
1. СБОР (ИНГЕСТ)         2. НОРМАЛИЗАЦИЯ         3. ФРАГМЕНТАЦИЯ
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ Источники       │ ──→ │ Очистка         │ ──→ │ Атомизация      │
│ (LMS, Telegram, │     │ Структура       │     │ содержания      │
│  заметки, клуб) │     │ Дедупликация    │     │ Единицы смысла  │
└─────────────────┘     │ Метаданные      │     └─────────────────┘
                        │ Права доступа   │              │
                        └─────────────────┘              │
                                                         ↓
4. ПОСТРОЕНИЕ            5. ИНДЕКСАЦИЯ           6. ИЗВЛЕЧЕНИЕ
   ПРИЗНАКОВ
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ Эмбеддинги      │ ──→ │ Запись в        │ ──→ │ RAG-поиск       │
│ Ключевые слова  │     │ структуры       │     │ С учётом:       │
│ Сущности        │     │ поиска          │     │ • доступа       │
│ Сигналы         │     │ Версионирование │     │ • свежести      │
│ ранжирования    │     │ Связывание      │     │ • качества      │
└─────────────────┘     └─────────────────┘     │ • приоритета    │
                                                 └─────────────────┘
                                                         │
                        7. ФОРМИРОВАНИЕ                  │
                           ПАКЕТА КОНТЕКСТА              │
                        ┌─────────────────┐              │
                        │ Компоновка      │ ←────────────┘
                        │ Атрибуция       │
                        │ Уплотнение      │
                        │ Инструкции      │
                        └─────────────────┘
```

### 3.2. Детализация этапов

**1. Сбор данных (ингест)**
- Knowledge Indexer получает первичку из источников в рамках настроек пользователя
- Поддержка множества форматов и каналов

**2. Нормализация**
- Очистка и приведение к единому виду
- Базовая структура и дедупликация
- Извлечение метаданных
- Первичная классификация
- Применение правил доступа

**3. Фрагментация / атомизация содержания**
- Преобразование вторичного слоя в фрагменты знаний
- Управляемые единицы смысла, пригодные для извлечения

**4. Построение признаков (эмбеддинги/фичи)**
- Семантические представления
- Ключевые слова и сущности
- Дополнительные сигналы ранжирования

**5. Индексация**
- Обновление Индекса знаний
- Запись фрагментов и поисковых представлений
- Версионирование и связывание
- Учёт прав доступа

**6. Извлечение (RAG-поиск)**
- По запросу выбор релевантных фрагментов
- Учёт доступа, свежести, качества, приоритета источников

**7. Формирование пакета контекста**
- Компоновка результатов извлечения
- Готовый пакет для генерации продукта

## 4. Сценарии использования

### 4.1. Сценарий A — личный индекс знаний

```
Участник                   Knowledge Indexer              Индекс знаний
    │                             │                            │
    │  1. Подключает источники    │                            │
    │ ─────────────────────────→  │                            │
    │                             │  2. Сбор первички          │
    │                             │ ─────────────────────────→ │
    │                             │  3. Формирование           │
    │                             │     вторичного слоя        │
    │  4. Структурирует           │                            │
    │     через LLM-редактор      │                            │
    │ ─────────────────────────→  │                            │
    │                             │  5. Построение/обновление  │
    │                             │     Индекса знаний         │
    │                             │ ─────────────────────────→ │
    │  6. Запросы к индексу       │                            │
    │ ─────────────────────────→  │  7. Пакеты контекста       │
    │                             │ ←───────────────────────── │
    │  8. Работа с LLM            │                            │
    │     (личные задачи,         │                            │
    │      обучение, работа)      │                            │
```

### 4.2. Сценарий B — обмен знаниями с сообществом

```
Участник                   Knowledge Indexer              Другие участники
    │                             │                            │
    │  1. Во вторичном слое       │                            │
    │     помечает материал       │                            │
    │     "Сообществу"/"Публично" │                            │
    │ ─────────────────────────→  │                            │
    │                             │  2. Переиндексация         │
    │                             │     с новыми правами       │
    │                             │                            │
    │                             │  3. Фрагменты доступны     │
    │                             │ ─────────────────────────→ │
    │                             │                            │
    │                             │     4. Используют в своих  │
    │                             │        пакетах контекста   │
    │                             │        и продуктах         │
```

### 4.3. Сценарий C — создание продукта

```
Создатель                  Knowledge Indexer              LLM
    │                             │                        │
    │  1. Определяет продукт      │                        │
    │     (шаблон/структура/      │                        │
    │      аудитория/ограничения) │                        │
    │ ─────────────────────────→  │                        │
    │                             │  2. Извлечение         │
    │                             │     релевантных        │
    │                             │     фрагментов         │
    │                             │                        │
    │                             │  3. Сборка пакетов     │
    │                             │     контекста под      │
    │                             │     разделы продукта   │
    │                             │ ────────────────────→  │
    │                             │                        │  4. Генерация
    │                             │                        │     продукта
    │  5. Получение продукта      │                        │
    │ ←────────────────────────────────────────────────────│
    │                             │                        │
    │  6. При необходимости —     │                        │
    │     цикл тестирования       │                        │
```

## 5. Контур качества: "Проверка выдачи"

### 5.1. Механизм тестирования

**Проверка выдачи** (или "Тест индекса") — ключевой механизм управления качеством:

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ 1. Контрольные  │ ──→ │ 2. Извлечение   │ ──→ │ 3. Оценка       │
│    вопросы /    │     │    фрагментов   │     │    достаточности│
│    сценарии     │     │    из Индекса   │     │    для результат│
└─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                         │
                                              ┌──────────┴──────────┐
                                              │                     │
                                              ↓                     ↓
                                      ┌───────────────┐    ┌───────────────┐
                                      │ Качество OK   │    │ Качество      │
                                      │ → Использовать│    │ неудовл.      │
                                      └───────────────┘    └───────┬───────┘
                                                                   │
                                                                   ↓
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│ 5. Повторить    │ ←── │ 4. Корректировка│ ←── │ Анализ проблем  │
│    тест         │     │    вторичного   │     │ (через LLM-     │
│                 │     │    слоя         │     │  редактор или   │
│                 │     │                 │     │  Индекс-ассист.)│
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### 5.2. Типичные правки во вторичном слое

По итогам теста обычно правят:

| Что править | Примеры действий |
|-------------|------------------|
| **Структурирование материала** | Выделение тезисов, определений, процедур, чек-листов |
| **Контекст применимости** | Добавление условий, исключений, граничных случаев |
| **Формулировки** | Уточнение "канонической версии" мысли |
| **Разметка** | Темы, типы знаний, приоритет |
| **Права доступа** | Настройка на уровне частей/фрагментов |
| **Логика фрагментации** | Где дробить, где объединять |

## 6. Архитектура

### 6.1. Компоненты

```
┌─────────────────────────────────────────────────────────────────┐
│                      KNOWLEDGE INDEXER                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Source          │  │ Normalization   │  │ Fragmentation   │  │
│  │ Connector       │  │ Engine          │  │ Engine          │  │
│  │                 │  │                 │  │                 │  │
│  │ • LMS adapter   │  │ • Cleaning      │  │ • Chunking      │  │
│  │ • Telegram bot  │  │ • Deduplication │  │ • Atomization   │  │
│  │ • Club API      │  │ • Metadata      │  │ • Boundaries    │  │
│  │ • Notes sync    │  │ • Classification│  │ • Linking       │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Embedding       │  │ Index           │  │ Retrieval       │  │
│  │ Service         │  │ Manager         │  │ Engine          │  │
│  │                 │  │                 │  │                 │  │
│  │ • Vector models │  │ • Write/update  │  │ • RAG search    │  │
│  │ • Keywords      │  │ • Versioning    │  │ • Ranking       │  │
│  │ • Entities      │  │ • Permissions   │  │ • Filtering     │  │
│  │ • Ranking sigs  │  │ • Linking       │  │ • Context pack  │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│                                                                  │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐  │
│  │ Secondary Layer │  │ LLM Editor      │  │ Index           │  │
│  │ Store           │  │                 │  │ Assistant       │  │
│  │                 │  │                 │  │                 │  │
│  │ • Structured    │  │ • Structuring   │  │ • Rules suggest │  │
│  │   storage       │  │ • Clarification │  │ • Markup help   │  │
│  │ • Access policy │  │ • Markup        │  │ • Duplicates    │  │
│  │ • Versions      │  │ • Permissions   │  │ • Quality check │  │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘  │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2. Технологический стек (предварительный)

| Компонент | Технология | Обоснование |
|-----------|------------|-------------|
| **Index Storage** | SurrealDB / Qdrant | Мультимодельность, векторный поиск |
| **Embedding Models** | OpenAI Ada / Cohere / E5 | Качество семантического поиска |
| **Secondary Layer** | PostgreSQL + S3 | Структурированные данные + бинарные |
| **LLM Editor** | Claude / GPT-4 | Качество структурирования |
| **Event Bus** | Kafka | Асинхронность, масштабируемость |
| **API** | Go / Python | Производительность + ML-экосистема |

## 7. Интеграции

### 7.1. Входящие интеграции (источники данных)

| Система | Что получает Knowledge Indexer |
|---------|-------------------------------|
| [[3.2.3.4. LMS и обучение]] | ДЗ, ответы, прогресс обучения |
| [[3.2.3.5. Клуб]] | Посты, комментарии, обсуждения |
| Telegram-чаты | Сообщения, дискуссии, инсайты |
| [[3.2.3.1. Цифровой двойник]] | Контекст участника, предпочтения |
| [[3.2.3.7. Централизованное хранилище]] | Документы, руководства, методологии |

### 7.2. Исходящие интеграции (потребители)

| Система | Что предоставляет Knowledge Indexer |
|---------|-------------------------------------|
| [[3.2.3.8. Операционная система ИТ-платформы]] | Пакеты контекста для ИИ-агентов |
| [[3.2.3.1. Цифровой двойник]] | Обновление профиля знаний участника |
| LLM-генераторы продуктов | Контекст для генерации |
| [[3.2.3.13. Эпистемический граф]] | Статусы фрагментов знаний |

## 8. API и контракты

### 8.1. Основные эндпоинты

**Source Management:**
```
POST /ki/sources                    # Подключение источника
GET  /ki/sources                    # Список источников
PUT  /ki/sources/:id/config         # Настройка источника
POST /ki/sources/:id/sync           # Запуск синхронизации
```

**Secondary Layer:**
```
GET  /ki/secondary/:user_id/items   # Элементы вторичного слоя
PUT  /ki/secondary/item/:id         # Редактирование элемента
POST /ki/secondary/item/:id/llm-edit # LLM-редактирование
PUT  /ki/secondary/item/:id/access  # Настройка доступа
```

**Index Operations:**
```
POST /ki/index/reindex              # Переиндексация
GET  /ki/index/stats                # Статистика индекса
GET  /ki/index/fragments            # Поиск фрагментов
```

**Retrieval & Context:**
```
POST /ki/retrieve                   # Извлечение фрагментов
POST /ki/context-pack               # Сборка пакета контекста
POST /ki/test-retrieval             # Проверка выдачи
```

### 8.2. События

Система генерирует следующие события:

- `ki.source.connected` — подключён новый источник
- `ki.content.ingested` — получена первичка
- `ki.secondary.updated` — обновлён вторичный слой
- `ki.fragment.created` — создан фрагмент знаний
- `ki.index.updated` — обновлён индекс
- `ki.context.assembled` — собран пакет контекста
- `ki.quality.tested` — выполнена проверка выдачи

## 9. Метрики и мониторинг

### 9.1. Ключевые метрики

| Метрика | Целевое значение | Описание |
|---------|------------------|----------|
| **Retrieval Latency (p95)** | <500ms | Время извлечения фрагментов |
| **Context Pack Assembly (p95)** | <2s | Время сборки пакета контекста |
| **Index Freshness** | <1h | Задержка индексации новой первички |
| **Retrieval Precision@10** | >0.8 | Точность топ-10 результатов |
| **Fragment Coverage** | >90% | Доля первички, преобразованной в фрагменты |
| **Secondary Layer Quality** | >70% | Доля размеченных элементов |

### 9.2. Алерты

**Критические:**
- Index storage недоступен
- Embedding service error rate >5%
- Retrieval latency >2s

**Предупреждения:**
- Index freshness >4h
- Low retrieval precision (<0.6)
- High duplicate rate in secondary layer (>20%)
- Source sync failures

## 10. Roadmap

### v1.0 (MVP)

- [ ] Базовые коннекторы источников (LMS, Telegram)
- [ ] Нормализация и базовая фрагментация
- [ ] Векторный поиск (embedding-based)
- [ ] Простой пакет контекста
- [ ] API для интеграции с ИИ-агентами

### v1.1

- [ ] LLM-редактор вторичного слоя
- [ ] Права доступа на уровне фрагментов
- [ ] Проверка выдачи (тест индекса)
- [ ] Улучшенное ранжирование
- [ ] Интеграция с Цифровым двойником

### v2.0

- [ ] Индекс-ассистент
- [ ] Гибридный поиск (vector + keyword + structured)
- [ ] Автоматическая разметка и классификация
- [ ] Продвинутые сценарии создания продуктов
- [ ] Федеративный индекс (объединение индексов участников)

## 11. Связанные документы

- [[3.2.3.7. Централизованное хранилище]] — хранение эпистем и первичных артефактов
- [[3.2.3.1. Цифровой двойник]] — контекст участника
- [[3.2.3.8. Операционная система ИТ-платформы]] — основной потребитель пакетов контекста
- [[3.2.3.13. Эпистемический граф]] — статусы и валидация знаний
- [[3.2.2. Архитектурные решения]] — общая архитектура ИТ-платформы
- [[0.2. Процессы работы с хранилищем]] — процессы управления знаниями

## 12. История изменений

| Дата | Версия | Описание |
|------|--------|----------|
| 2026-01-06 | 0.1 | Первое создание документа на основе концепции |

---

**Status:** 🟡 Draft (входящие)
**Owner:** Architecture & Knowledge Team
**Last Updated:** 2026-01-06
